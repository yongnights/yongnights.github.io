<!-- build time:Sun Apr 26 2020 17:55:50 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="CentOS,Docker,"><link rel="alternate" href="/atom.xml" title="个人博客" type="application/atom+xml"><meta name="description" content="Docker简介基于菜鸟教程自己亲自实践一遍，把教程中有误的步骤改正过来，方便自己后期查看使用Docker 介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口（类似 i"><meta name="keywords" content="CentOS,Docker"><meta property="og:type" content="article"><meta property="og:title" content="Docker教程"><meta property="og:url" content="https://yongnights.github.io/2019/07/15/Docker教程/index.html"><meta property="og:site_name" content="个人博客"><meta property="og:description" content="Docker简介基于菜鸟教程自己亲自实践一遍，把教程中有误的步骤改正过来，方便自己后期查看使用Docker 介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口（类似 i"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker01.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker02.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker03.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker04.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker05.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker06.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker07.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker08.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker09.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker10.png"><meta property="og:image" content="https://yongnights.github.io/Docker_images/docker11.png"><meta property="og:updated_time" content="2019-12-31T04:00:48.250Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker教程"><meta name="twitter:description" content="Docker简介基于菜鸟教程自己亲自实践一遍，把教程中有误的步骤改正过来，方便自己后期查看使用Docker 介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口（类似 i"><meta name="twitter:image" content="https://yongnights.github.io/Docker_images/docker01.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://yongnights.github.io/2019/07/15/Docker教程/"><title>Docker教程 | 个人博客</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://your-url" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">个人博客</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">记录工作中的点点滴滴</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://yongnights.github.io/2019/07/15/Docker教程/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="永夜初晗凝碧天"><meta itemprop="description" content><meta itemprop="image" content="/img/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="个人博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Docker教程</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-15T16:10:09+08:00">2019-07-15 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2019-12-31T12:00:48+08:00">2019-12-31 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CentOS/" itemprop="url" rel="index"><span itemprop="name">CentOS</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CentOS/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i>本文总阅读量 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次</span><div class="post-wordcount"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">24.6k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">119 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h1><p>基于菜鸟教程自己亲自实践一遍，把教程中有误的步骤改正过来，方便自己后期查看使用</p><h2 id="Docker-介绍"><a href="#Docker-介绍" class="headerlink" title="Docker 介绍"></a>Docker 介绍</h2><p><img src="/Docker_images/docker01.png" alt></p><ol><li>Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。</li><li>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</li><li>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</li><li>Docker 从 17.03 版本之后分为 CE（Community Edition: 社区版） 和 EE（Enterprise Edition: 企业版），我们用社区版就可以了。</li></ol><h2 id="Docker-的应用场景"><a href="#Docker-的应用场景" class="headerlink" title="Docker 的应用场景"></a>Docker 的应用场景</h2><ul><li>Web 应用的自动化打包和发布。</li><li>自动化测试和持续集成、发布。</li><li>在服务型环境中部署和调整数据库或其他的后台应用。</li><li>从头编译或者扩展现有的 OpenShift 或 Cloud Foundry 平台来搭建自己的 PaaS 环境。</li></ul><h2 id="Docker-的优点"><a href="#Docker-的优点" class="headerlink" title="Docker 的优点"></a>Docker 的优点</h2><ol><li>简化程序<br>Docker 让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，便可以实现虚拟化。Docker改变了虚拟化的方式，使开发者可以直接将自己的成果放入Docker中进行管理。方便快捷已经是 Docker的最大优势，过去需要用数天乃至数周的 任务，在Docker容器的处理下，只需要数秒就能完成。</li><li>避免选择恐惧症<br>如果你有选择恐惧症，还是资深患者。那么你可以使用 Docker 打包你的纠结！比如 Docker 镜像；Docker 镜像中包含了运行环境和配置，所以 Docker 可以简化部署多种应用实例工作。比如 Web 应用、后台应用、数据库应用、大数据应用比如 Hadoop 集群、消息队列等等都可以打包成一个镜像部署。</li><li>节省开支<br>一方面，云计算时代到来，使开发者不必为了追求效果而配置高额的硬件，Docker 改变了高性能必然高价格的思维定势。Docker 与云的结合，让云空间得到更充分的利用。不仅解决了硬件管理的问题，也改变了虚拟化的方式。</li></ol><h1 id="Docker-架构"><a href="#Docker-架构" class="headerlink" title="Docker 架构"></a>Docker 架构</h1><ul><li>Docker 使用客户端-服务器 (C/S) 架构模式，使用远程API来管理和创建Docker容器。</li><li>Docker 容器通过 Docker 镜像来创建。</li><li>容器与镜像的关系类似于面向对象编程中的对象与类。</li></ul><table><thead><tr><th>Docker</th><th>面向对象</th></tr></thead><tbody><tr><td>容器</td><td>对象</td></tr><tr><td>镜像</td><td>类</td></tr></tbody></table><p><img src="/Docker_images/docker02.png" alt></p><table><thead><tr><th>Docker 镜像(Images)</th><th>Docker 镜像是用于创建 Docker 容器的模板。</th></tr></thead><tbody><tr><td>Docker 容器(Container)</td><td>容器是独立运行的一个或一组应用。</td></tr><tr><td>Docker 客户端(Client)</td><td>Docker 客户端通过命令行或者其他工具使用 Docker API (<a href="https://docs.docker.com/reference/api/docker_remote_api" target="_blank" rel="noopener">https://docs.docker.com/reference/api/docker_remote_api</a>) 与 Docker 的守护进程通信。</td></tr><tr><td>Docker 主机(Host)</td><td>一个物理或者虚拟的机器用于执行 Docker 守护进程和容器。</td></tr><tr><td>Docker 仓库(Registry)</td><td>Docker 仓库用来保存镜像，可以理解为代码控制中的代码仓库。 Docker Hub(<a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a>) 提供了庞大的镜像集合供使用。</td></tr><tr><td>Docker Machine</td><td>Docker Machine是一个简化Docker安装的命令行工具，通过一个简单的命令行即可在相应的平台上安装Docker，比如VirtualBox、 Digital Ocean、Microsoft Azure。</td></tr></tbody></table><a id="more"></a><h1 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h1><h2 id="Ubuntu-Docker-安装"><a href="#Ubuntu-Docker-安装" class="headerlink" title="Ubuntu Docker 安装"></a>Ubuntu Docker 安装</h2><p>Docker 支持以下的 Ubuntu 版本：</p><ul><li>Ubuntu Precise 12.04 (LTS)</li><li>Ubuntu Trusty 14.04 (LTS)</li><li>Ubuntu Wily 15.10</li><li>Xenial 16.04 (LTS)</li><li>其他更新的版本……<blockquote><p>如果安装 Docker ce 需要 16.04 及以上版本，安装步骤可以查看笔记部分：</p><ul><li>Cosmic 18.10</li><li>Bionic 18.04 (LTS)</li><li>Xenial 16.04 (LTS)</li></ul></blockquote></li></ul><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>Docker 要求 Ubuntu 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的 Ubuntu 版本是否支持 Docker。</p><p>通过 uname -r 命令查看你当前的内核版本：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ uname -r</span><br></pre></td></tr></table></figure><p></p><h3 id="使用脚本安装-Docker"><a href="#使用脚本安装-Docker" class="headerlink" title="使用脚本安装 Docker"></a>使用脚本安装 Docker</h3><ol><li>获取最新版本的 Docker 安装包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -qO- https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure></li></ol><p>输入当前用户的密码后，就会下载脚本并且安装Docker及依赖包。</p><p>安装完成后有个提示：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> If you would like to use Docker as a non-root user, you should now consider</span><br><span class="line"> adding your user to the &quot;docker&quot; group with something like:</span><br><span class="line"></span><br><span class="line"> sudo usermod -aG docker runoob</span><br><span class="line">Remember that you will have to log out and back in for this to take effect!</span><br></pre></td></tr></table></figure><p></p><p>当要以非root用户可以直接运行docker时，需要执行 sudo usermod -aG docker runoob 命令，然后重新登陆，否则会有如下报错：<br><img src="/Docker_images/docker03.png" alt></p><ol start="2"><li>启动docker 后台服务</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker start</span><br></pre></td></tr></table></figure><ol start="3"><li>测试运行hello-world</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world</span><br></pre></td></tr></table></figure><h3 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h3><p>鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，我们可以需要配置加速器来解决，我使用的是网易的镜像地址：<a href="http://hub-mirror.c.163.com。" target="_blank" rel="noopener">http://hub-mirror.c.163.com。</a></p><p>新版的 Docker 使用 /etc/docker/daemon.json（Linux） 或者 %programdata%\docker\config\daemon.json（Windows） 来配置 Daemon。</p><p>请在该配置文件中加入（没有该文件的话，请先建一个）：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"http://hub-mirror.c.163.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="Ubuntu-16-04-安装-Docker"><a href="#Ubuntu-16-04-安装-Docker" class="headerlink" title="Ubuntu 16.04 安装 Docker"></a>Ubuntu 16.04 安装 Docker</h3><p>1.选择国内的云服务商，这里选择阿里云为例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure><p>2.安装所需要的包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual</span><br></pre></td></tr></table></figure><p>3.添加使用 HTTPS 传输的软件包以及 CA 证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install apt-transport-https ca-certificates</span><br></pre></td></tr></table></figure><p>4.添加GPG密钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span><br></pre></td></tr></table></figure><p>5.添加软件源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"deb https://apt.dockerproject.org/repo ubuntu-xenial main"</span> | sudo tee /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure><p>6.添加成功后更新软件包缓存</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><p>7.安装docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-engine</span><br></pre></td></tr></table></figure><p>8.启动 docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><h3 id="Ubuntu-18-04-安装-Docker-ce"><a href="#Ubuntu-18-04-安装-Docker-ce" class="headerlink" title="Ubuntu 18.04 安装 Docker-ce"></a>Ubuntu 18.04 安装 Docker-ce</h3><p>1.更换国内软件源，推荐中国科技大学的源，稳定速度快（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">sudo sed -i <span class="string">'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'</span> /etc/apt/sources.list</span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>2.安装需要的包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apt-transport-https ca-certificates software-properties-common curl</span><br></pre></td></tr></table></figure><p>3.添加 GPG 密钥，并添加 Docker-ce 软件源，这里还是以中国科技大学的 Docker-ce 源为例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository <span class="string">"deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \</span></span><br><span class="line"><span class="string"><span class="variable">$(lsb_release -cs)</span> stable"</span></span><br></pre></td></tr></table></figure><p>4.添加成功后更新软件包缓存</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>5.安装 Docker-ce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker-ce</span><br></pre></td></tr></table></figure><p>6.设置开机自启动并启动 Docker-ce（安装成功后默认已设置并启动，可忽略）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><p>7.测试运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure><p>8.添加当前用户到 docker 用户组，可以不用 sudo 运行 docker（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker</span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><p>9.测试添加用户组（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><h2 id="CentOS-Docker-安装"><a href="#CentOS-Docker-安装" class="headerlink" title="CentOS Docker 安装"></a>CentOS Docker 安装</h2><p>Docker支持以下的CentOS版本：</p><ul><li>CentOS 7 (64-bit)</li><li>CentOS 6.5 (64-bit) 或更高的版本</li></ul><h3 id="前提条件-1"><a href="#前提条件-1" class="headerlink" title="前提条件"></a>前提条件</h3><p>目前，CentOS 仅发行版本中的内核支持 Docker。</p><p>Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。</p><p>Docker 运行在 CentOS6.5 或更高的版本的 CentOS 上，要求系统为64位、系统内核版本为 2.6.32-431 或者更高版本。</p><h3 id="使用-yum-安装（CentOS-7下）"><a href="#使用-yum-安装（CentOS-7下）" class="headerlink" title="使用 yum 安装（CentOS 7下）"></a>使用 yum 安装（CentOS 7下）</h3><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。<br>通过 uname -r 命令查看你当前的内核版本<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uname -r</span></span><br></pre></td></tr></table></figure><p></p><p>从 2017 年 3 月开始 docker 在原来的基础上分为两个分支版本: Docker CE 和 Docker EE。</p><p>Docker CE 即社区免费版，Docker EE 即企业版，强调安全，但需付费使用。</p><p>本文介绍 Docker CE 的安装使用。</p><p>移除旧的版本：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure><p></p><p>安装一些必要的系统工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><p>添加软件源信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p>Docker支持以下的CentOS版本：</p><pre><code>CentOS 7 (64-bit)
CentOS 6.5 (64-bit) 或更高的版本
</code></pre><p>前提条件</p><p>目前，CentOS 仅发行版本中的内核支持 Docker。</p><p>Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。</p><p>Docker 运行在 CentOS-6.5 或更高的版本的 CentOS 上，要求系统为64位、系统内核版本为 2.6.32-431 或者更高版本。<br>使用 yum 安装（CentOS 7下）</p><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。<br>通过 uname -r 命令查看你当前的内核版本</p><p>[root@runoob ~]# uname -r</p><p>安装 Docker</p><p>从 2017 年 3 月开始 docker 在原来的基础上分为两个分支版本: Docker CE 和 Docker EE。</p><p>Docker CE 即社区免费版，Docker EE 即企业版，强调安全，但需付费使用。</p><p>本文介绍 Docker CE 的安装使用。</p><p>移除旧的版本：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove docker \</span></span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure><p></p><p>安装一些必要的系统工具：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y yum-utils device-mapper-persistent-data lvm2</span></span><br></pre></td></tr></table></figure><p></p><p>添加软件源信息：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br></pre></td></tr></table></figure><p></p><p>更新 yum 缓存：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum makecache fast</span></span><br></pre></td></tr></table></figure><p></p><p>安装 Docker-ce：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install docker-ce</span></span><br></pre></td></tr></table></figure><p></p><p>启动 Docker 后台服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start docker.service</span></span><br></pre></td></tr></table></figure><p>测试运行 hello-world<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">1b930d010525: Pull complete </span><br><span class="line">Digest: sha256:6540fc08ee6e6b7b63468dc3317e3303aae178cb8a45ed3123180328bcc1d20f</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure><p></p><p>由于本地没有hello-world这个镜像，所以会下载一个hello-world的镜像，并在容器内运行。</p><h3 id="使用脚本安装-Docker-1"><a href="#使用脚本安装-Docker-1" class="headerlink" title="使用脚本安装 Docker"></a>使用脚本安装 Docker</h3><ol><li>使用 sudo 或 root 权限登录 Centos。</li><li><p>确保 yum 包更新到最新。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum update</span></span><br></pre></td></tr></table></figure></li><li><p>执行 Docker 安装脚本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -fsSL https://get.docker.com -o get-docker.sh</span></span><br><span class="line"><span class="comment"># sh get-docker.sh</span></span><br></pre></td></tr></table></figure></li></ol><p>执行这个脚本会添加 docker.repo 源并安装 Docker。</p><ol start="4"><li><p>启动 Docker 进程。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start docker.service</span></span><br></pre></td></tr></table></figure></li><li><p>验证 docker 是否安装成功并在容器中执行一个测试的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run hello-world</span></span><br><span class="line"><span class="comment"># docker ps</span></span><br></pre></td></tr></table></figure></li></ol><p>到此，Docker 在 CentOS 系统的安装完成。</p><h3 id="镜像加速-1"><a href="#镜像加速-1" class="headerlink" title="镜像加速"></a>镜像加速</h3><p>鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，我们可以需要配置加速器来解决，我使用的是网易的镜像地址：<a href="http://hub-mirror.c.163.com。" target="_blank" rel="noopener">http://hub-mirror.c.163.com。</a></p><p>新版的 Docker 使用 /etc/docker/daemon.json（Linux） 或者 %programdata%\docker\config\daemon.json（Windows） 来配置 Daemon。</p><p>请在该配置文件中加入（没有该文件的话，请先建一个）：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="删除-Docker-CE"><a href="#删除-Docker-CE" class="headerlink" title="删除 Docker CE"></a>删除 Docker CE</h3><p>执行以下命令来删除 Docker CE：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove docker-ce</span></span><br><span class="line"><span class="comment"># rm -rf /var/lib/docker</span></span><br></pre></td></tr></table></figure><p></p><h2 id="Windows-Docker-安装"><a href="#Windows-Docker-安装" class="headerlink" title="Windows Docker 安装"></a>Windows Docker 安装</h2><h3 id="win7、win8-系统"><a href="#win7、win8-系统" class="headerlink" title="win7、win8 系统"></a>win7、win8 系统</h3><p>win7、win8 等需要利用 docker toolbox 来安装，国内可以使用阿里云的镜像来下载，下载地址：<a href="http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/" target="_blank" rel="noopener">http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</a></p><p>docker toolbox 是一个工具集，它主要包含以下一些内容：</p><blockquote><blockquote><p>Docker CLI 客户端，用来运行docker引擎创建镜像和容器<br>Docker Machine. 可以让你在windows的命令行中运行docker引擎命令<br>Docker Compose. 用来运行docker-compose命令<br>Kitematic. 这是Docker的GUI版本<br>Docker QuickStart shell. 这是一个已经配置好Docker的命令行环境<br>Oracle VM Virtualbox. 虚拟机</p></blockquote></blockquote><p>下载完成之后直接点击安装，安装成功后，桌边会出现三个图标，入下图所示：<br><img src="/Docker_images/docker04.png" alt></p><p>如果系统显示 User Account Control 窗口来运行 VirtualBox 修改你的电脑，选择 Yes。<br><img src="/Docker_images/docker05.png" alt></p><p>$ 符号那你可以输入以下命令来执行<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world</span><br><span class="line"> Unable to find image <span class="string">'hello-world:latest'</span> locally</span><br><span class="line"> Pulling repository hello-world</span><br><span class="line"> 91c95931e552: Download complete</span><br><span class="line"> a8219747be10: Download complete</span><br><span class="line"> Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"> Hello from Docker.</span><br><span class="line"> This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line"> To generate this message, Docker took the following steps:</span><br><span class="line">  1. The Docker Engine CLI client contacted the Docker Engine daemon.</span><br><span class="line">  2. The Docker Engine daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line">     (Assuming it was not already locally available.)</span><br><span class="line">  3. The Docker Engine daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">     executable that produces the output you are currently reading.</span><br><span class="line">  4. The Docker Engine daemon streamed that output to the Docker Engine CLI client, <span class="built_in">which</span> sent it</span><br><span class="line">     to your terminal.</span><br><span class="line"></span><br><span class="line"> To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line">  $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line"> For more examples and ideas, visit:</span><br><span class="line">  https://docs.docker.com/userguide/</span><br></pre></td></tr></table></figure><p></p><h3 id="Win10-系统"><a href="#Win10-系统" class="headerlink" title="Win10 系统"></a>Win10 系统</h3><p>现在 Docker 有专门的 Win10 专业版系统的安装包，需要开启Hyper-V。</p><p>应用和功能 -&gt; 程序和功能 -&gt; 启用或关闭Windows功能 -&gt; 选中Hyper-V<br><img src="/Docker_images/docker06.png" alt></p><ol><li>安装 Toolbox</li></ol><p>最新版 Toolbox 下载地址： <a href="https://www.docker.com/get-docker" target="_blank" rel="noopener">https://www.docker.com/get-docker</a></p><p>点击 Download Desktop and Take a Tutorial，并下载 Windows 的版本，如果你还没有登录，会要求注册登录：</p><ol start="2"><li>运行安装文件</li></ol><p>双击下载的 Docker for Windows Installer 安装文件，一路 Next，点击 Finish 完成安装。</p><p>安装完成后，Docker 会自动启动。通知栏上会出现个小鲸鱼的图标，这表示 Docker 正在运行。</p><p>桌边也会出现三个图标，我们可以在命令行执行 docker version 来查看版本号，docker run hello-world 来载入测试镜像测试。</p><p>如果没启动，你可以在 Windows 搜索 Docker 来启动，启动后，也可以在通知栏上看到小鲸鱼图标</p><h3 id="镜像加速-2"><a href="#镜像加速-2" class="headerlink" title="镜像加速"></a>镜像加速</h3><p>鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，我们可以需要配置加速器来解决，我使用的是网易的镜像地址：<a href="http://hub-mirror.c.163.com。" target="_blank" rel="noopener">http://hub-mirror.c.163.com。</a></p><p>新版的 Docker 使用 /etc/docker/daemon.json（Linux） 或者 %programdata%\docker\config\daemon.json（Windows） 来配置 Daemon。</p><p>请在该配置文件中加入（没有该文件的话，请先建一个）：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="MacOS-Docker-安装"><a href="#MacOS-Docker-安装" class="headerlink" title="MacOS Docker 安装"></a>MacOS Docker 安装</h2><h3 id="使用-Homebrew-安装"><a href="#使用-Homebrew-安装" class="headerlink" title="使用 Homebrew 安装"></a>使用 Homebrew 安装</h3><p>macOS 我们可以使用 Homebrew 来安装 Docker。</p><p>Homebrew 的 Cask 已经支持 Docker for Mac，因此可以很方便的使用 Homebrew Cask 来进行安装：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ brew cask install docker</span><br><span class="line"></span><br><span class="line">==&gt; Creating Caskroom at /usr/<span class="built_in">local</span>/Caskroom</span><br><span class="line">==&gt; We<span class="string">'ll set permissions properly so we won'</span>t need sudo <span class="keyword">in</span> the future</span><br><span class="line">Password:          <span class="comment"># 输入 macOS 密码</span></span><br><span class="line">==&gt; Satisfying dependencies</span><br><span class="line">==&gt; Downloading https://download.docker.com/mac/stable/21090/Docker.dmg</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; Verifying checksum <span class="keyword">for</span> Cask docker</span><br><span class="line">==&gt; Installing Cask docker</span><br><span class="line">==&gt; Moving App <span class="string">'Docker.app'</span> to <span class="string">'/Applications/Docker.app'</span>.</span><br><span class="line">&amp;<span class="comment">#x1f37a;  docker was successfully installed!</span></span><br></pre></td></tr></table></figure><p></p><p>在载入 Docker app 后，点击 Next，可能会询问你的 macOS 登陆密码，你输入即可。之后会弹出一个 Docker 运行的提示窗口，状态栏上也有有个小鲸鱼的图标。</p><h3 id="手动下载安装"><a href="#手动下载安装" class="headerlink" title="手动下载安装"></a>手动下载安装</h3><p>如果需要手动下载，请点击以下链接下载 <a href="https://download.docker.com/mac/edge/Docker.dmg" target="_blank" rel="noopener">Stable</a> 或 <a href="https://download.docker.com/mac/edge/Docker.dmg" target="_blank" rel="noopener">Edge</a> 版本的 Docker for Mac。</p><p>如同 macOS 其它软件一样，安装也非常简单，双击下载的 .dmg 文件，然后将鲸鱼图标拖拽到 Application 文件夹即可。</p><p>从应用中找到 Docker 图标并点击运行。可能会询问 macOS 的登陆密码，输入即可。</p><p>点击顶部状态栏中的鲸鱼图标会弹出操作菜单。</p><p>第一次点击图标，可能会看到这个安装成功的界面，点击 “Got it!” 可以关闭这个窗口。</p><p>启动终端后，通过命令可以检查安装后的 Docker 版本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker --version</span><br><span class="line">Docker version 17.09.1-ce, build 19e2cf6</span><br></pre></td></tr></table></figure><h3 id="镜像加速-3"><a href="#镜像加速-3" class="headerlink" title="镜像加速"></a>镜像加速</h3><p>鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，我们可以需要配置加速器来解决，我使用的是网易的镜像地址：<a href="http://hub-mirror.c.163.com。" target="_blank" rel="noopener">http://hub-mirror.c.163.com。</a></p><p>在任务栏点击 Docker for mac 应用图标 -&gt; Perferences… -&gt; Daemon -&gt; Registry mirrors。在列表中填写加速器地址即可。修改完成之后，点击 Apply &amp; Restart 按钮，Docker 就会重启并应用配置的镜像地址了。</p><p><img src="/Docker_images/docker07.png" alt></p><p>之后我们可以通过 docker info 来查看是否配置成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">...</span><br><span class="line">Registry Mirrors:</span><br><span class="line"> http://hub-mirror.c.163.com</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h1 id="Docker-使用"><a href="#Docker-使用" class="headerlink" title="Docker 使用"></a>Docker 使用</h1><h2 id="Docker-Hello-World"><a href="#Docker-Hello-World" class="headerlink" title="Docker Hello World"></a>Docker Hello World</h2><p>Docker 允许你在容器内运行应用程序， 使用 docker run 命令来在容器内运行一个应用程序。</p><p>输出Hello world</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run centos /bin/echo "Hello world"</span></span><br><span class="line">Unable to find image <span class="string">'centos:latest'</span> locally</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">8ba884070f61: Pull complete </span><br><span class="line">Digest: sha256:a799dd8a2ded4a83484bbae769d97655392b3f86533ceb7dd96bbac929809f3c</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line">Hello world</span><br></pre></td></tr></table></figure><p>各个参数解析：</p><ul><li>docker: Docker 的二进制执行文件。</li><li>run: 与前面的 docker 组合来运行一个容器。</li><li>ceentos 指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</li><li>/bin/echo “Hello world”: 在启动的容器里执行的命令</li></ul><p>以上命令完整的意思可以解释为：Docker 以 centos 镜像创建一个新容器，然后在容器里执行 bin/echo “Hello world”，然后输出结果。</p><p>搜索docker hub中的镜像<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker search centos</span></span><br></pre></td></tr></table></figure><p></p><h3 id="运行交互式的容器"><a href="#运行交互式的容器" class="headerlink" title="运行交互式的容器"></a>运行交互式的容器</h3><p>我们通过docker的两个参数 -i -t，让docker运行的容器实现”对话”的能力<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -i -t centos /bin/bash</span></span><br><span class="line">[root@f566b922be2f /]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p></p><p>各个参数解析：</p><ul><li>-t：在新容器内指定一个伪终端或终端。</li><li>-i：允许你对容器内的标准输入 (STDIN) 进行交互。</li></ul><p>我们可以通过运行exit命令或者使用CTRL+D来退出容器。</p><h3 id="启动容器-后台模式"><a href="#启动容器-后台模式" class="headerlink" title="启动容器 (后台模式)"></a>启动容器 (后台模式)</h3><p>使用以下命令创建一个以进程方式运行的容器：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d centos /bin/sh -c "while true; do echo hello world; sleep 1; done"</span></span><br><span class="line">7e436b86913579f28f56b9b038e4782570b5beeb150e2e0ecd440201124814dc</span><br></pre></td></tr></table></figure><p></p><p>在输出中，我们没有看到期望的”hello world”，而是一串长字符，这个长字符串叫做容器ID，对每个容器来说都是唯一的，我们可以通过容器ID来查看对应的容器发生了什么。</p><p>首先，我们需要确认容器有在运行，可以通过 docker ps 来查看<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER    ID  IMAGE  COMMAND   CREATED   STATUS PORTS     NAMES</span><br><span class="line">7e436b869135     centos    <span class="string">"/bin/sh -c 'while t…"</span>   43 seconds ago      Up 42 seconds      competent_merkle</span><br></pre></td></tr></table></figure><p></p><p>CONTAINER ID：容器ID<br>NAMES：自动分配的容器名称</p><p>在容器内使用docker logs命令，查看容器内的标准输出：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 如下两个命令的输出结果一致，都是好多个hello world</span><br><span class="line"><span class="comment"># docker logs 7e436b869135</span></span><br><span class="line"><span class="comment"># docker logs competent_merkle</span></span><br></pre></td></tr></table></figure><p></p><h3 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h3><p>我们使用 docker stop 命令来停止容器:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker stop 7e436b869135</span></span><br></pre></td></tr></table></figure><p></p><p>通过docker ps查看，容器已经停止工作：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps</span></span><br></pre></td></tr></table></figure><p></p><p>也可以用下面的命令来停止：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker stop competent_merkle</span></span><br></pre></td></tr></table></figure><p></p><h2 id="Docker-容器使用"><a href="#Docker-容器使用" class="headerlink" title="Docker 容器使用"></a>Docker 容器使用</h2><h3 id="Docker-客户端"><a href="#Docker-客户端" class="headerlink" title="Docker 客户端"></a>Docker 客户端</h3><p>直接输入 docker 命令来查看到 Docker 客户端的所有命令选项。<br>可以通过命令 docker command –help 更深入的了解指定的 Docker 命令使用方法。<br>例如我们要查看 docker stats 指令的具体使用方法：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker stats --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker stats [OPTIONS] [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Display a live stream of container(s) resource usage statistics</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all containers (default shows just running)</span><br><span class="line">      --format string   Pretty-print images using a Go template</span><br><span class="line">      --no-stream       Disable streaming stats and only pull the first result</span><br><span class="line">      --no-trunc        Do not truncate output</span><br></pre></td></tr></table></figure><p></p><h3 id="运行一个web应用"><a href="#运行一个web应用" class="headerlink" title="运行一个web应用"></a>运行一个web应用</h3><p>在docker容器中运行一个 Python Flask 应用来运行一个web应用。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull training/webapp # 载入镜像</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from training/webapp</span><br><span class="line">e190868d63f8: Pulling fs layer </span><br><span class="line">909cd34c6fd7: Pulling fs layer </span><br><span class="line">0b9bfabab7c1: Downloading </span><br><span class="line">a3ed95caeb02: Waiting </span><br><span class="line">10bbbc0fc0ff: Waiting </span><br><span class="line">fca59b508e9f: Waiting </span><br><span class="line">e7ae2541b15b: Waiting </span><br><span class="line">9dd97ef58ce9: Waiting </span><br><span class="line">a4c1b0cb7af7: Waiting </span><br><span class="line">latest: Pulling from training/webapp</span><br><span class="line">e190868d63f8: Pull complete </span><br><span class="line">909cd34c6fd7: Pull complete </span><br><span class="line">0b9bfabab7c1: Pull complete </span><br><span class="line">a3ed95caeb02: Pull complete </span><br><span class="line">10bbbc0fc0ff: Pull complete </span><br><span class="line">fca59b508e9f: Pull complete </span><br><span class="line">e7ae2541b15b: Pull complete </span><br><span class="line">9dd97ef58ce9: Pull complete </span><br><span class="line">a4c1b0cb7af7: Pull complete </span><br><span class="line">Digest: sha256:06e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> training/webapp:latest</span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -d -P training/webapp python app.py</span></span><br><span class="line">ab3dc2ea803335fee98c58b9bd55a9ef01d58a4602d75ec95a8fa3a97e403f5e</span><br></pre></td></tr></table></figure><p></p><p>参数说明:</p><ul><li>-d：让容器在后台运行。</li><li>-P：将容器内部使用的网络端口映射到我们使用的主机上。</li></ul><h3 id="查看-WEB-应用容器"><a href="#查看-WEB-应用容器" class="headerlink" title="查看 WEB 应用容器"></a>查看 WEB 应用容器</h3><p>使用 docker ps 来查看我们正在运行的容器：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS                     NAMES</span><br><span class="line">ab3dc2ea8033        training/webapp     <span class="string">"python app.py"</span>     About a minute ago   Up About a minute   0.0.0.0:32768-&gt;5000/tcp   loving_turing</span><br></pre></td></tr></table></figure><p></p><p>这里多了端口信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PORTS</span><br><span class="line">0.0.0.0:32768-&gt;5000/tcp</span><br></pre></td></tr></table></figure><p>Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 32768 上。<br>这时我们可以通过浏览器访问WEB应用：<a href="http://192.168.0.130:32768" target="_blank" rel="noopener">http://192.168.0.130:32768</a></p><p>也可以通过 -p 参数来设置不一样的端口：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -p 5000:5000 training/webapp python app.py</span></span><br></pre></td></tr></table></figure><p></p><p>docker ps查看正在运行的容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">e18b3ff3ed87        training/webapp     <span class="string">"python app.py"</span>     3 seconds ago       Up 2 seconds        0.0.0.0:5000-&gt;5000/tcp    nervous_chandrasekhar</span><br><span class="line">ab3dc2ea8033        training/webapp     <span class="string">"python app.py"</span>     4 minutes ago       Up 4 minutes        0.0.0.0:32768-&gt;5000/tcp   loving_turing</span><br></pre></td></tr></table></figure><p>容器内部的 5000 端口映射到我们本地主机的 5000 端口上。</p><h3 id="网络端口的快捷方式"><a href="#网络端口的快捷方式" class="headerlink" title="网络端口的快捷方式"></a>网络端口的快捷方式</h3><p>通过 docker ps 命令可以查看到容器的端口映射，docker 还提供了另一个快捷方式 docker port，<br>使用 docker port 可以查看指定 （ID 或者名字）容器的某个确定端口映射到宿主机的端口号。</p><p>上面我们创建的 web 应用容器 ID 为 e18b3ff3ed87 名字为 nervous_chandrasekhar。</p><p>我可以使用 docker port e18b3ff3ed87 或 docker port nervous_chandrasekhar 来查看容器端口的映射情况。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker port e18b3ff3ed87</span></span><br><span class="line">5000/tcp -&gt; 0.0.0.0:5000</span><br><span class="line">[root@localhost ~]<span class="comment"># docker port nervous_chandrasekhar</span></span><br><span class="line">5000/tcp -&gt; 0.0.0.0:5000</span><br></pre></td></tr></table></figure><h3 id="查看-WEB-应用程序日志"><a href="#查看-WEB-应用程序日志" class="headerlink" title="查看 WEB 应用程序日志"></a>查看 WEB 应用程序日志</h3><p>docker logs [ID或者名字] 可以查看容器内部的标准输出。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker logs  -f e18b3ff3ed87 </span></span><br><span class="line"> * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br></pre></td></tr></table></figure><p>-f：让 docker logs 像使用 tail -f 一样来输出容器内部的标准输出。<br>从上面，我们可以看到应用程序使用的是 5000 端口并且能够查看到应用程序的访问日志。</p><h3 id="查看WEB应用程序容器的进程"><a href="#查看WEB应用程序容器的进程" class="headerlink" title="查看WEB应用程序容器的进程"></a>查看WEB应用程序容器的进程</h3><p>还可以使用 docker top 来查看容器内部运行的进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker top e18b3ff3ed87</span></span><br><span class="line">UID   PID    PPID  C    STIME  TTY    TIME     CMD</span><br><span class="line">root 21092  21074  0   04:45   ?    00:00:00  python app.py</span><br></pre></td></tr></table></figure><h3 id="检查-WEB-应用程序"><a href="#检查-WEB-应用程序" class="headerlink" title="检查 WEB 应用程序"></a>检查 WEB 应用程序</h3><p>使用 docker inspect 来查看 Docker 的底层信息。它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker inspect e18b3ff3ed87</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"e18b3ff3ed87fd4a5bbcb4d7d49506c8b08fea2354b3e9a735370da143a132a4"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2019-07-12T08:45:39.489607684Z"</span>,</span><br><span class="line">        <span class="string">"Path"</span>: <span class="string">"python"</span>,</span><br><span class="line">        <span class="string">"Args"</span>: [</span><br><span class="line">            <span class="string">"app.py"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"State"</span>: &#123;</span><br><span class="line">            <span class="string">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="string">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Pid"</span>: 21092,</span><br><span class="line">            <span class="string">"ExitCode"</span>: 0,</span><br><span class="line">            <span class="string">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"StartedAt"</span>: <span class="string">"2019-07-12T08:45:39.948487352Z"</span>,</span><br><span class="line">            <span class="string">"FinishedAt"</span>: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h3 id="停止-WEB-应用容器"><a href="#停止-WEB-应用容器" class="headerlink" title="停止 WEB 应用容器"></a>停止 WEB 应用容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker stop e18b3ff3ed87   </span></span><br><span class="line">e18b3ff3ed87</span><br></pre></td></tr></table></figure><h3 id="重启WEB应用容器"><a href="#重启WEB应用容器" class="headerlink" title="重启WEB应用容器"></a>重启WEB应用容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker start e18b3ff3ed87   </span></span><br><span class="line">e18b3ff3ed87</span><br></pre></td></tr></table></figure><p>docker ps -l 查询最后一次创建的容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">e18b3ff3ed87        training/webapp     <span class="string">"python app.py"</span>     8 minutes ago       Up 27 seconds       0.0.0.0:5000-&gt;5000/tcp   nervous_chandrasekhar</span><br></pre></td></tr></table></figure><p>正在运行的容器，我们可以使用 docker restart 命令来重启</p><h3 id="移除WEB应用容器"><a href="#移除WEB应用容器" class="headerlink" title="移除WEB应用容器"></a>移除WEB应用容器</h3><p>使用 docker rm 命令来删除不需要的容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rm e18b3ff3ed87</span></span><br><span class="line">e18b3ff3ed87</span><br></pre></td></tr></table></figure><p>删除容器时，容器必须是停止状态，否则会报如下错误：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rm ab3dc2ea8033</span></span><br><span class="line">Error response from daemon: You cannot remove a running container ab3dc2ea803335fee98c58b9bd55a9ef01d58a4602d75ec95a8fa3a97e403f5e. Stop the container before attempting removal or force remove</span><br></pre></td></tr></table></figure><p></p><p>批量删除所有容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rm `docker ps -a -q`</span></span><br></pre></td></tr></table></figure><h2 id="Docker-镜像使用"><a href="#Docker-镜像使用" class="headerlink" title="Docker 镜像使用"></a>Docker 镜像使用</h2><p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p><p>下面我们来学习：</p><ol><li>管理和使用本地 Docker 主机镜像</li><li>创建镜像</li></ol><h3 id="列出镜像列表"><a href="#列出镜像列表" class="headerlink" title="列出镜像列表"></a>列出镜像列表</h3><p>可以使用 docker images 来列出本地主机上的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure><p>各个选项说明:</p><ul><li>REPOSITORY：表示镜像的仓库源</li><li>TAG：镜像的标签</li><li>IMAGE ID：镜像ID</li><li>CREATED：镜像创建时间</li><li>SIZE：镜像大小</li></ul><p>同一仓库源可以有多个 TAG，代表这个仓库源的不同版本，如ubuntu仓库源里，有15.10、14.04等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p><p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -t -i ubuntu:15.10 /bin/bash</span></span><br><span class="line">root@0c8e4aa0064f:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p></p><p>如果要使用版本为14.04的ubuntu系统镜像来运行容器时，命令如下：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -t -i ubuntu:14.04 /bin/bash</span></span><br><span class="line">root@0c8e4aa0064f:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p></p><p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p><h3 id="获取一个新的镜像"><a href="#获取一个新的镜像" class="headerlink" title="获取一个新的镜像"></a>获取一个新的镜像</h3><p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull ubuntu:14.04</span></span><br><span class="line">14.04: Pulling from library/ubuntu</span><br><span class="line">a7344f52cb74: Pull complete </span><br><span class="line">515c9bb51536: Pull complete </span><br><span class="line">e1eabe0537eb: Pull complete </span><br><span class="line">4701f1215c13: Pull complete </span><br><span class="line">Digest: sha256:2f7c79927b346e436cc14c92bd4e5bd778c3bd7037f35bc639ac1589a7acfa90</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:14.04</span><br></pre></td></tr></table></figure><p>下载完成后，我们可以直接使用这个镜像来运行容器。</p><h3 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h3><p>可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><p>也可以使用 docker search 命令来搜索镜像。比如我们需要一个nginx的镜像来作为我们的web服务。我们可以通过 docker search 命令搜索 nginx 来寻找适合我们的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search nginx</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                             Official build of Nginx.                        11671               [OK]                </span><br><span class="line">jwilder/nginx-proxy               Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   1627                                    [OK]</span><br><span class="line">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   726                                     [OK]</span><br><span class="line">bitnami/nginx                     Bitnami nginx Docker Image                      69                                      [OK]</span><br><span class="line">linuxserver/nginx                 An Nginx container, brought to you by LinuxS…   66                                      </span><br><span class="line">tiangolo/nginx-rtmp               Docker image with Nginx using the nginx-rtmp…   48                                      [OK]</span><br><span class="line">nginx/nginx-ingress               NGINX Ingress Controller <span class="keyword">for</span> Kubernetes         20                                      </span><br><span class="line">nginxdemos/hello                  NGINX webserver that serves a simple page co…   18                                      [OK]</span><br><span class="line">schmunk42/nginx-redirect          A very simple container to redirect HTTP tra…   17                                      [OK]</span><br><span class="line">jlesage/nginx-proxy-manager       Docker container <span class="keyword">for</span> Nginx Proxy Manager        17                                      [OK]</span><br><span class="line">crunchgeek/nginx-pagespeed        Nginx with PageSpeed + GEO IP + VTS + more_s…   13                                      </span><br><span class="line">blacklabelops/nginx               Dockerized Nginx Reverse Proxy Server.          12                                      [OK]</span><br><span class="line">centos/nginx-18-centos7           Platform <span class="keyword">for</span> running nginx 1.8 or building n…   11                                      </span><br><span class="line">centos/nginx-112-centos7          Platform <span class="keyword">for</span> running nginx 1.12 or building …   9                                       </span><br><span class="line">webdevops/nginx                   Nginx container                                 8                                       [OK]</span><br><span class="line">nginxinc/nginx-unprivileged       Unprivileged NGINX Dockerfiles                  8                                       </span><br><span class="line">sophos/nginx-vts-exporter         Simple server that scrapes Nginx vts stats a…   5                                       [OK]</span><br><span class="line">nginx/nginx-prometheus-exporter   NGINX Prometheus Exporter                       4                                       </span><br><span class="line">1science/nginx                    Nginx Docker images that include Consul Temp…   4                                       [OK]</span><br><span class="line">mailu/nginx                       Mailu nginx frontend                            3                                       [OK]</span><br><span class="line">travix/nginx                      NGinx reverse proxy                             2                                       [OK]</span><br><span class="line">pebbletech/nginx-proxy            nginx-proxy sets up a container running ngin…   2                                       [OK]</span><br><span class="line">centos/nginx-110-centos7          Platform <span class="keyword">for</span> running nginx 1.10 or building …   0                                       </span><br><span class="line">wodby/nginx                       Generic nginx                                   0                                       [OK]</span><br><span class="line">ansibleplaybookbundle/nginx-apb   An APB to deploy NGINX                          0                                       [OK]</span><br></pre></td></tr></table></figure><p>NAME：镜像仓库源的名称<br>DESCRIPTION：镜像的描述<br>OFFICIAL：是否docker官方发布</p><h3 id="拖取镜像"><a href="#拖取镜像" class="headerlink" title="拖取镜像"></a>拖取镜像</h3><p>使用上图中的nginx官方版本的镜像，使用命令 docker pull 来下载镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull nginx  </span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">fc7181108d40: Pull complete </span><br><span class="line">d2e987ca2267: Pull complete </span><br><span class="line">0b760b431b11: Pull complete </span><br><span class="line">Digest: sha256:48cbeee0cb0a3b5e885e36222f969e0a2f41819a68e07aeb6631ca7cb356fed1</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br></pre></td></tr></table></figure><p>下载完成后，我们就可以使用这个镜像了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run nginx</span></span><br></pre></td></tr></table></figure><h3 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h3><p>当从docker镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。</p><ol><li>从已经创建的容器中更新镜像，并且提交这个镜像</li><li>使用 Dockerfile 指令来创建一个新的镜像</li></ol><h3 id="更新镜像"><a href="#更新镜像" class="headerlink" title="更新镜像"></a>更新镜像</h3><p>更新镜像之前，需要使用镜像来创建一个容器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -t -i ubuntu:15.10 /bin/bash</span></span><br><span class="line">root@387f1a8b1d86:/<span class="comment"># apt-get update</span></span><br></pre></td></tr></table></figure><p>在运行的容器内使用 apt-get update 命令进行更新。在完成操作之后，输入 exit命令来退出这个容器。</p><p>此时ID为387f1a8b1d86的容器，是按我们的需求更改的容器。我们可以通过命令 docker commit来提交容器副本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker commit -m="update" -a="sandu" 387f1a8b1d86 sandu/ubuntu:v2</span></span><br><span class="line">sha256:02c1ed8e875ca80c6089694e486e3e0b39833b55c8252bc62bf019eb9c8b4bde</span><br></pre></td></tr></table></figure><p>各个参数说明：</p><ul><li>-m:提交的描述信息</li><li>-a:指定镜像作者</li><li>387f1a8b1d86：容器ID</li><li>sandu/ubuntu:v2:指定要创建的目标镜像名</li><li>v2：表示的是TAG</li></ul><p>然后可以使用 docker images 命令来查看我们的新镜像 sandu/ubuntu:v2：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        About a minute ago   137MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago          109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago          188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago         202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago         1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago          137MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago          349MB</span><br></pre></td></tr></table></figure><p></p><p>使用我们的新镜像 sandu/ubuntu来启动一个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -t -i sandu/ubuntu:v2 /bin/bash</span></span><br><span class="line">root@f396a8f61f80:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>使用命令 docker build ， 从零开始来创建一个新的镜像。首先需要创建一个 Dockerfile 文件，其中包含一组指令来告诉 Docker 如何构建我们的镜像。</p><p>注意：这里使用一个使用flask框架的后台模板，<a href="https://github.com/afourmy/flask-gentelella" target="_blank" rel="noopener">GitHub地址</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat Dockerfile</span></span><br><span class="line">FROM python:3.6</span><br><span class="line"></span><br><span class="line">ENV FLASK_APP gentelella.py</span><br><span class="line"></span><br><span class="line">COPY gentelella.py gunicorn.py requirements.txt config.py .env ./</span><br><span class="line">COPY app app</span><br><span class="line">COPY migrations migrations</span><br><span class="line"></span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line">EXPOSE 5000</span><br><span class="line">CMD [<span class="string">"gunicorn"</span>, <span class="string">"--config"</span>, <span class="string">"gunicorn.py"</span>, <span class="string">"gentelella:app"</span>]</span><br></pre></td></tr></table></figure><p>每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。<br>第一条FROM，指定使用哪个镜像源<br>RUN 指令告诉docker 在镜像内执行命令，安装了什么<br>然后使用 Dockerfile 文件，通过 docker build 命令来构建一个镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost flask-gentelella-master]<span class="comment"># docker build -t sandu/python:3.6 .</span></span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li>-t ：指定要创建的目标镜像名</li><li><strong>.</strong> ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li></ul><p>使用docker images 查看创建的镜像已经在列表中存在,镜像ID为3fc000939e8e<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sandu/python        3.6                 3fc000939e8e        7 minutes ago       1.05GB</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        About an hour ago   137MB</span><br><span class="line">python              3.6                 f93001dcf9ed        9 hours ago         924MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago         188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure><p></p><p>可以使用新的镜像来创建容器<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -p 5000:5000 --name gentelella --restart always sandu/python:3.6</span></span><br><span class="line">de249d54cf992151db57c27d99b7f127bb6017b5233e2c7f97e36ebc97cae342</span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">de249d54cf99        sandu/python:3.6    <span class="string">"gunicorn --config g…"</span>   5 seconds ago       Up 3 seconds        0.0.0.0:5000-&gt;5000/tcp   gentelella</span><br></pre></td></tr></table></figure><p></p><h3 id="设置镜像标签"><a href="#设置镜像标签" class="headerlink" title="设置镜像标签"></a>设置镜像标签</h3><p>可以使用 docker tag 命令，为镜像添加一个新的标签。</p><p>docker tag 镜像ID，这里是 3fc000939e8e ,用户名称、镜像源名(repository name)和新的标签名(tag)。</p><p>使用 docker images 命令可以看到，ID为3fc000939e8e的镜像多一个pro标签。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sandu/python        3.6                 3fc000939e8e        16 minutes ago      1.05GB</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        About an hour ago   137MB</span><br><span class="line">python              3.6                 f93001dcf9ed        9 hours ago         924MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago         188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br><span class="line">[root@localhost ~]<span class="comment"># docker tag 3fc000939e8e sandu/python:pro</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sandu/python        3.6                 3fc000939e8e        17 minutes ago      1.05GB</span><br><span class="line">sandu/python        pro                 3fc000939e8e        17 minutes ago      1.05GB</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        About an hour ago   137MB</span><br><span class="line">python              3.6                 f93001dcf9ed        9 hours ago         924MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago         188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure><h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><ol start="2"><li><ol><li>查看本地docker镜像<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sandu/python        3.6                 3fc000939e8e        2 hours ago         1.05GB</span><br><span class="line">sandu/python        pro                 3fc000939e8e        2 hours ago         1.05GB</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        3 hours ago         137MB</span><br><span class="line">python              3.6                 f93001dcf9ed        11 hours ago        924MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago         188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></li></ol></li><li><p>尝试删除本地镜像，发现无法直接删除镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rmi training/webapp</span></span><br><span class="line">Error response from daemon: conflict: unable to remove repository reference <span class="string">"training/webapp"</span> (must force) - container ab3dc2ea8033 is using its referenced image 6fae60ef3446</span><br></pre></td></tr></table></figure></li><li><p>原因分析: 有关联docker容器，无法删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看镜像和容器的关联信息</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></span><br></pre></td></tr></table></figure></li><li><p>删除docker容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先停止容器，然后再删除</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker stop ab3dc2ea8033</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker rm ab3dc2ea8033</span></span><br><span class="line">ab3dc2ea8033</span><br></pre></td></tr></table></figure></li><li><p>删除docker镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rmi training/webapp</span></span><br><span class="line">Untagged: training/webapp:latest</span><br><span class="line">Untagged: training/webapp@sha256:06e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d</span><br><span class="line">Deleted: sha256:6fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557</span><br><span class="line">Deleted: sha256:875bde2b9e2d99e7c1362993645a474fe621475c6fc1b1623c9ed5312b7bdeae</span><br><span class="line">Deleted: sha256:bbdb5ee3757ef8f2633694016df5840fc3410422b37c22f98c0300e295ce75cc</span><br><span class="line">Deleted: sha256:d718446240e3f48a904ad4bbf2a1f61737c5d70df35b8210d674a9517cdc9803</span><br><span class="line">Deleted: sha256:a890440f4933412f9aafb056eb2f07f2276ed756631a81e960d4a8a6de5857a3</span><br><span class="line">Deleted: sha256:68a74799a9e67953725058ef21a530f100025088943446aa60c73fba7beebd47</span><br><span class="line">Deleted: sha256:b23e4b6b440d0e9ab4ffd7852fbf81edd6d5eb606e24d4950d83502e14af2856</span><br><span class="line">Deleted: sha256:f115b0453c71fb4d21fdb6f579201984bd5033ae28ed5908978576a19282418b</span><br><span class="line">Deleted: sha256:b0da82df3229cd06a2992449f2310caaa42f09fdfb088f4a98c5ea587ea85c7e</span><br><span class="line">Deleted: sha256:f6f162dad6e64715d3d07e21d4574733860a557f2f89228d07909c1f6f04e882</span><br><span class="line">Deleted: sha256:088f9eb16f16713e449903f7edb4016084de8234d73a45b1882cf29b1f753a5a</span><br><span class="line">Deleted: sha256:799115b9fdd1511e8af8a8a3c8b450d81aa842bbf3c9f88e9126d264b232c598</span><br><span class="line">Deleted: sha256:3549adbf614379d5c33ef0c5c6486a0d3f577ba3341f573be91b4ba1d8c60ce4</span><br><span class="line">Deleted: sha256:1154ba695078d29ea6c4e1adb55c463959cd77509adf09710e2315827d66271a</span><br></pre></td></tr></table></figure></li><li><p>删除成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sandu/python        3.6                 3fc000939e8e        2 hours ago         1.05GB</span><br><span class="line">sandu/python        pro                 3fc000939e8e        2 hours ago         1.05GB</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        3 hours ago         137MB</span><br><span class="line">python              3.6                 f93001dcf9ed        11 hours ago        924MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago         188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br></pre></td></tr></table></figure></li><li><p>批量删除所有镜像</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rmi `docker images -q`</span></span><br></pre></td></tr></table></figure><h2 id="Docker-容器连接"><a href="#Docker-容器连接" class="headerlink" title="Docker 容器连接"></a>Docker 容器连接</h2><h3 id="网络端口映射"><a href="#网络端口映射" class="headerlink" title="网络端口映射"></a>网络端口映射</h3><p>使用 -P 参数创建一个容器，使用 docker ps 可以看到容器端口 5000 绑定主机端口 32770。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -P --name gentelella --restart always sandu/python:3.6</span></span><br><span class="line">f386d3fcef079f51668f583cf88e6b20b5961a62502d2a1c09c6ed17ae526617</span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">f386d3fcef07        sandu/python:3.6    <span class="string">"gunicorn --config g…"</span>   5 seconds ago       Up 4 seconds        0.0.0.0:32770-&gt;5000/tcp   gentelella</span><br></pre></td></tr></table></figure><p></p><p>也可以使用 -p 标识来指定容器端口绑定到主机端口。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -p 32768:5000 --name gentelella --restart always sandu/python:3.6   </span></span><br><span class="line">90680982825f131b6f950e3ad8543ddd51a76b07b75345376a852fe886c28754</span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">90680982825f        sandu/python:3.6    <span class="string">"gunicorn --config g…"</span>   4 seconds ago       Up 3 seconds        0.0.0.0:32768-&gt;5000/tcp   gentelella</span><br></pre></td></tr></table></figure><p>两种方式的区别是:</p><ul><li>-P :是容器内部端口随机映射到主机的高端口。</li><li>-p : 是容器内部端口绑定到指定的主机端口。(主机端口：容器内部端口)</li></ul><p>可以指定容器绑定的网络地址，比如绑定 127.0.0.1。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -p 127.0.0.1:32768:5000 --name gentelella --restart always sandu/python:3.6</span></span><br><span class="line">f4ff4bc6239e944b0683dd9c81f8af78793e69f02ace5ef3a251ee88cd296d93</span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                       NAMES</span><br><span class="line">f4ff4bc6239e        sandu/python:3.6    <span class="string">"gunicorn --config g…"</span>   4 seconds ago       Up 3 seconds        127.0.0.1:32768-&gt;5000/tcp   gentelella</span><br></pre></td></tr></table></figure><p></p><p>这样我们就可以通过访问 127.0.0.1:32768 来访问容器的 5000 端口。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止并删除容器</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker stop gentelella</span></span><br><span class="line">gentelella</span><br><span class="line">[root@localhost ~]<span class="comment"># docker rm gentelella</span></span><br><span class="line">gentelella</span><br></pre></td></tr></table></figure><p>默认都是绑定 tcp 端口，如果要绑定 UDP 端口，可以在端口后面加上 /udp。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -p 127.0.0.1:32768:5000/udp --name gentelella --restart always sandu/python:3.6</span></span><br><span class="line">17683315e22f1c9c611fea955bd2824a6d324ee2d5f8647a9f5811f73339b1b1</span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                 NAMES</span><br><span class="line">17683315e22f        sandu/python:3.6    <span class="string">"gunicorn --config g…"</span>   4 seconds ago       Up 3 seconds        5000/tcp, 127.0.0.1:32768-&gt;5000/udp   gentelella</span><br></pre></td></tr></table></figure><p></p><p>docker port 命令可以让我们快捷地查看端口的绑定情况。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认是tcp端口，查看udp端口的话需要在最后加上/udp</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker port gentelella 5000</span></span><br><span class="line">Error: No public port <span class="string">'5000/tcp'</span> published <span class="keyword">for</span> gentelella</span><br><span class="line">[root@localhost ~]<span class="comment"># docker port gentelella 5000/udp</span></span><br><span class="line">127.0.0.1:32768</span><br></pre></td></tr></table></figure><h3 id="Docker容器连接"><a href="#Docker容器连接" class="headerlink" title="Docker容器连接"></a>Docker容器连接</h3><p>端口映射并不是唯一把 docker 连接到另一个容器的方法。<br>docker 有一个连接系统允许将多个容器连接在一起，共享连接信息。<br>docker 连接会创建一个父子关系，其中父容器可以看到子容器的信息。</p><h4 id="容器命名"><a href="#容器命名" class="headerlink" title="容器命名"></a>容器命名</h4><p>当我们创建一个容器的时候，docker 会自动对它进行命名。另外，我们也可以使用 –name 标识来命名容器，例如：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -p 127.0.0.1:32768:5000 --name gentelella --restart always sandu/python:3.6</span></span><br><span class="line">f4ff4bc6239e944b0683dd9c81f8af78793e69f02ace5ef3a251ee88cd296d93</span><br></pre></td></tr></table></figure><p></p><p>可以使用 docker ps 命令来查看容器名称。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                       NAMES</span><br><span class="line">f4ff4bc6239e        sandu/python:3.6    <span class="string">"gunicorn --config g…"</span>   4 seconds ago       Up 3 seconds        127.0.0.1:32768-&gt;5000/tcp   gentelella</span><br></pre></td></tr></table></figure><p></p><h1 id="Docker实例"><a href="#Docker实例" class="headerlink" title="Docker实例"></a>Docker实例</h1><h2 id="Docker-安装-Nginx"><a href="#Docker-安装-Nginx" class="headerlink" title="Docker 安装 Nginx"></a>Docker 安装 Nginx</h2><h3 id="docker-pull-nginx-命令安装"><a href="#docker-pull-nginx-命令安装" class="headerlink" title="docker pull nginx 命令安装"></a>docker pull nginx 命令安装</h3><p>查找 <a href="https://hub.docker.com/r/library/nginx/" target="_blank" rel="noopener">Docker Hub</a> 上的 nginx 镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search nginx</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                             Official build of Nginx.                        11676               [OK]                </span><br><span class="line">jwilder/nginx-proxy               Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   1627                                    [OK]</span><br><span class="line">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   726                                     [OK]</span><br><span class="line">bitnami/nginx                     Bitnami nginx Docker Image                      69                                      [OK]</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>拉取官方的镜像<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull nginx</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">Digest: sha256:48cbeee0cb0a3b5e885e36222f969e0a2f41819a68e07aeb6631ca7cb356fed1</span><br><span class="line">Status: Image is up to date <span class="keyword">for</span> nginx:latest</span><br></pre></td></tr></table></figure><p></p><p>等待下载完成后，我们就可以在本地镜像列表里查到 REPOSITORY 为 nginx 的镜像。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images nginx</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br></pre></td></tr></table></figure><p></p><p>以下命令使用 NGINX 默认的配置来启动一个 Nginx 容器实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run --name test_docker_nginx -p 8081:80 -d nginx</span></span><br><span class="line">c30cd0d51b31eaf3999ceee9724c269858e80417e8f0f03049127886f9b38134</span><br></pre></td></tr></table></figure><p>参数解析：</p><ul><li>test_docker_nginx：容器名称</li><li>-d：设置容器在后台一直运行</li><li>-p：端口进行映射，将本地的8081端口映射到容器内部的80端口</li></ul><p>执行以上命令会生成一串字符串，类似c30cd0d51b31eaf3999ceee9724c269858e80417e8f0f03049127886f9b38134**，这个表示容器的 ID，一般可作为日志的文件名。</p><p>我们可以使用 docker ps 命令查看容器是否有在运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">c30cd0d51b31        nginx               <span class="string">"nginx -g 'daemon of…"</span>   4 seconds ago       Up 3 seconds        0.0.0.0:8081-&gt;80/tcp   test_docker_nginx</span><br></pre></td></tr></table></figure><p>PORTS 部分表示端口映射，本地的 8081 端口映射到容器内部的 80 端口。</p><p>在浏览器中打开 <a href="http://127.0.0.1:8081/" target="_blank" rel="noopener">http://127.0.0.1:8081/</a> , 效果如下：<br><img src="/Docker_images/docker08.png" alt></p><h3 id="nginx-部署"><a href="#nginx-部署" class="headerlink" title="nginx 部署"></a>nginx 部署</h3><p>首先，创建目录 nginx, 用于存放后面的相关东西。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p /home/nginx/www /home/nginx/logs /home/nginx/conf</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd /home/</span></span><br><span class="line">[root@localhost home]<span class="comment"># ll</span></span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 6 root root 4096 Jul 12 05:55 flask-gentelella-master</span><br><span class="line">drwxr-xr-x. 5 root root   41 Jul 12 07:47 nginx</span><br></pre></td></tr></table></figure><p></p><p>拷贝容器内 Nginx 默认配置文件到本地当前目录下的 conf 目录，容器 ID 可以查看 docker ps 命令输入中的第一列：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">c30cd0d51b31        nginx               <span class="string">"nginx -g 'daemon of…"</span>   4 seconds ago       Up 3 seconds        0.0.0.0:8081-&gt;80/tcp   test_docker_nginx</span><br><span class="line">[root@localhost home]<span class="comment"># docker cp c30cd0d51b31:/etc/nginx/nginx.conf /home/nginx/conf/</span></span><br></pre></td></tr></table></figure><p></p><h3 id="部署命令"><a href="#部署命令" class="headerlink" title="部署命令"></a>部署命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker run -d -p 8081:80 --name test_docker_nginx_web -v /home/nginx/www:/usr/share/nginx/html -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /home/nginx/logs:/var/log/nginx nginx</span></span><br><span class="line">9c2fdc3888538ada9d904c0832c39487269185fea3bc9e0179326ccb7753bb98</span><br><span class="line">[root@localhost home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">9c2fdc388853        nginx               <span class="string">"nginx -g 'daemon of…"</span>   3 seconds ago       Up 2 seconds        0.0.0.0:8081-&gt;80/tcp   test_docker_nginx_web</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-p 8081:80： 将容器的 80 端口映射到主机的 8081 端口。</li><li>–name test_docker_nginx_web：将容器命名为test_docker_nginx_web。</li><li>-v /home/nginx/www:/usr/share/nginx/html：将我们自己创建的 www 目录挂载到容器的 /usr/share/nginx/html。</li><li>-v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf：将我们自己创建的 nginx.conf 挂载到容器的 /etc/nginx/nginx.conf。</li><li>-v /home/nginx/logs:/var/log/nginx：将我们自己创建的 logs 挂载到容器的 /var/log/nginx。</li></ul><p>启动以上命令后进入 /home/nginx/www 目录，创建 index.html 文件，内容如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Docker教程<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用浏览器访问，输出结果如下：</p><p><img src="/Docker_images/docker09.png" alt></p><h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><p>重新载入 NGINX 可以使用以下命令发送 HUP 信号到容器：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker kill -s HUP container-name</span></span><br><span class="line">[root@localhost www]<span class="comment"># docker kill -s HUP test_docker_nginx_web</span></span><br><span class="line">test_docker_nginx_web</span><br></pre></td></tr></table></figure><p></p><p>重启 NGINX 容器命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker restart container-name</span></span><br><span class="line">[root@localhost www]<span class="comment"># docker restart test_docker_nginx_web</span></span><br><span class="line">test_docker_nginx_web</span><br></pre></td></tr></table></figure><p></p><h2 id="Docker-安装-PHP"><a href="#Docker-安装-PHP" class="headerlink" title="Docker 安装 PHP"></a>Docker 安装 PHP</h2><h3 id="安装-PHP-镜像"><a href="#安装-PHP-镜像" class="headerlink" title="安装 PHP 镜像"></a>安装 PHP 镜像</h3><h4 id="方法一、docker-pull-php"><a href="#方法一、docker-pull-php" class="headerlink" title="方法一、docker pull php"></a>方法一、docker pull php</h4><p>查找Docker Hub上的php镜像<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost www]<span class="comment"># docker search php</span></span><br><span class="line">NAME                            DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">php                             While designed <span class="keyword">for</span> web development, the PHP …   4607                [OK]                </span><br><span class="line">phpmyadmin/phpmyadmin           A web interface <span class="keyword">for</span> MySQL and MariaDB.          816                                     [OK]</span><br><span class="line">php-zendserver                  Zend Server - the integrated PHP application…   168                 [OK]                </span><br><span class="line">webdevops/php-nginx             Nginx with PHP-FPM                              132                                     [OK]</span><br><span class="line">webdevops/php-apache-dev        PHP with Apache <span class="keyword">for</span> Development (eg. with xd…   105                                     [OK]</span><br></pre></td></tr></table></figure><p></p><p>拉取官方的镜像,标签为5.6-fpm<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull php:5.6-fpm</span></span><br><span class="line">5.6-fpm: Pulling from library/php</span><br><span class="line">5e6ec7f28fb7: Pull complete </span><br><span class="line">cf165947b5b7: Pull complete </span><br><span class="line">7bd37682846d: Pull complete </span><br><span class="line">99daf8e838e1: Pull complete </span><br><span class="line">f8628c9f032f: Pull complete </span><br><span class="line">50ff925cdfa2: Pull complete </span><br><span class="line">6ab76f312877: Pull complete </span><br><span class="line">28ea94b4dd82: Pull complete </span><br><span class="line">a6dbb35d45d2: Pull complete </span><br><span class="line">98b901ec9e8d: Pull complete </span><br><span class="line">Digest: sha256:4f070f1b7b93cc5ab364839b79a5b26f38d5f89461f7bc0cd4bab4a3ad7d67d7</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> php:5.6-fpm</span><br></pre></td></tr></table></figure><p></p><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为php,标签为5.6-fpm的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sandu/python        3.6                 3fc000939e8e        2 hours ago         1.05GB</span><br><span class="line">sandu/python        pro                 3fc000939e8e        2 hours ago         1.05GB</span><br><span class="line">sandu/ubuntu        v2                  02c1ed8e875c        3 hours ago         137MB</span><br><span class="line">python              3.6                 f93001dcf9ed        11 hours ago        924MB</span><br><span class="line">nginx               latest              f68d6e55e065        10 days ago         109MB</span><br><span class="line">ubuntu              14.04               2c5e00d77a67        8 weeks ago         188MB</span><br><span class="line">centos              latest              9f38484d220f        3 months ago        202MB</span><br><span class="line">php                 5.6-fpm             3458979c7744        5 months ago        344MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        2 years ago         137MB</span><br></pre></td></tr></table></figure><h3 id="Nginx-PHP-部署"><a href="#Nginx-PHP-部署" class="headerlink" title="Nginx + PHP  部署"></a>Nginx + PHP 部署</h3><p>启动 PHP：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run --name test_docker_php -v /home/nginx/www/:/www:ro -d php:5.6-fpm</span></span><br><span class="line">dea92165f3271ed8a0651fdd6ef1738f321b462a2cba0cd2eee9e3885a315325</span><br></pre></td></tr></table></figure><p></p><p>命令说明：</p><ul><li>–name test_docker_php : 将容器命名为test_docker_php。</li><li>-v /home/nginx/www:/www : 将主机中项目的目录 www 挂载到容器的 /www，ro 表示只读</li></ul><p>创建 /home/nginx/conf/conf.d 目录：<br><code>[root@localhost ~]# mkdir -p /home/nginx/conf/conf.d</code></p><p>在该目录下添加 /home/nginx/conf/conf.d/test_docker_php.conf 文件，内容如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass   php:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  /www/$fastcgi_script_name;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>配置文件说明：</p><ul><li>php:9000: 表示 php-fpm 服务的 URL。</li><li>/www/: 是 test_docker_php中 php 文件的存储路径，映射到本地的 /home/nginx/www 目录。</li></ul><p>启动 Nginx ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf.d]<span class="comment"># docker run -d -p 8081:80 --name test_docker_nginx_web -v /home/nginx/www:/usr/share/nginx/html:ro -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf:ro  -v /home/nginx/conf/conf.d:/etc/nginx/conf.d:ro -v /home/nginx/logs:/var/log/nginx --link test_docker_php:php nginx</span></span><br><span class="line">4737055f929d939b1201b1c215b011f2673e65e6bc2e769190cfee95ffb1458c</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-p 8081:80: 端口映射，把 nginx 中的 80 映射到本地的 8083 端口。</li><li>/home/nginx/www: 是本地 html 文件的存储目录，/usr/share/nginx/html 是容器内 html 文件的存储目录。</li><li>/home/nginx/conf/conf.d: 是本地 nginx 配置文件的存储目录，/etc/nginx/conf.d 是容器内 nginx 配置文件的存储目录。</li><li>–link test_docker_php:php: 把 test_docker_php 的网络并入 nginx，并通过修改 nginx 的 /etc/hosts，把域名 php 映射成 127.0.0.1，让 nginx 通过 php:9000 访问 php-fpm。</li></ul><p>接下来我们在 /home/nginx/www 目录下创建 index.php，代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>浏览器打开 <a href="http://ip:8081/index.php" target="_blank" rel="noopener">http://ip:8081/index.php</a> ，显示如下：<br><img src="/Docker_images/docker10.png" alt></p><h3 id="要点总结"><a href="#要点总结" class="headerlink" title="要点总结"></a>要点总结</h3><ol><li>php容器路径是/www，对应本机的web目录/home/nginx/www/</li><li>nginx容器web路径是/usr/share/nginx/html，对应本机web目录/home/nginx/www/</li><li>nginx容器配置文件/etc/nginx/nginx.conf，对应本机/home/nginx/conf/nginx.conf</li><li>nginx容器配置文件/etc/nginx/conf.d路径，对应本机/home/nginx/conf/conf.d路径</li><li>运行php容器时需要把php容器路径跟本机web路径做映射</li><li>运行nginx容器时需要把nginx容器相关的路径跟本机路径做映射</li><li>nginx容器关联有php容易，所以先启动php容器，然后再启动nginx容器，否则会报错：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先启动php容器，然后再启动nginx容器</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS                    NAMES</span><br><span class="line">ff21bd0345f4        mysql:5.6           <span class="string">"docker-entrypoint.s…"</span>   2 days ago          Exited (255) 30 seconds ago   0.0.0.0:3306-&gt;3306/tcp   test_docker_mysql</span><br><span class="line">4737055f929d        nginx               <span class="string">"nginx -g 'daemon of…"</span>   2 days ago          Exited (255) 30 seconds ago   0.0.0.0:8081-&gt;80/tcp     test_docker_nginx_web</span><br><span class="line">b4901afbf62e        php:5.6-fpm         <span class="string">"docker-php-entrypoi…"</span>   2 days ago          Exited (255) 30 seconds ago   9000/tcp                 test_docker_php</span><br><span class="line">[root@localhost ~]<span class="comment"># docker start 4737055f929d</span></span><br><span class="line">Error response from daemon: Cannot link to a non running container: /test_docker_php AS /test_docker_nginx_web/php</span><br><span class="line">Error: failed to start containers: 4737055f929d</span><br><span class="line">[root@localhost ~]<span class="comment"># docker start b4901afbf62e</span></span><br><span class="line">b4901afbf62e</span><br><span class="line">[root@localhost ~]<span class="comment"># docker start 4737055f929d</span></span><br><span class="line">4737055f929d</span><br></pre></td></tr></table></figure><p>相互关系如下图所示：<br><img src="/Docker_images/docker11.png" alt></p><h2 id="Docker-安装-MySQL"><a href="#Docker-安装-MySQL" class="headerlink" title="Docker 安装 MySQL"></a>Docker 安装 MySQL</h2><h3 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h3><h4 id="方法一、docker-pull-mysql"><a href="#方法一、docker-pull-mysql" class="headerlink" title="方法一、docker pull mysql"></a>方法一、docker pull mysql</h4><p>查找Docker Hub上的mysql镜像<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search mysql</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   8385                [OK]                </span><br><span class="line">mariadb                           MariaDB is a community-developed fork of MyS…   2882                [OK]                </span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   624                                     [OK]</span><br><span class="line">percona                           Percona Server is a fork of the MySQL relati…   438                 [OK]                </span><br><span class="line">centurylink/mysql                 Image containing mysql. Optimized to be link…   60                                      [OK]</span><br></pre></td></tr></table></figure><p></p><p>拉取官方的镜像,标签为5.6<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull mysql:5.6</span></span><br></pre></td></tr></table></figure><p></p><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为mysql,标签为5.6的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images | grep mysql</span></span><br><span class="line">mysql               5.6                 3ed1080b793f        4 weeks ago         256MB</span><br></pre></td></tr></table></figure><h4 id="方法二、通过-Dockerfile构建"><a href="#方法二、通过-Dockerfile构建" class="headerlink" title="方法二、通过 Dockerfile构建"></a>方法二、通过 Dockerfile构建</h4><p>首先，创建目录mysql,用于存放后面的相关东西。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p ~/mysql/data ~/mysql/logs ~/mysql/conf</span></span><br></pre></td></tr></table></figure><p></p><p>命令说明：</p><ul><li>data目录将映射为mysql容器配置的数据文件存放路径</li><li>logs目录将映射为mysql容器的日志目录</li><li>conf目录里的配置文件将映射为mysql容器的配置文件</li></ul><p>进入创建的mysql目录，创建Dockerfile，这个是以Ubuntu系统为参考，CentOS系统使用的话需要修改<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:jessie</span><br><span class="line"></span><br><span class="line"><span class="comment"># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> groupadd -r mysql &amp;&amp; useradd -r -g mysql mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add gosu for easy step-down from root</span></span><br><span class="line"><span class="keyword">ENV</span> GOSU_VERSION <span class="number">1.7</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -x \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y --no-install-recommends ca-certificates wget &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -O /usr/<span class="built_in">local</span>/bin/gosu <span class="string">"https://github.com/tianon/gosu/releases/download/<span class="variable">$GOSU_VERSION</span>/gosu-<span class="variable">$(dpkg --print-architecture)</span>"</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -O /usr/<span class="built_in">local</span>/bin/gosu.asc <span class="string">"https://github.com/tianon/gosu/releases/download/<span class="variable">$GOSU_VERSION</span>/gosu-<span class="variable">$(dpkg --print-architecture)</span>.asc"</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">export</span> GNUPGHOME=<span class="string">"<span class="variable">$(mktemp -d)</span>"</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; gpg --batch --verify /usr/<span class="built_in">local</span>/bin/gosu.asc /usr/<span class="built_in">local</span>/bin/gosu \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -r <span class="string">"<span class="variable">$GNUPGHOME</span>"</span> /usr/<span class="built_in">local</span>/bin/gosu.asc \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chmod +x /usr/<span class="built_in">local</span>/bin/gosu \</span></span><br><span class="line"><span class="bash">    &amp;&amp; gosu nobody <span class="literal">true</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove ca-certificates wget</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /docker-entrypoint-initdb.d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FATAL ERROR: please install the following Perl modules before executing /usr/local/mysql/scripts/mysql_install_db:</span></span><br><span class="line"><span class="comment"># File::Basename</span></span><br><span class="line"><span class="comment"># File::Copy</span></span><br><span class="line"><span class="comment"># Sys::Hostname</span></span><br><span class="line"><span class="comment"># Data::Dumper</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y perl pwgen --no-install-recommends &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gpg: key 5072E1F5: public key "MySQL Release Engineering &lt;mysql-build@oss.oracle.com&gt;" imported</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-key adv --keyserver ha.pool.sks-keyservers.net --recv-keys A4A9406876FCBD3C456770C88C718D3B5072E1F5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYSQL_MAJOR <span class="number">5.6</span></span><br><span class="line"><span class="keyword">ENV</span> MYSQL_VERSION <span class="number">5.6</span>.<span class="number">31</span>-<span class="number">1</span>debian8</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb http://repo.mysql.com/apt/debian/ jessie mysql-<span class="variable">$&#123;MYSQL_MAJOR&#125;</span>"</span> &gt; /etc/apt/sources.list.d/mysql.list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the "/var/lib/mysql" stuff here is because the mysql-server postinst doesn't have an explicit way to disable the mysql_install_db codepath besides having a database already "configured" (ie, stuff in /var/lib/mysql/mysql)</span></span><br><span class="line"><span class="comment"># also, we set debconf keys to make APT a little quieter</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> &#123; \</span></span><br><span class="line"><span class="bash">        <span class="built_in">echo</span> mysql-community-server mysql-community-server/data-dir select <span class="string">''</span>; \</span></span><br><span class="line"><span class="bash">        <span class="built_in">echo</span> mysql-community-server mysql-community-server/root-pass password <span class="string">''</span>; \</span></span><br><span class="line"><span class="bash">        <span class="built_in">echo</span> mysql-community-server mysql-community-server/re-root-pass password <span class="string">''</span>; \</span></span><br><span class="line"><span class="bash">        <span class="built_in">echo</span> mysql-community-server mysql-community-server/remove-test-db select <span class="literal">false</span>; \</span></span><br><span class="line"><span class="bash">    &#125; | debconf-set-selections \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y mysql-server=<span class="string">"<span class="variable">$&#123;MYSQL_VERSION&#125;</span>"</span> &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/mysql &amp;&amp; mkdir -p /var/lib/mysql /var/run/mysqld \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chown -R mysql:mysql /var/lib/mysql /var/run/mysqld \</span></span><br><span class="line"><span class="bash"><span class="comment"># ensure that /var/run/mysqld (used for socket and lock files) is writable regardless of the UID our mysqld instance ends up having at runtime</span></span></span><br><span class="line">    &amp;&amp; chmod <span class="number">777</span> /var/<span class="keyword">run</span><span class="bash">/mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># comment out a few problematic configuration values</span></span><br><span class="line"><span class="comment"># don't reverse lookup hostnames, they are usually another container</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -Ei <span class="string">'s/^(bind-address|log)/#&amp;/'</span> /etc/mysql/my.cnf \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">'skip-host-cache\nskip-name-resolve'</span> | awk <span class="string">'&#123; print &#125; $1 == "[mysqld]" &amp;&amp; c == 0 &#123; c = 1; system("cat") &#125;'</span> /etc/mysql/my.cnf &gt; /tmp/my.cnf \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv /tmp/my.cnf /etc/mysql/my.cnf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> docker-entrypoint.sh /usr/<span class="built_in">local</span>/bin/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -s usr/<span class="built_in">local</span>/bin/docker-entrypoint.sh /entrypoint.sh <span class="comment"># backwards compat</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"docker-entrypoint.sh"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3306</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"mysqld"</span>]</span></span><br></pre></td></tr></table></figure><p></p><p>通过Dockerfile创建一个镜像，替换成你自己的名字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker build -t mysql .</span></span><br></pre></td></tr></table></figure><p>创建完成后，我们可以在本地的镜像列表里查找到刚刚创建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images |grep mysql</span></span><br><span class="line">mysql               5.6                 2c0964ec182a        3 minutes ago         329 MB</span><br></pre></td></tr></table></figure><h3 id="使用mysql镜像"><a href="#使用mysql镜像" class="headerlink" title="使用mysql镜像"></a>使用mysql镜像</h3><h4 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如下这个命令是使用本地目录跟MySQL镜像目录想匹配的，使用官方MySQL镜像可以直接使用，若是使用上述自定的的dockfile创建爱你的MySQL镜像，需要把路径换成实际创建时使用的路径</span></span><br><span class="line">[root@localhost home]<span class="comment"># mkdir mysql</span></span><br><span class="line">[root@localhost home]<span class="comment"># cd mysql</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker run -p 3306:3306 --name test_docker_mysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6</span></span><br><span class="line">ff21bd0345f43b46e148f40ecbcc129683bccfd7fbd5fe9778332e12ffc49ed6</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-p 3306:3306：将容器的 3306 端口映射到主机的 3306 端口。</li><li>-v -v $PWD/conf:/etc/mysql/conf.d：将主机当前目录下的 conf/my.cnf 挂载到容器的 /etc/mysql/my.cnf。</li><li>-v $PWD/logs:/logs：将主机当前目录下的 logs 目录挂载到容器的 /logs。</li><li>-v $PWD/data:/var/lib/mysql ：将主机当前目录下的data目录挂载到容器的 /var/lib/mysql 。</li><li>-e MYSQL_ROOT_PASSWORD=123456：初始化 root 用户的密码。</li></ul><h4 id="查看容器启动情况"><a href="#查看容器启动情况" class="headerlink" title="查看容器启动情况"></a>查看容器启动情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前正在运行的容器，发现没有MySQL容器</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">4737055f929d        nginx               <span class="string">"nginx -g 'daemon of…"</span>   37 minutes ago      Up 37 minutes       0.0.0.0:8081-&gt;80/tcp   test_docker_nginx_web</span><br><span class="line">b4901afbf62e        php:5.6-fpm         <span class="string">"docker-php-entrypoi…"</span>   About an hour ago   Up About an hour    9000/tcp               test_docker_php</span><br><span class="line"><span class="comment"># 再次运行MySQL容器，报错，说是容器名已经存在</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker run -p 3306:3306 --name test_docker_mysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6</span></span><br><span class="line">docker: Error response from daemon: Conflict. The container name <span class="string">"/test_docker_mysql"</span> is already <span class="keyword">in</span> use by container <span class="string">"ff21bd0345f43b46e148f40ecbcc129683bccfd7fbd5fe9778332e12ffc49ed6"</span>. You have to remove (or rename) that container to be able to reuse that name.</span><br><span class="line">See <span class="string">'docker run --help'</span>.</span><br><span class="line"><span class="comment"># 查看所有容器，发现有MySQL容器，状态是Exited</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                          PORTS                  NAMES</span><br><span class="line">ff21bd0345f4        mysql:5.6           <span class="string">"docker-entrypoint.s…"</span>   2 minutes ago       Exited (1) About a minute ago                          test_docker_mysql</span><br><span class="line">4737055f929d        nginx               <span class="string">"nginx -g 'daemon of…"</span>   38 minutes ago      Up 38 minutes                   0.0.0.0:8081-&gt;80/tcp   test_docker_nginx_web</span><br><span class="line">b4901afbf62e        php:5.6-fpm         <span class="string">"docker-php-entrypoi…"</span>   About an hour ago   Up About an hour                9000/tcp               test_docker_php</span><br><span class="line"><span class="comment"># 启动MySQL容器</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker start ff21bd0345f4</span></span><br><span class="line">ff21bd0345f4</span><br><span class="line"><span class="comment"># 查看当前正在运行的容器，看到MySQL容器已经运行</span></span><br><span class="line">[root@localhost mysql]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ff21bd0345f4        mysql:5.6           <span class="string">"docker-entrypoint.s…"</span>   3 minutes ago       Up 21 seconds       0.0.0.0:3306-&gt;3306/tcp   test_docker_mysql</span><br><span class="line">4737055f929d        nginx               <span class="string">"nginx -g 'daemon of…"</span>   38 minutes ago      Up 38 minutes       0.0.0.0:8081-&gt;80/tcp     test_docker_nginx_web</span><br><span class="line">b4901afbf62e        php:5.6-fpm         <span class="string">"docker-php-entrypoi…"</span>   About an hour ago   Up About an hour    9000/tcp                 test_docker_php</span><br></pre></td></tr></table></figure><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><h4 id="最新官方MySQL-5-7-19-的docker镜像在创建时映射的配置文件目录有所不同"><a href="#最新官方MySQL-5-7-19-的docker镜像在创建时映射的配置文件目录有所不同" class="headerlink" title="最新官方MySQL(5.7.19)的docker镜像在创建时映射的配置文件目录有所不同"></a>最新官方MySQL(5.7.19)的docker镜像在创建时映射的配置文件目录有所不同</h4><p>MySQL(5.7.19)的默认配置文件是 /etc/mysql/my.cnf 文件。如果想要自定义配置，建议向 /etc/mysql/conf.d 目录中创建 .cnf 文件。新建的文件可以任意起名，只要保证后缀名是 cnf 即可。新建的文件中的配置项可以覆盖 /etc/mysql/my.cnf 中的配置项。</p><p>首先需要创建将要映射到容器中的目录以及.cnf文件，然后再创建容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/opt</span><br><span class="line"><span class="comment"># mkdir -p docker_v/mysql/conf</span></span><br><span class="line"><span class="comment"># cd docker_v/mysql/conf</span></span><br><span class="line"><span class="comment"># touch my.cnf</span></span><br><span class="line"><span class="comment"># docker run -p 3306:3306 --name mysql -v /opt/docker_v/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 -d imageID</span></span><br><span class="line">4ec4f56455ea2d6d7251a05b7f308e314051fdad2c26bf3d0f27a9b0c0a71414</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li><strong>-p 3306:3306：</strong>将容器的3306端口映射到主机的3306端口</li><li><strong>-v /opt/docker_v/mysql/conf:/etc/mysql/conf.d：</strong>将主机/opt/docker_v/mysql/conf目录挂载到容器的/etc/mysql/conf.d</li><li><strong>-e MYSQL_ROOT_PASSWORD=123456：</strong>初始化root用户的密码</li><li><strong>-d:</strong> 后台运行容器，并返回容器ID</li><li><strong>imageID:</strong> mysql镜像ID</li></ul><h4 id="docker-安装-mysql-8-版本"><a href="#docker-安装-mysql-8-版本" class="headerlink" title="docker 安装 mysql 8 版本"></a>docker 安装 mysql 8 版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker 中下载 mysql</span></span><br><span class="line">docker pull mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Lzslov123! -d mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#登录mysql</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'Lzslov123!'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加远程登录用户</span></span><br><span class="line">CREATE USER <span class="string">'liaozesong'</span>@<span class="string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'Lzslov123!'</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">'liaozesong'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure><h4 id="登录docker里的MySQL镜像和远程登录"><a href="#登录docker里的MySQL镜像和远程登录" class="headerlink" title="登录docker里的MySQL镜像和远程登录"></a>登录docker里的MySQL镜像和远程登录</h4><ol><li>首次使用如下命令启动docker里的MySQL镜像时：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd /home/</span></span><br><span class="line">[root@localhost home]<span class="comment"># docker run -p 3306:3306 --name test_docker_mysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6</span></span><br><span class="line">9d51b883e254d1a946af01c2edc0ed4c5a2155bf5118a5a3fcc8ff6c9053cfc7</span><br><span class="line">[root@localhost home]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">9d51b883e254        mysql:5.6           <span class="string">"docker-entrypoint.s…"</span>   6 seconds ago       Up 5 seconds        0.0.0.0:3306-&gt;3306/tcp   test_docker_mysql</span><br><span class="line">4737055f929d        nginx               <span class="string">"nginx -g 'daemon of…"</span>   2 days ago          Up 42 minutes       0.0.0.0:8081-&gt;80/tcp     test_docker_nginx_web</span><br><span class="line">b4901afbf62e        php:5.6-fpm         <span class="string">"docker-php-entrypoi…"</span>   2 days ago          Up 42 minutes       9000/tcp                 test_docker_php</span><br><span class="line">[root@localhost home]<span class="comment"># docker exec -it 9d51b883e254 bash</span></span><br><span class="line">root@9d51b883e254:/<span class="comment"># mysql -uroot -p</span></span><br><span class="line">Enter password:  <span class="comment"># 需要输入初始密码123456</span></span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 1</span><br><span class="line">Server version: 5.6.44 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line">Bye</span><br><span class="line">root@9d51b883e254:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@localhost home]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ol start="2"><li>遇到过一个特殊情况，就是关机后再开机，docker服务默认没有开机启动，启动docker服务后，使用命令：docker ps -a命令查看有之前启动过的MySQL镜像，然后启动后使用命令：docker exec -it 容器id bash进去环境，使用命令：mysql -uroot -p，输入密码，总是提示错误：ERROR 1045 (28000): Access denied for user ‘root‘@’localhost’ (using password: YES)。后来的解决办法是在需要输入密码的时候没有输入密码，直接按回车键就登录到MySQL里面来了。后来自己没有关机重启，只是把MySQL镜像服务停了，docker服务停了再按上述步骤操作，不输入密码就登陆不进去，输入密码才能登录进去。记录一下和这个奇葩的情况。</li><li>远程登录docker里的MySQL镜像，使用Navicat Premium软件，主机名或IP地址一栏填写docker所在服务器的地址，账号密码端口等填写MySQL镜像使用的，就能直接远程登录进来了，不用再做其他配置</li></ol><h2 id="Docker-安装-Tomcat"><a href="#Docker-安装-Tomcat" class="headerlink" title="Docker 安装 Tomcat"></a>Docker 安装 Tomcat</h2><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><h4 id="方法一、docker-pull-tomcat"><a href="#方法一、docker-pull-tomcat" class="headerlink" title="方法一、docker pull tomcat"></a>方法一、docker pull tomcat</h4><p>查找Docker Hub上的tomcat镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search tomcat</span></span><br><span class="line">NAME                          DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">tomcat                        Apache Tomcat is an open <span class="built_in">source</span> implementati…   2455                [OK]                </span><br><span class="line">tomee                         Apache TomEE is an all-Apache Java EE certif…   66                  [OK]                </span><br><span class="line">dordoka/tomcat                Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 base…   53                                      [OK]</span><br><span class="line">bitnami/tomcat                Bitnami Tomcat Docker Image                     29                                      [OK]</span><br><span class="line">kubeguide/tomcat-app          Tomcat image <span class="keyword">for</span> Chapter 1                      26                                      </span><br><span class="line">consol/tomcat-7.0             Tomcat 7.0.57, 8080, <span class="string">"admin/admin"</span>              16                                      [OK]</span><br><span class="line">cloudesire/tomcat             Tomcat server, 6/7/8                            15                                      [OK]</span><br></pre></td></tr></table></figure><p>这里我们拉取官方的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull tomcat</span></span><br></pre></td></tr></table></figure><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为tomcat的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images | grep tomcat</span></span><br><span class="line">tomcat              latest              89481b5d9082        2 days ago          506MB</span><br></pre></td></tr></table></figure><h4 id="方法二、通过-Dockerfile-构建"><a href="#方法二、通过-Dockerfile-构建" class="headerlink" title="方法二、通过 Dockerfile 构建"></a>方法二、通过 Dockerfile 构建</h4><p>首先，创建目录tomcat,用于存放后面的相关东西。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p ~/tomcat/webapps ~/tomcat/logs ~/tomcat/conf</span></span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li><p>webapps目录将映射为tomcat容器配置的应用程序目录</p></li><li><p>logs目录将映射为tomcat容器的日志目录</p></li><li><p>conf目录里的配置文件将映射为tomcat容器的配置文件</p></li></ul><p>进入创建的tomcat目录，创建Dockerfile，这个是以Ubuntu系统为参考，CentOS系统使用的话需要修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jre</span><br><span class="line"></span><br><span class="line">ENV CATALINA_HOME /usr/local/tomcat</span><br><span class="line">ENV PATH $CATALINA_HOME/bin:$PATH</span><br><span class="line">RUN mkdir -p &quot;$CATALINA_HOME&quot;</span><br><span class="line">WORKDIR $CATALINA_HOME</span><br><span class="line"></span><br><span class="line"># let &quot;Tomcat Native&quot; live somewhere isolated</span><br><span class="line">ENV TOMCAT_NATIVE_LIBDIR $CATALINA_HOME/native-jni-lib</span><br><span class="line">ENV LD_LIBRARY_PATH $&#123;LD_LIBRARY_PATH:+$LD_LIBRARY_PATH:&#125;$TOMCAT_NATIVE_LIBDIR</span><br><span class="line"></span><br><span class="line"># runtime dependencies for Tomcat Native Libraries</span><br><span class="line"># Tomcat Native 1.2+ requires a newer version of OpenSSL than debian:jessie has available</span><br><span class="line"># &gt; checking OpenSSL library version &gt;= 1.0.2...</span><br><span class="line"># &gt; configure: error: Your version of OpenSSL is not compatible with this version of tcnative</span><br><span class="line"># see http://tomcat.10.x6.nabble.com/VOTE-Release-Apache-Tomcat-8-0-32-tp5046007p5046024.html (and following discussion)</span><br><span class="line"># and https://github.com/docker-library/tomcat/pull/31</span><br><span class="line">ENV OPENSSL_VERSION 1.1.0f-3+deb9u2</span><br><span class="line">RUN set -ex; \</span><br><span class="line">    currentVersion=&quot;$(dpkg-query --show --showformat &apos;$&#123;Version&#125;\n&apos; openssl)&quot;; \</span><br><span class="line">    if dpkg --compare-versions &quot;$currentVersion&quot; &apos;&lt;&lt;&apos; &quot;$OPENSSL_VERSION&quot;; then \</span><br><span class="line">        if ! grep -q stretch /etc/apt/sources.list; then \</span><br><span class="line"># only add stretch if we&apos;re not already building from within stretch</span><br><span class="line">            &#123; \</span><br><span class="line">                echo &apos;deb http://deb.debian.org/debian stretch main&apos;; \</span><br><span class="line">                echo &apos;deb http://security.debian.org stretch/updates main&apos;; \</span><br><span class="line">                echo &apos;deb http://deb.debian.org/debian stretch-updates main&apos;; \</span><br><span class="line">            &#125; &gt; /etc/apt/sources.list.d/stretch.list; \</span><br><span class="line">            &#123; \</span><br><span class="line"># add a negative &quot;Pin-Priority&quot; so that we never ever get packages from stretch unless we explicitly request them</span><br><span class="line">                echo &apos;Package: *&apos;; \</span><br><span class="line">                echo &apos;Pin: release n=stretch*&apos;; \</span><br><span class="line">                echo &apos;Pin-Priority: -10&apos;; \</span><br><span class="line">                echo; \</span><br><span class="line"># ... except OpenSSL, which is the reason we&apos;re here</span><br><span class="line">                echo &apos;Package: openssl libssl*&apos;; \</span><br><span class="line">                echo &quot;Pin: version $OPENSSL_VERSION&quot;; \</span><br><span class="line">                echo &apos;Pin-Priority: 990&apos;; \</span><br><span class="line">            &#125; &gt; /etc/apt/preferences.d/stretch-openssl; \</span><br><span class="line">        fi; \</span><br><span class="line">        apt-get update; \</span><br><span class="line">        apt-get install -y --no-install-recommends openssl=&quot;$OPENSSL_VERSION&quot;; \</span><br><span class="line">        rm -rf /var/lib/apt/lists/*; \</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">        libapr1 \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"># see https://www.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/KEYS</span><br><span class="line"># see also &quot;update.sh&quot; (https://github.com/docker-library/tomcat/blob/master/update.sh)</span><br><span class="line">ENV GPG_KEYS 05AB33110949707C93A279E3D3EFE6B686867BA6 07E48665A34DCAFAE522E5E6266191C37C037D42 47309207D818FFD8DCD3F83F1931D684307A10A5 541FBE7D8F78B25E055DDEE13C370389288584E7 61B832AC2F1C5A90F0F9B00A1C506407564C17A3 713DA88BE50911535FE716F5208B0AB1D63011C7 79F7026C690BAA50B92CD8B66A3AD3F4F22C4FED 9BA44C2621385CB966EBA586F72C284D731FABEE A27677289986DB50844682F8ACB77FC2E86E29AC A9C5DF4D22E99998D9875A5110C01C5A2F6059E7 DCFD35E0BF8CA7344752DE8B6FB21E8933C60243 F3A04C595DB5B6A5F1ECA43E3B7BBB100D811BBE F7DA48BB64BCB84ECBA7EE6935CD23C10D498E23</span><br><span class="line"></span><br><span class="line">ENV TOMCAT_MAJOR 8</span><br><span class="line">ENV TOMCAT_VERSION 8.5.32</span><br><span class="line">ENV TOMCAT_SHA512 fc010f4643cb9996cad3812594190564d0a30be717f659110211414faf8063c61fad1f18134154084ad3ddfbbbdb352fa6686a28fbb6402d3207d4e0a88fa9ce</span><br><span class="line"></span><br><span class="line">ENV TOMCAT_TGZ_URLS \</span><br><span class="line"># https://issues.apache.org/jira/browse/INFRA-8753?focusedCommentId=14735394#comment-14735394</span><br><span class="line">    https://www.apache.org/dyn/closer.cgi?action=download&amp;filename=tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz \</span><br><span class="line"># if the version is outdated, we might have to pull from the dist/archive :/</span><br><span class="line">    https://www-us.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz \</span><br><span class="line">    https://www.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz \</span><br><span class="line">    https://archive.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz</span><br><span class="line"></span><br><span class="line">ENV TOMCAT_ASC_URLS \</span><br><span class="line">    https://www.apache.org/dyn/closer.cgi?action=download&amp;filename=tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz.asc \</span><br><span class="line"># not all the mirrors actually carry the .asc files :&apos;(</span><br><span class="line">    https://www-us.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz.asc \</span><br><span class="line">    https://www.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz.asc \</span><br><span class="line">    https://archive.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz.asc</span><br><span class="line"></span><br><span class="line">RUN set -eux; \</span><br><span class="line">    \</span><br><span class="line">    savedAptMark=&quot;$(apt-mark showmanual)&quot;; \</span><br><span class="line">    apt-get update; \</span><br><span class="line">    \</span><br><span class="line">    apt-get install -y --no-install-recommends gnupg dirmngr; \</span><br><span class="line">    \</span><br><span class="line">    export GNUPGHOME=&quot;$(mktemp -d)&quot;; \</span><br><span class="line">    for key in $GPG_KEYS; do \</span><br><span class="line">        gpg --keyserver ha.pool.sks-keyservers.net --recv-keys &quot;$key&quot;; \</span><br><span class="line">    done; \</span><br><span class="line">    \</span><br><span class="line">    apt-get install -y --no-install-recommends wget ca-certificates; \</span><br><span class="line">    \</span><br><span class="line">    success=; \</span><br><span class="line">    for url in $TOMCAT_TGZ_URLS; do \</span><br><span class="line">        if wget -O tomcat.tar.gz &quot;$url&quot;; then \</span><br><span class="line">            success=1; \</span><br><span class="line">            break; \</span><br><span class="line">        fi; \</span><br><span class="line">    done; \</span><br><span class="line">    [ -n &quot;$success&quot; ]; \</span><br><span class="line">    \</span><br><span class="line">    echo &quot;$TOMCAT_SHA512 *tomcat.tar.gz&quot; | sha512sum -c -; \</span><br><span class="line">    \</span><br><span class="line">    success=; \</span><br><span class="line">    for url in $TOMCAT_ASC_URLS; do \</span><br><span class="line">        if wget -O tomcat.tar.gz.asc &quot;$url&quot;; then \</span><br><span class="line">            success=1; \</span><br><span class="line">            break; \</span><br><span class="line">        fi; \</span><br><span class="line">    done; \</span><br><span class="line">    [ -n &quot;$success&quot; ]; \</span><br><span class="line">    \</span><br><span class="line">    gpg --batch --verify tomcat.tar.gz.asc tomcat.tar.gz; \</span><br><span class="line">    tar -xvf tomcat.tar.gz --strip-components=1; \</span><br><span class="line">    rm bin/*.bat; \</span><br><span class="line">    rm tomcat.tar.gz*; \</span><br><span class="line">    rm -rf &quot;$GNUPGHOME&quot;; \</span><br><span class="line">    \</span><br><span class="line">    nativeBuildDir=&quot;$(mktemp -d)&quot;; \</span><br><span class="line">    tar -xvf bin/tomcat-native.tar.gz -C &quot;$nativeBuildDir&quot; --strip-components=1; \</span><br><span class="line">    apt-get install -y --no-install-recommends \</span><br><span class="line">        dpkg-dev \</span><br><span class="line">        gcc \</span><br><span class="line">        libapr1-dev \</span><br><span class="line">        libssl-dev \</span><br><span class="line">        make \</span><br><span class="line">        &quot;openjdk-$&#123;JAVA_VERSION%%[.~bu-]*&#125;-jdk=$JAVA_DEBIAN_VERSION&quot; \</span><br><span class="line">    ; \</span><br><span class="line">    ( \</span><br><span class="line">        export CATALINA_HOME=&quot;$PWD&quot;; \</span><br><span class="line">        cd &quot;$nativeBuildDir/native&quot;; \</span><br><span class="line">        gnuArch=&quot;$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)&quot;; \</span><br><span class="line">        ./configure \</span><br><span class="line">            --build=&quot;$gnuArch&quot; \</span><br><span class="line">            --libdir=&quot;$TOMCAT_NATIVE_LIBDIR&quot; \</span><br><span class="line">            --prefix=&quot;$CATALINA_HOME&quot; \</span><br><span class="line">            --with-apr=&quot;$(which apr-1-config)&quot; \</span><br><span class="line">            --with-java-home=&quot;$(docker-java-home)&quot; \</span><br><span class="line">            --with-ssl=yes; \</span><br><span class="line">        make -j &quot;$(nproc)&quot;; \</span><br><span class="line">        make install; \</span><br><span class="line">    ); \</span><br><span class="line">    rm -rf &quot;$nativeBuildDir&quot;; \</span><br><span class="line">    rm bin/tomcat-native.tar.gz; \</span><br><span class="line">    \</span><br><span class="line"># reset apt-mark&apos;s &quot;manual&quot; list so that &quot;purge --auto-remove&quot; will remove all build dependencies</span><br><span class="line">    apt-mark auto &apos;.*&apos; &gt; /dev/null; \</span><br><span class="line">    [ -z &quot;$savedAptMark&quot; ] || apt-mark manual $savedAptMark; \</span><br><span class="line">    apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \</span><br><span class="line">    rm -rf /var/lib/apt/lists/*; \</span><br><span class="line">    \</span><br><span class="line"># sh removes env vars it doesn&apos;t support (ones with periods)</span><br><span class="line"># https://github.com/docker-library/tomcat/issues/77</span><br><span class="line">    find ./bin/ -name &apos;*.sh&apos; -exec sed -ri &apos;s|^#!/bin/sh$|#!/usr/bin/env bash|&apos; &apos;&#123;&#125;&apos; +</span><br><span class="line"></span><br><span class="line"># verify Tomcat Native is working properly</span><br><span class="line">RUN set -e \</span><br><span class="line">    &amp;&amp; nativeLines=&quot;$(catalina.sh configtest 2&gt;&amp;1)&quot; \</span><br><span class="line">    &amp;&amp; nativeLines=&quot;$(echo &quot;$nativeLines&quot; | grep &apos;Apache Tomcat Native&apos;)&quot; \</span><br><span class="line">    &amp;&amp; nativeLines=&quot;$(echo &quot;$nativeLines&quot; | sort -u)&quot; \</span><br><span class="line">    &amp;&amp; if ! echo &quot;$nativeLines&quot; | grep &apos;INFO: Loaded APR based Apache Tomcat Native library&apos; &gt;&amp;2; then \</span><br><span class="line">        echo &gt;&amp;2 &quot;$nativeLines&quot;; \</span><br><span class="line">        exit 1; \</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line">CMD [&quot;catalina.sh&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure><p>通过Dockerfile创建一个镜像，替换成你自己的名字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker build -t tomcat .</span></span><br></pre></td></tr></table></figure><p>创建完成后，我们可以在本地的镜像列表里查找到刚刚创建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images|grep tomcat</span></span><br><span class="line">tomcat              latest              70f819d3d2d9        7 days ago          335.8 MB</span><br></pre></td></tr></table></figure><h3 id="使用tomcat镜像"><a href="#使用tomcat镜像" class="headerlink" title="使用tomcat镜像"></a>使用tomcat镜像</h3><h4 id="运行容器-1"><a href="#运行容器-1" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker run --name test_docker_tomcat -p 8080:8080 -v $PWD/test:/usr/local/tomcat/webapps/test -d tomcat</span></span><br><span class="line">3bdf4b155aaef20bac44511f84b402a2cb6d6957bc284c21a51e89fcbc2081a6</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-p 8080:8080：将容器的8080端口映射到主机的8080端口</li><li>-v $PWD/test:/usr/local/tomcat/webapps/test：将主机中当前目录下的test挂载到容器的/test</li></ul><p>查看容器启动情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">3bdf4b155aae        tomcat              <span class="string">"catalina.sh run"</span>   21 seconds ago      Up 20 seconds       0.0.0.0:8080-&gt;8080/tcp   test_docker_tomcat</span><br></pre></td></tr></table></figure><h4 id="通过浏览器访问"><a href="#通过浏览器访问" class="headerlink" title="通过浏览器访问"></a>通过浏览器访问</h4><p>浏览器地址看输入：<a href="http://ip:8080" target="_blank" rel="noopener">http://ip:8080</a></p><h2 id="Docker-安装-Python"><a href="#Docker-安装-Python" class="headerlink" title="Docker 安装 Python"></a>Docker 安装 Python</h2><h3 id="安装步骤-1"><a href="#安装步骤-1" class="headerlink" title="安装步骤"></a>安装步骤</h3><h4 id="方法一、docker-pull-python-3-5"><a href="#方法一、docker-pull-python-3-5" class="headerlink" title="方法一、docker pull python:3.5"></a>方法一、docker pull python:3.5</h4><p>查找Docker Hub上的python镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search python</span></span><br><span class="line">NAME                           DESCRIPTION                        STARS     OFFICIAL   AUTOMATED</span><br><span class="line">python                         Python is an interpreted,...       982       [OK]       </span><br><span class="line">kaggle/python                  Docker image <span class="keyword">for</span> Python...         33                   [OK]</span><br><span class="line">azukiapp/python                Docker image to run Python ...     3                    [OK]</span><br><span class="line">vimagick/python                mini python                                  2          [OK]</span><br></pre></td></tr></table></figure><p>这里我们拉取官方的镜像,标签为3.5</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull python:3.5</span></span><br></pre></td></tr></table></figure><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为python,标签为3.5的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images python:3.5 </span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">python              3.5              045767ddf24a        9 days ago          684.1 MB</span><br></pre></td></tr></table></figure><h4 id="方法二、通过-Dockerfile-构建-1"><a href="#方法二、通过-Dockerfile-构建-1" class="headerlink" title="方法二、通过 Dockerfile 构建"></a>方法二、通过 Dockerfile 构建</h4><p>首先，创建目录python,用于存放后面的相关东西。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p ~/python ~/python/myapp</span></span><br></pre></td></tr></table></figure><p>myapp目录将映射为python容器配置的应用目录</p><p>进入创建的python目录，创建Dockerfile，这个是以Ubuntu系统为参考，CentOS系统使用的话需要修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">FROM buildpack-deps:jessie</span><br><span class="line"></span><br><span class="line"># remove several traces of debian python</span><br><span class="line">RUN apt-get purge -y python.*</span><br><span class="line"></span><br><span class="line"># http://bugs.python.org/issue19846</span><br><span class="line"># &gt; At the moment, setting &quot;LANG=C&quot; on a Linux system *fundamentally breaks Python 3*, and that&apos;s not OK.</span><br><span class="line">ENV LANG C.UTF-8</span><br><span class="line"></span><br><span class="line"># gpg: key F73C700D: public key &quot;Larry Hastings &lt;larry@hastings.org&gt;&quot; imported</span><br><span class="line">ENV GPG_KEY 97FC712E4C024BBEA48A61ED3A5CA953F73C700D</span><br><span class="line"></span><br><span class="line">ENV PYTHON_VERSION 3.5.1</span><br><span class="line"></span><br><span class="line"># if this is called &quot;PIP_VERSION&quot;, pip explodes with &quot;ValueError: invalid truth value &apos;&lt;VERSION&gt;&apos;&quot;</span><br><span class="line">ENV PYTHON_PIP_VERSION 8.1.2</span><br><span class="line"></span><br><span class="line">RUN set -ex \</span><br><span class="line">        &amp;&amp; curl -fSL &quot;https://www.python.org/ftp/python/$&#123;PYTHON_VERSION%%[a-z]*&#125;/Python-$PYTHON_VERSION.tar.xz&quot; -o python.tar.xz \</span><br><span class="line">        &amp;&amp; curl -fSL &quot;https://www.python.org/ftp/python/$&#123;PYTHON_VERSION%%[a-z]*&#125;/Python-$PYTHON_VERSION.tar.xz.asc&quot; -o python.tar.xz.asc \</span><br><span class="line">        &amp;&amp; export GNUPGHOME=&quot;$(mktemp -d)&quot; \</span><br><span class="line">        &amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys &quot;$GPG_KEY&quot; \</span><br><span class="line">        &amp;&amp; gpg --batch --verify python.tar.xz.asc python.tar.xz \</span><br><span class="line">        &amp;&amp; rm -r &quot;$GNUPGHOME&quot; python.tar.xz.asc \</span><br><span class="line">        &amp;&amp; mkdir -p /usr/src/python \</span><br><span class="line">        &amp;&amp; tar -xJC /usr/src/python --strip-components=1 -f python.tar.xz \</span><br><span class="line">        &amp;&amp; rm python.tar.xz \</span><br><span class="line">        \</span><br><span class="line">        &amp;&amp; cd /usr/src/python \</span><br><span class="line">        &amp;&amp; ./configure --enable-shared --enable-unicode=ucs4 \</span><br><span class="line">        &amp;&amp; make -j$(nproc) \</span><br><span class="line">        &amp;&amp; make install \</span><br><span class="line">        &amp;&amp; ldconfig \</span><br><span class="line">        &amp;&amp; pip3 install --no-cache-dir --upgrade --ignore-installed pip==$PYTHON_PIP_VERSION \</span><br><span class="line">        &amp;&amp; find /usr/local -depth \</span><br><span class="line">                \( \</span><br><span class="line">                    \( -type d -a -name test -o -name tests \) \</span><br><span class="line">                    -o \</span><br><span class="line">                    \( -type f -a -name &apos;*.pyc&apos; -o -name &apos;*.pyo&apos; \) \</span><br><span class="line">                \) -exec rm -rf &apos;&#123;&#125;&apos; + \</span><br><span class="line">        &amp;&amp; rm -rf /usr/src/python ~/.cache</span><br><span class="line"></span><br><span class="line"># make some useful symlinks that are expected to exist</span><br><span class="line">RUN cd /usr/local/bin \</span><br><span class="line">        &amp;&amp; ln -s easy_install-3.5 easy_install \</span><br><span class="line">        &amp;&amp; ln -s idle3 idle \</span><br><span class="line">        &amp;&amp; ln -s pydoc3 pydoc \</span><br><span class="line">        &amp;&amp; ln -s python3 python \</span><br><span class="line">        &amp;&amp; ln -s python3-config python-config</span><br><span class="line"></span><br><span class="line">CMD [&quot;python3&quot;]</span><br></pre></td></tr></table></figure><p>通过Dockerfile创建一个镜像，替换成你自己的名字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker build -t python:3.5 .</span></span><br></pre></td></tr></table></figure><p>创建完成后，我们可以在本地的镜像列表里查找到刚刚创建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images python:3.5 </span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">python              3.5              045767ddf24a        9 days ago          684.1 MB</span><br></pre></td></tr></table></figure><h3 id="使用python镜像"><a href="#使用python镜像" class="headerlink" title="使用python镜像"></a>使用python镜像</h3><p>在/home/python/myapp目录下创建一个 helloworld.py 文件，代码如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello, World!"</span>);</span><br></pre></td></tr></table></figure><h3 id="运行容器-2"><a href="#运行容器-2" class="headerlink" title="运行容器"></a>运行容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run  -v /home/python/myapp:/usr/src/myapp  -w /usr/src/myapp python:3.5 python helloworld.py</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-v /home/python/myapp:/usr/src/myapp :将主机指定目录下的myapp挂载到容器的/usr/src/myapp</li><li>-w /usr/src/myapp :指定容器的/usr/src/myapp目录为工作目录</li><li>python helloworld.py :使用容器的python命令来执行工作目录中的helloworld.py文件</li></ul><p>输出结果：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, World!</span><br></pre></td></tr></table></figure><p></p><h2 id="Docker-安装-Redis"><a href="#Docker-安装-Redis" class="headerlink" title="Docker 安装 Redis"></a>Docker 安装 Redis</h2><h3 id="安装步骤-2"><a href="#安装步骤-2" class="headerlink" title="安装步骤"></a>安装步骤</h3><h4 id="方法一、docker-pull-redis-5-0"><a href="#方法一、docker-pull-redis-5-0" class="headerlink" title="方法一、docker pull redis:5.0"></a>方法一、docker pull redis:5.0</h4><p>查找Docker Hub上的redis镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search  redis</span><br><span class="line">NAME                      DESCRIPTION                   STARS  OFFICIAL  AUTOMATED</span><br><span class="line">redis                     Redis is an open source ...   2321   [OK]       </span><br><span class="line">sameersbn/redis                                         32                   [OK]</span><br><span class="line">torusware/speedus-redis   Always updated official ...   29             [OK]</span><br><span class="line">bitnami/redis             Bitnami Redis Docker Image    22                   [OK]</span><br><span class="line">anapsix/redis             11MB Redis server image ...   6                    [OK]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这里我们拉取官方的镜像,标签为5.0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull  redis:5.0</span></span><br></pre></td></tr></table></figure><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为redis,标签为5.0的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images redis</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">redis               5.0                 598a6f110d01        3 days ago          118MB</span><br></pre></td></tr></table></figure><h4 id="方法二、通过-Dockerfile-构建-2"><a href="#方法二、通过-Dockerfile-构建-2" class="headerlink" title="方法二、通过 Dockerfile 构建"></a>方法二、通过 Dockerfile 构建</h4><p>首先，创建目录redis,用于存放后面的相关东西。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p ~/redis ~/redis/data</span></span><br></pre></td></tr></table></figure><ul><li>data目录将映射为redis容器配置的/data目录,作为redis数据持久化的存储目录</li></ul><p>进入创建的redis目录，创建Dockerfile，这个是以Ubuntu系统为参考，CentOS系统使用的话需要修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">FROM debian:jessie</span><br><span class="line"></span><br><span class="line"># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span><br><span class="line">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">                ca-certificates \</span><br><span class="line">                wget \</span><br><span class="line">        &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"># grab gosu for easy step-down from root</span><br><span class="line">ENV GOSU_VERSION 1.7</span><br><span class="line">RUN set -x \</span><br><span class="line">        &amp;&amp; wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$(dpkg --print-architecture)&quot; \</span><br><span class="line">        &amp;&amp; wget -O /usr/local/bin/gosu.asc &quot;https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$(dpkg --print-architecture).asc&quot; \</span><br><span class="line">        &amp;&amp; export GNUPGHOME=&quot;$(mktemp -d)&quot; \</span><br><span class="line">        &amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \</span><br><span class="line">        &amp;&amp; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \</span><br><span class="line">        &amp;&amp; rm -r &quot;$GNUPGHOME&quot; /usr/local/bin/gosu.asc \</span><br><span class="line">        &amp;&amp; chmod +x /usr/local/bin/gosu \</span><br><span class="line">        &amp;&amp; gosu nobody true</span><br><span class="line"></span><br><span class="line">ENV REDIS_VERSION 5.0.0</span><br><span class="line">ENV REDIS_DOWNLOAD_URL http://download.redis.io/releases/redis-5.0.0.tar.gz</span><br><span class="line">ENV REDIS_DOWNLOAD_SHA1 0c1820931094369c8cc19fc1be62f598bc5961ca</span><br><span class="line"></span><br><span class="line"># for redis-sentinel see: http://redis.io/topics/sentinel</span><br><span class="line">RUN buildDeps=&apos;gcc libc6-dev make&apos; \</span><br><span class="line">        &amp;&amp; set -x \</span><br><span class="line">        &amp;&amp; apt-get update &amp;&amp; apt-get install -y $buildDeps --no-install-recommends \</span><br><span class="line">        &amp;&amp; rm -rf /var/lib/apt/lists/* \</span><br><span class="line">        &amp;&amp; wget -O redis.tar.gz &quot;$REDIS_DOWNLOAD_URL&quot; \</span><br><span class="line">        &amp;&amp; echo &quot;$REDIS_DOWNLOAD_SHA1 *redis.tar.gz&quot; | sha1sum -c - \</span><br><span class="line">        &amp;&amp; mkdir -p /usr/src/redis \</span><br><span class="line">        &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span><br><span class="line">        &amp;&amp; rm redis.tar.gz \</span><br><span class="line">        &amp;&amp; make -C /usr/src/redis \</span><br><span class="line">        &amp;&amp; make -C /usr/src/redis install \</span><br><span class="line">        &amp;&amp; rm -r /usr/src/redis \</span><br><span class="line">        &amp;&amp; apt-get purge -y --auto-remove $buildDeps</span><br><span class="line"></span><br><span class="line">RUN mkdir /data &amp;&amp; chown redis:redis /data</span><br><span class="line">VOLUME /data</span><br><span class="line">WORKDIR /data</span><br><span class="line"></span><br><span class="line">COPY docker-entrypoint.sh /usr/local/bin/</span><br><span class="line">ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 6379</span><br><span class="line">CMD [ &quot;redis-server&quot; ]</span><br></pre></td></tr></table></figure><p>通过Dockerfile创建一个镜像，替换成你自己的名字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker build  -t redis:5.0 .</span></span><br></pre></td></tr></table></figure><p>创建完成后，我们可以在本地的镜像列表里查找到刚刚创建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images redis </span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">redis               5.0                43c923d57784        2 weeks ago         193.9 MB</span><br></pre></td></tr></table></figure><h3 id="使用redis镜像"><a href="#使用redis镜像" class="headerlink" title="使用redis镜像"></a>使用redis镜像</h3><h4 id="运行容器-3"><a href="#运行容器-3" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker run -p 6379:6379 -v $PWD/data:/data  -d redis:5.0 redis-server --appendonly yes</span></span><br><span class="line">2c4e3bfd9691e9174cebba01ebc55f464321749156eb462fd099da3544a0c67b</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-p 6379:6379 : 将容器的6379端口映射到主机的6379端口</li><li>-v $PWD/data:/data : 将主机中当前目录下的data挂载到容器的/data</li><li>redis-server –appendonly yes : 在容器执行redis-server启动命令，并打开redis持久化配置</li></ul><h4 id="查看容器启动情况-1"><a href="#查看容器启动情况-1" class="headerlink" title="查看容器启动情况"></a>查看容器启动情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                 ...   PORTS                      NAMES</span><br><span class="line">43f7a65ec7f8   redis:3.2    <span class="string">"docker-entrypoint.sh"</span>  ...   0.0.0.0:6379-&gt;6379/tcp     agitated_cray</span><br></pre></td></tr></table></figure><h4 id="连接、查看容器"><a href="#连接、查看容器" class="headerlink" title="连接、查看容器"></a>连接、查看容器</h4><p>使用redis镜像执行redis-cli命令连接到刚启动的容器,主机IP为127.0.0.1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker exec -it 2c4e3bfd9691 redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:5.0.5</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:f5cc35eb8e511133</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 3.10.0-862.el7.x86_64 x86_64</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">...</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure><h2 id="Docker-安装-MongoDB"><a href="#Docker-安装-MongoDB" class="headerlink" title="Docker 安装 MongoDB"></a>Docker 安装 MongoDB</h2><h3 id="安装步骤-3"><a href="#安装步骤-3" class="headerlink" title="安装步骤"></a>安装步骤</h3><h4 id="方法一、docker-pull-mongo"><a href="#方法一、docker-pull-mongo" class="headerlink" title="方法一、docker pull mongo"></a>方法一、docker pull mongo</h4><p>查找Docker Hub上的mongo镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search mongo</span></span><br><span class="line">NAME                              DESCRIPTION                      STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mongo                             MongoDB document databases ...   1989      [OK]       </span><br><span class="line">mongo-express                     Web-based MongoDB admin int...   22        [OK]       </span><br><span class="line">mvertes/alpine-mongo              light MongoDB container          19                   [OK]</span><br><span class="line">mongooseim/mongooseim-docker      MongooseIM server the lates...   9                    [OK]</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>这里我们拉取官方的镜像,标签为4.1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull mongo:4.1</span></span><br></pre></td></tr></table></figure><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为mongo,标签为4.1的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker images mongo</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mongo               4.1                 6e89620d0711        11 days ago         360MB</span><br></pre></td></tr></table></figure><h4 id="方法二、通过-Dockerfile-构建-3"><a href="#方法二、通过-Dockerfile-构建-3" class="headerlink" title="方法二、通过 Dockerfile 构建"></a>方法二、通过 Dockerfile 构建</h4><p>首先，创建目录mongo,用于存放后面的相关东西。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p ~/mongo  ~/mongo/db</span></span><br></pre></td></tr></table></figure><ul><li>db目录将映射为mongo容器配置的/data/db目录,作为mongo数据的存储目录</li></ul><p>进入创建的mongo目录，创建Dockerfile，这个是以Ubuntu系统为参考，CentOS系统使用的话需要修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">FROM debian:jessie-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span></span><br><span class="line">RUN groupadd -r mongodb &amp;&amp; useradd -r -g mongodb mongodb</span><br><span class="line"></span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">        ca-certificates \</span><br><span class="line">        jq \</span><br><span class="line">        numactl \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># grab gosu for easy step-down from root (https://github.com/tianon/gosu/releases)</span></span><br><span class="line">ENV GOSU_VERSION 1.10</span><br><span class="line"><span class="comment"># grab "js-yaml" for parsing mongod's YAML config files (https://github.com/nodeca/js-yaml/releases)</span></span><br><span class="line">ENV JSYAML_VERSION 3.10.0</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">set</span> -ex; \</span><br><span class="line">    \</span><br><span class="line">    apt-get update; \</span><br><span class="line">    apt-get install -y --no-install-recommends \</span><br><span class="line">        wget \</span><br><span class="line">    ; \</span><br><span class="line">    rm -rf /var/lib/apt/lists/*; \</span><br><span class="line">    \</span><br><span class="line">    dpkgArch=<span class="string">"<span class="variable">$(dpkg --print-architecture | awk -F- '&#123; print $NF &#125;')</span>"</span>; \</span><br><span class="line">    wget -O /usr/<span class="built_in">local</span>/bin/gosu <span class="string">"https://github.com/tianon/gosu/releases/download/<span class="variable">$GOSU_VERSION</span>/gosu-<span class="variable">$dpkgArch</span>"</span>; \</span><br><span class="line">    wget -O /usr/<span class="built_in">local</span>/bin/gosu.asc <span class="string">"https://github.com/tianon/gosu/releases/download/<span class="variable">$GOSU_VERSION</span>/gosu-<span class="variable">$dpkgArch</span>.asc"</span>; \</span><br><span class="line">    <span class="built_in">export</span> GNUPGHOME=<span class="string">"<span class="variable">$(mktemp -d)</span>"</span>; \</span><br><span class="line">    gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \</span><br><span class="line">    gpg --batch --verify /usr/<span class="built_in">local</span>/bin/gosu.asc /usr/<span class="built_in">local</span>/bin/gosu; \</span><br><span class="line">    <span class="built_in">command</span> -v gpgconf &amp;&amp; gpgconf --<span class="built_in">kill</span> all || :; \</span><br><span class="line">    rm -r <span class="string">"<span class="variable">$GNUPGHOME</span>"</span> /usr/<span class="built_in">local</span>/bin/gosu.asc; \</span><br><span class="line">    chmod +x /usr/<span class="built_in">local</span>/bin/gosu; \</span><br><span class="line">    gosu nobody <span class="literal">true</span>; \</span><br><span class="line">    \</span><br><span class="line">    wget -O /js-yaml.js <span class="string">"https://github.com/nodeca/js-yaml/raw/<span class="variable">$&#123;JSYAML_VERSION&#125;</span>/dist/js-yaml.js"</span>; \</span><br><span class="line"><span class="comment"># TODO some sort of download verification here</span></span><br><span class="line">    \</span><br><span class="line">    apt-get purge -y --auto-remove wget</span><br><span class="line"></span><br><span class="line">RUN mkdir /docker-entrypoint-initdb.d</span><br><span class="line"></span><br><span class="line">ENV GPG_KEYS \</span><br><span class="line"><span class="comment"># pub   4096R/AAB2461C 2014-02-25 [expires: 2016-02-25]</span></span><br><span class="line"><span class="comment">#       Key fingerprint = DFFA 3DCF 326E 302C 4787  673A 01C4 E7FA AAB2 461C</span></span><br><span class="line"><span class="comment"># uid                  MongoDB 2.6 Release Signing Key &lt;packaging@mongodb.com&gt;</span></span><br><span class="line">    DFFA3DCF326E302C4787673A01C4E7FAAAB2461C \</span><br><span class="line"><span class="comment"># pub   4096R/EA312927 2015-10-09 [expires: 2017-10-08]</span></span><br><span class="line"><span class="comment">#       Key fingerprint = 42F3 E95A 2C4F 0827 9C49  60AD D68F A50F EA31 2927</span></span><br><span class="line"><span class="comment"># uid                  MongoDB 3.2 Release Signing Key &lt;packaging@mongodb.com&gt;</span></span><br><span class="line">    42F3E95A2C4F08279C4960ADD68FA50FEA312927</span><br><span class="line"><span class="comment"># https://docs.mongodb.com/manual/tutorial/verify-mongodb-packages/#download-then-import-the-key-file</span></span><br><span class="line">RUN <span class="built_in">set</span> -ex; \</span><br><span class="line">    <span class="built_in">export</span> GNUPGHOME=<span class="string">"<span class="variable">$(mktemp -d)</span>"</span>; \</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$GPG_KEYS</span>; <span class="keyword">do</span> \</span><br><span class="line">        gpg --keyserver ha.pool.sks-keyservers.net --recv-keys <span class="string">"<span class="variable">$key</span>"</span>; \</span><br><span class="line">    <span class="keyword">done</span>; \</span><br><span class="line">    gpg --<span class="built_in">export</span> <span class="variable">$GPG_KEYS</span> &gt; /etc/apt/trusted.gpg.d/mongodb.gpg; \</span><br><span class="line">    <span class="built_in">command</span> -v gpgconf &amp;&amp; gpgconf --<span class="built_in">kill</span> all || :; \</span><br><span class="line">    rm -r <span class="string">"<span class="variable">$GNUPGHOME</span>"</span>; \</span><br><span class="line">    apt-key list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow build-time overrides (eg. to build image with MongoDB Enterprise version)</span></span><br><span class="line"><span class="comment"># Options for MONGO_PACKAGE: mongodb-org OR mongodb-enterprise</span></span><br><span class="line"><span class="comment"># Options for MONGO_REPO: repo.mongodb.org OR repo.mongodb.com</span></span><br><span class="line"><span class="comment"># Example: docker build --build-arg MONGO_PACKAGE=mongodb-enterprise --build-arg MONGO_REPO=repo.mongodb.com .</span></span><br><span class="line">ARG MONGO_PACKAGE=mongodb-org</span><br><span class="line">ARG MONGO_REPO=repo.mongodb.org</span><br><span class="line">ENV MONGO_PACKAGE=<span class="variable">$&#123;MONGO_PACKAGE&#125;</span> MONGO_REPO=<span class="variable">$&#123;MONGO_REPO&#125;</span></span><br><span class="line"></span><br><span class="line">ENV MONGO_MAJOR 3.2</span><br><span class="line">ENV MONGO_VERSION 3.2.20</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">"deb http://<span class="variable">$MONGO_REPO</span>/apt/debian jessie/<span class="variable">$&#123;MONGO_PACKAGE%-unstable&#125;</span>/<span class="variable">$MONGO_MAJOR</span> main"</span> | tee <span class="string">"/etc/apt/sources.list.d/<span class="variable">$&#123;MONGO_PACKAGE%-unstable&#125;</span>.list"</span></span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">set</span> -x \</span><br><span class="line">    &amp;&amp; apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y \</span><br><span class="line">        <span class="variable">$&#123;MONGO_PACKAGE&#125;</span>=<span class="variable">$MONGO_VERSION</span> \</span><br><span class="line">        <span class="variable">$&#123;MONGO_PACKAGE&#125;</span>-server=<span class="variable">$MONGO_VERSION</span> \</span><br><span class="line">        <span class="variable">$&#123;MONGO_PACKAGE&#125;</span>-shell=<span class="variable">$MONGO_VERSION</span> \</span><br><span class="line">        <span class="variable">$&#123;MONGO_PACKAGE&#125;</span>-mongos=<span class="variable">$MONGO_VERSION</span> \</span><br><span class="line">        <span class="variable">$&#123;MONGO_PACKAGE&#125;</span>-tools=<span class="variable">$MONGO_VERSION</span> \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/mongodb \</span><br><span class="line">    &amp;&amp; mv /etc/mongod.conf /etc/mongod.conf.orig</span><br><span class="line"></span><br><span class="line">RUN mkdir -p /data/db /data/configdb \</span><br><span class="line">    &amp;&amp; chown -R mongodb:mongodb /data/db /data/configdb</span><br><span class="line">VOLUME /data/db /data/configdb</span><br><span class="line"></span><br><span class="line">COPY docker-entrypoint.sh /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">RUN ln -s usr/<span class="built_in">local</span>/bin/docker-entrypoint.sh /entrypoint.sh <span class="comment"># backwards compat</span></span><br><span class="line">ENTRYPOINT [<span class="string">"docker-entrypoint.sh"</span>]</span><br><span class="line"></span><br><span class="line">EXPOSE 27017</span><br><span class="line">CMD [<span class="string">"mongod"</span>]</span><br></pre></td></tr></table></figure><p>通过Dockerfile创建一个镜像，替换成你自己的名字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker build -t mongo:3.2 .</span></span><br></pre></td></tr></table></figure><p>创建完成后，我们可以在本地的镜像列表里查找到刚刚创建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images  mongo:3.2</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mongo               3.2                 282fd552add6        9 days ago          336.1 MB</span><br></pre></td></tr></table></figure><h3 id="使用mongo镜像"><a href="#使用mongo镜像" class="headerlink" title="使用mongo镜像"></a>使用mongo镜像</h3><h4 id="运行容器-4"><a href="#运行容器-4" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker run --name test_docker_mongodb -p 27017:27017  -v $PWD/mongodb/configdb:/data/configdb/ -v $PWD/mongodb/db/:/data/db/ -d mongo:4.1 --auth</span></span><br><span class="line">4c13b2cef633d1b67b3fb30f2776064eaf110265a9e93a324b62b0780d14cae8</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>-p 27017:27017 : 将容器的27017 端口映射到主机的27017 端口</li><li>-v $PWD/mongodb/configdb:/data/configdb/ 主机中当前目录下的configdb挂载到容器的/data/configdb，作为mongo数据配置目录</li><li>-v : $PWD/mongodb/db/:/data/db/ 将主机中当前目录下的db挂载到容器的/data/db，作为mongo数据存储目录</li></ul><h4 id="查看容器启动情况-2"><a href="#查看容器启动情况-2" class="headerlink" title="查看容器启动情况"></a>查看容器启动情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                      NAMES</span><br><span class="line">4c13b2cef633        mongo:4.1           <span class="string">"docker-entrypoint.s…"</span>   3 minutes ago       Up 3 minutes        0.0.0.0:27017-&gt;27017/tcp   test_docker_mongodb</span><br></pre></td></tr></table></figure><p>使用mongo镜像执行mongo 命令连接到刚启动的MongoDB容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以 admin 用户身份进入mongo</span></span><br><span class="line">[root@localhost home]<span class="comment"># docker exec -it  4c13b2cef633  mongo admin</span></span><br><span class="line">MongoDB shell version v4.1.13</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/admin?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session &#123; <span class="string">"id"</span> : UUID(<span class="string">"0f3d246c-845e-47e3-b571-4f8c0f94028a"</span>) &#125;</span><br><span class="line">MongoDB server version: 4.1.13</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">"help"</span>.</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line">        http://docs.mongodb.org/</span><br><span class="line">Questions? Try the support group</span><br><span class="line">        http://groups.google.com/group/mongodb-user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个 admin 管理员账号</span></span><br><span class="line">&gt; db.createUser(&#123; user: <span class="string">'admin'</span>, <span class="built_in">pwd</span>: <span class="string">'123456'</span>, roles: [ &#123; role: <span class="string">"userAdminAnyDatabase"</span>, db: <span class="string">"admin"</span> &#125; ] &#125;);</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">        <span class="string">"user"</span> : <span class="string">"admin"</span>,</span><br><span class="line">        <span class="string">"roles"</span> : [</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="string">"role"</span> : <span class="string">"userAdminAnyDatabase"</span>,</span><br><span class="line">                        <span class="string">"db"</span> : <span class="string">"admin"</span></span><br><span class="line">                &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line">&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost home]<span class="comment"># docker exec -it  4c13b2cef633  mongo admin</span></span><br><span class="line">MongoDB shell version v4.1.13</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/admin?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session &#123; <span class="string">"id"</span> : UUID(<span class="string">"1c6c9ebd-458d-42d3-906d-51fb84b38bf1"</span>) &#125;</span><br><span class="line">MongoDB server version: 4.1.13</span><br><span class="line"><span class="comment"># 再次登录需要对 admin 进行身份认证</span></span><br><span class="line">&gt; db.auth(<span class="string">"admin"</span>,<span class="string">"123456"</span>); </span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换数据库</span></span><br><span class="line">&gt; use app;</span><br><span class="line">switched to db app</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h4 id="使用-mongo-express-管理mongodb"><a href="#使用-mongo-express-管理mongodb" class="headerlink" title="使用 mongo-express 管理mongodb"></a>使用 mongo-express 管理mongodb</h4><p>mongo-express是MongoDB的一个可视化图形管理工具，通过docker来运行一个mongo-express，来管理上面创建的mongodb服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要进行账号验证才能使用</span></span><br><span class="line">docker pull docker.io/mongo-express</span><br><span class="line">docker run -it --rm -p 8081:8081 --link &lt;mongoDB容器ID&gt;:mongo mongo-express</span><br><span class="line"><span class="comment"># 通过浏览器访问</span></span><br><span class="line">http://&lt;宿主机IP地址&gt;:8081</span><br></pre></td></tr></table></figure><h4 id="使用-mongoclient-管理-mongodb"><a href="#使用-mongoclient-管理-mongodb" class="headerlink" title="使用 mongoclient 管理 mongodb"></a>使用 mongoclient 管理 mongodb</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要进行账号验证才能使用</span></span><br><span class="line">docker pull mongoclient/mongoclient</span><br><span class="line">docker run --name mongoclient -d -p 3000:3000 -e MONGO_URL=mongodb://&lt;宿主机IP地址&gt;:27017/ mongoclient/mongoclient</span><br><span class="line"><span class="comment"># 通过浏览器访问</span></span><br><span class="line">http://&lt;宿主机IP地址&gt;:3000</span><br></pre></td></tr></table></figure><h2 id="Docker-安装-Apache"><a href="#Docker-安装-Apache" class="headerlink" title="Docker 安装 Apache"></a>Docker 安装 Apache</h2><h3 id="安装步骤-4"><a href="#安装步骤-4" class="headerlink" title="安装步骤"></a>安装步骤</h3><h4 id="方法一、docker-pull-httpd"><a href="#方法一、docker-pull-httpd" class="headerlink" title="方法一、docker pull httpd"></a>方法一、docker pull httpd</h4><p>查找Docker Hub上的httpd镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># # docker search httpd</span></span><br><span class="line">NAME                           DESCRIPTION                  STARS  OFFICIAL AUTOMATED</span><br><span class="line">httpd                          The Apache HTTP Server ..    524     [OK]       </span><br><span class="line">centos/httpd                                                7                [OK]</span><br><span class="line">rgielen/httpd-image-php5       Docker image <span class="keyword">for</span> Apache...   1                [OK]</span><br><span class="line">microwebapps/httpd-frontend    Httpd frontend allowing...   1                [OK]</span><br><span class="line">lolhens/httpd                  Apache httpd 2 Server        1                [OK]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这里我们拉取官方的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull httpd</span></span><br></pre></td></tr></table></figure><p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为httpd的镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker images httpd</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">httpd               latest              ee39f68eb241        2 days ago          154MB</span><br></pre></td></tr></table></figure><h4 id="方法二、通过-Dockerfile构建-1"><a href="#方法二、通过-Dockerfile构建-1" class="headerlink" title="方法二、通过 Dockerfile构建"></a>方法二、通过 Dockerfile构建</h4><p>首先，创建目录apache，用于存放后面的相关东西。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p  ~/apache/www ~/apache/logs ~/apache/conf</span></span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>www目录将映射为apache容器配置的应用程序目录</li><li>logs目录将映射为apache容器的日志目录</li><li>conf目录里的配置文件将映射为apache容器的配置文件</li></ul><p>进入创建的apache目录，创建Dockerfile，这个是以Ubuntu系统为参考，CentOS系统使用的话需要修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">FROM debian:jessie</span><br><span class="line"></span><br><span class="line"># add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added</span><br><span class="line">#RUN groupadd -r www-data &amp;&amp; useradd -r --create-home -g www-data www-data</span><br><span class="line"></span><br><span class="line">ENV HTTPD_PREFIX /usr/local/apache2</span><br><span class="line">ENV PATH $PATH:$HTTPD_PREFIX/bin</span><br><span class="line">RUN mkdir -p &quot;$HTTPD_PREFIX&quot; \</span><br><span class="line">    &amp;&amp; chown www-data:www-data &quot;$HTTPD_PREFIX&quot;</span><br><span class="line">WORKDIR $HTTPD_PREFIX</span><br><span class="line"></span><br><span class="line"># install httpd runtime dependencies</span><br><span class="line"># https://httpd.apache.org/docs/2.4/install.html#requirements</span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="line">        libapr1 \</span><br><span class="line">        libaprutil1 \</span><br><span class="line">        libaprutil1-ldap \</span><br><span class="line">        libapr1-dev \</span><br><span class="line">        libaprutil1-dev \</span><br><span class="line">        libpcre++0 \</span><br><span class="line">        libssl1.0.0 \</span><br><span class="line">    &amp;&amp; rm -r /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">ENV HTTPD_VERSION 2.4.20</span><br><span class="line">ENV HTTPD_BZ2_URL https://www.apache.org/dist/httpd/httpd-$HTTPD_VERSION.tar.bz2</span><br><span class="line"></span><br><span class="line">RUN buildDeps=&apos; \</span><br><span class="line">        ca-certificates \</span><br><span class="line">        curl \</span><br><span class="line">        bzip2 \</span><br><span class="line">        gcc \</span><br><span class="line">        libpcre++-dev \</span><br><span class="line">        libssl-dev \</span><br><span class="line">        make \</span><br><span class="line">    &apos; \</span><br><span class="line">    set -x \</span><br><span class="line">    &amp;&amp; apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y --no-install-recommends $buildDeps \</span><br><span class="line">    &amp;&amp; rm -r /var/lib/apt/lists/* \</span><br><span class="line">    \</span><br><span class="line">    &amp;&amp; curl -fSL &quot;$HTTPD_BZ2_URL&quot; -o httpd.tar.bz2 \</span><br><span class="line">    &amp;&amp; curl -fSL &quot;$HTTPD_BZ2_URL.asc&quot; -o httpd.tar.bz2.asc \</span><br><span class="line"># see https://httpd.apache.org/download.cgi#verify</span><br><span class="line">    &amp;&amp; export GNUPGHOME=&quot;$(mktemp -d)&quot; \</span><br><span class="line">    &amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys A93D62ECC3C8EA12DB220EC934EA76E6791485A8 \</span><br><span class="line">    &amp;&amp; gpg --batch --verify httpd.tar.bz2.asc httpd.tar.bz2 \</span><br><span class="line">    &amp;&amp; rm -r &quot;$GNUPGHOME&quot; httpd.tar.bz2.asc \</span><br><span class="line">    \</span><br><span class="line">    &amp;&amp; mkdir -p src \</span><br><span class="line">    &amp;&amp; tar -xvf httpd.tar.bz2 -C src --strip-components=1 \</span><br><span class="line">    &amp;&amp; rm httpd.tar.bz2 \</span><br><span class="line">    &amp;&amp; cd src \</span><br><span class="line">    \</span><br><span class="line">    &amp;&amp; ./configure \</span><br><span class="line">        --prefix=&quot;$HTTPD_PREFIX&quot; \</span><br><span class="line">        --enable-mods-shared=reallyall \</span><br><span class="line">    &amp;&amp; make -j&quot;$(nproc)&quot; \</span><br><span class="line">    &amp;&amp; make install \</span><br><span class="line">    \</span><br><span class="line">    &amp;&amp; cd .. \</span><br><span class="line">    &amp;&amp; rm -r src \</span><br><span class="line">    \</span><br><span class="line">    &amp;&amp; sed -ri \</span><br><span class="line">        -e &apos;s!^(\s*CustomLog)\s+\S+!\1 /proc/self/fd/1!g&apos; \</span><br><span class="line">        -e &apos;s!^(\s*ErrorLog)\s+\S+!\1 /proc/self/fd/2!g&apos; \</span><br><span class="line">        &quot;$HTTPD_PREFIX/conf/httpd.conf&quot; \</span><br><span class="line">    \</span><br><span class="line">    &amp;&amp; apt-get purge -y --auto-remove $buildDeps</span><br><span class="line"></span><br><span class="line">COPY httpd-foreground /usr/local/bin/</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [&quot;httpd-foreground&quot;]</span><br></pre></td></tr></table></figure><p>Dockerfile文件中 COPY httpd-foreground /usr/local/bin/ 是将当前目录下的httpd-foreground拷贝到镜像里，作为httpd服务的启动脚本，所以我们要在本地创建一个脚本文件httpd-foreground</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache gets grumpy about PID files pre-existing</span></span><br><span class="line">rm -f /usr/<span class="built_in">local</span>/apache2/logs/httpd.pid</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> httpd -DFOREGROUND</span><br></pre></td></tr></table></figure><p>赋予httpd-foreground文件可执行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># chmod +x httpd-foreground</span></span><br></pre></td></tr></table></figure><p>通过Dockerfile创建一个镜像，替换成你自己的名字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker build -t httpd .</span></span><br></pre></td></tr></table></figure><p>创建完成后，我们可以在本地的镜像列表里查找到刚刚创建的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images httpd</span></span><br><span class="line">REPOSITORY     TAG        IMAGE ID        CREATED           SIZE</span><br><span class="line">httpd          latest     da1536b4ef14    23 seconds ago    195.1 MB</span><br></pre></td></tr></table></figure><h3 id="使用apache镜像"><a href="#使用apache镜像" class="headerlink" title="使用apache镜像"></a>使用apache镜像</h3><h4 id="运行容器-5"><a href="#运行容器-5" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行后使用docker ps查看，发现没有启动，也就是说这个命令有问题</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -p 80:80 -v $PWD/www/:/usr/local/apache2/htdocs/ -v $PWD/conf/httpd.conf:/usr/local/apache2/conf/httpd.conf -v $PWD/logs/:/usr/local/apache2/logs/ -d httpd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用这个命令可以启动</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -it -d -p 80:80  --name test_docker_httpd -v /home/apache/:/usr/local/apache2/htdocs/ httpd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在/home/apache/目录下新建一个index.html文件，使用浏览器访问测试</span></span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li><p>-p 80:80 :将容器的80端口映射到主机的80端口</p></li><li><p>-v $PWD/www/:/usr/local/apache2/htdocs/ :将主机中当前目录下的www目录挂载到容器的/usr/local/apache2/htdocs/</p></li><li><p>-v $PWD/conf/httpd.conf:/usr/local/apache2/conf/httpd.conf :将主机中当前目录下的conf/httpd.conf文件挂载到容器的/usr/local/apache2/conf/httpd.conf</p></li><li><p>-v $PWD/logs/:/usr/local/apache2/logs/ :将主机中当前目录下的logs目录挂载到容器的/usr/local/apache2/logs/</p></li></ul><p>查看容器启动情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID  IMAGE   COMMAND             ... PORTS               NAMES</span><br><span class="line">79a97f2aac37  httpd   <span class="string">"httpd-foreground"</span>  ... 0.0.0.0:80-&gt;80/tcp  sharp_swanson</span><br></pre></td></tr></table></figure><p>通过浏览器访问，出现的内容是index.html的内容</p><p>但是有个问题，配置文件这个要弄，估计还得从启动httpd的命令处着手，就跟nginx容器启动类似</p><h2 id="MacOS系统配置Nginx-php-mysql的docker使用环境"><a href="#MacOS系统配置Nginx-php-mysql的docker使用环境" class="headerlink" title="MacOS系统配置Nginx+php+mysql的docker使用环境"></a>MacOS系统配置Nginx+php+mysql的docker使用环境</h2><ol><li>创建目录</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /Users/sui/docker/nginx/conf.d &amp;&amp; mkdir /Users/sui/www &amp;&amp;  <span class="built_in">cd</span> /Users/sui/docker/nginx/conf.d &amp;&amp; sudo touch default.conf</span><br></pre></td></tr></table></figure><ol start="2"><li>启动php-fpm</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name sui-php -d -v /Users/sui/www:/var/www/html:ro php:7.1-fpm</span><br><span class="line"><span class="comment"># --name sui-php 是容器的名字</span></span><br><span class="line"><span class="comment"># /Users/sui/www 是本地 php 文件的存储目录，/var/www/html 是容器内 php 文件的存储目录，ro 表示只读</span></span><br></pre></td></tr></table></figure><ol start="3"><li>编辑 nginx 配置文件</li></ol><p>配置文件位置：/Users/sui/docker/nginx/conf.d/default.conf。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass   php:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  /var/www/html/<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># php:9000 表示 php-fpm 服务的访问路径</span></span><br><span class="line"><span class="comment"># /var/www/html 是 sui-php 中 php 文件的存储路径，经 docker 映射，变成本地路径 /Users/sui/www</span></span><br></pre></td></tr></table></figure><ol start="4"><li>启动 nginx</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name sui-nginx -p 80:80 -d -v /Users/sui/www:/usr/share/nginx/html:ro \</span><br><span class="line">    -v /Users/sui/docker/nginx/conf.d:/etc/nginx/conf.d:ro --link sui-php:php nginx</span><br><span class="line"><span class="comment"># -p 80:80 用于添加端口映射，把 sui-nginx 中的 80 端口暴露出来</span></span><br><span class="line"><span class="comment"># /Users/sui/www 是本地html文件的存储目录，/usr/share/nginx/html是容器内html文件的存储目录</span></span><br><span class="line"><span class="comment"># /Users/sui/docker/nginx/conf.d 是本地nginx虚拟主机配置路径，/etc/nginx/conf.d是nginx容器内虚拟主机配置路径(重要)</span></span><br><span class="line"><span class="comment"># --link sui-php:php 把sui-php的网络并入sui-nginx，并通过修改 sui-nginx 的 /etc/hosts，把域名 php 映射成 127.0.0.1，让 nginx 通过 php:9000 访问 php-fpm（这一步至关重要）</span></span><br></pre></td></tr></table></figure><ol start="5"><li><p>测试结果<br>在 /Users/sui/www 下放两个文件：index.html index.php</p></li><li><p>mysql 服务器</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /Users/sui/docker/mysql/data /Users/sui/docker/mysql/logs /Users/sui/docker/mysql/conf</span><br><span class="line"><span class="comment"># data 目录将映射为 mysql 容器配置的数据文件存放路径</span></span><br><span class="line"><span class="comment"># logs 目录将映射为 mysql 容器的日志目录</span></span><br><span class="line"><span class="comment"># conf 目录里的配置文件将映射为 mysql 容器的配置文件</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动docker里的MySQL镜像</span></span><br><span class="line">docker run -p 3306:3306 --name sui-mysql -v /Users/sui/docker/mysql/conf:/etc/mysql -v /Users/sui/docker/mysql/logs:/logs -v /Users/sui/docker/mysql/data:/mysql_data -e MYSQL_ROOT_PASSWORD=123456 -d --link sui-php mysql</span><br></pre></td></tr></table></figure><ol start="7"><li>进入mysql客户端</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --link sui-mysql:mysql --rm mysql sh -c <span class="string">'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'</span></span><br></pre></td></tr></table></figure><ol start="8"><li>phpmyadmin</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name sui-myadmin -d --link sui-mysql:db -p 8080:80 phpmyadmin/phpmyadmin</span><br></pre></td></tr></table></figure><ol start="9"><li>要点</li></ol><p>若某个镜像中需要使用到另一个镜像中的资源，则需要使用<code>-–link</code>进行关联，比如：nginx关联php，php关联mysql等。</p><h1 id="Docker-命令大全"><a href="#Docker-命令大全" class="headerlink" title="Docker 命令大全"></a>Docker 命令大全</h1><h2 id="容器生命周期管理"><a href="#容器生命周期管理" class="headerlink" title="容器生命周期管理"></a>容器生命周期管理</h2><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">docker run ：创建一个新的容器并运行一个命令</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -a stdin: 指定标准输入输出内容类型，可选 STDIN/STDOUT/STDERR 三项；</span><br><span class="line"></span><br><span class="line">    -d: 后台运行容器，并返回容器ID；</span><br><span class="line"></span><br><span class="line">    -i: 以交互模式运行容器，通常与 -t 同时使用；</span><br><span class="line"></span><br><span class="line">    -P: 随机端口映射，容器内部端口随机映射到主机的高端口</span><br><span class="line"></span><br><span class="line">    -p: 指定端口映射，格式为：主机(宿主)端口:容器端口</span><br><span class="line"></span><br><span class="line">    -t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</span><br><span class="line"></span><br><span class="line">    --name=&quot;nginx-lb&quot;: 为容器指定一个名称；</span><br><span class="line"></span><br><span class="line">    --dns 8.8.8.8: 指定容器使用的DNS服务器，默认和宿主一致；</span><br><span class="line"></span><br><span class="line">    --dns-search example.com: 指定容器DNS搜索域名，默认和宿主一致；</span><br><span class="line"></span><br><span class="line">    -h &quot;mars&quot;: 指定容器的hostname；</span><br><span class="line"></span><br><span class="line">    -e username=&quot;ritchie&quot;: 设置环境变量；</span><br><span class="line"></span><br><span class="line">    --env-file=[]: 从指定文件读入环境变量；</span><br><span class="line"></span><br><span class="line">    --cpuset=&quot;0-2&quot; or --cpuset=&quot;0,1,2&quot;: 绑定容器到指定CPU运行；</span><br><span class="line"></span><br><span class="line">    -m :设置容器使用内存最大值；</span><br><span class="line"></span><br><span class="line">    --net=&quot;bridge&quot;: 指定容器的网络连接类型，支持 bridge/host/none/container: 四种类型；</span><br><span class="line"></span><br><span class="line">    --link=[]: 添加链接到另一个容器；</span><br><span class="line"></span><br><span class="line">    --expose=[]: 开放一个端口或一组端口；</span><br><span class="line"></span><br><span class="line">    --volume , -v: 绑定一个卷</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">使用docker镜像nginx:latest以后台模式启动一个容器,并将容器命名为mynginx。</span><br><span class="line"></span><br><span class="line">docker run --name mynginx -d nginx:latest</span><br><span class="line"></span><br><span class="line">使用镜像nginx:latest以后台模式启动一个容器,并将容器的80端口映射到主机随机端口。</span><br><span class="line"></span><br><span class="line">docker run -P -d nginx:latest</span><br><span class="line"></span><br><span class="line">使用镜像 nginx:latest，以后台模式启动一个容器,将容器的 80 端口映射到主机的 80 端口,主机的目录 /data 映射到容器的 /data。</span><br><span class="line"></span><br><span class="line">docker run -p 80:80 -v /data:/data -d nginx:latest</span><br><span class="line"></span><br><span class="line">绑定容器的 8080 端口，并将其映射到本地主机 127.0.0.1 的 80 端口上。</span><br><span class="line"></span><br><span class="line">$ docker run -p 127.0.0.1:80:8080/tcp ubuntu bash</span><br><span class="line"></span><br><span class="line">使用镜像nginx:latest以交互模式启动一个容器,在容器内执行/bin/bash命令。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker run -it nginx:latest /bin/bash</span><br><span class="line">root@b8573233d675:/#</span><br></pre></td></tr></table></figure><h3 id="start-stop-restart"><a href="#start-stop-restart" class="headerlink" title="start/stop/restart"></a>start/stop/restart</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker start :启动一个或多个已经被停止的容器</span><br><span class="line"></span><br><span class="line">docker stop :停止一个运行中的容器</span><br><span class="line"></span><br><span class="line">docker restart :重启容器</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker start [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">docker stop [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">docker restart [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">启动已被停止的容器myrunoob</span><br><span class="line"></span><br><span class="line">docker start myrunoob</span><br><span class="line"></span><br><span class="line">停止运行中的容器myrunoob</span><br><span class="line"></span><br><span class="line">docker stop myrunoob</span><br><span class="line"></span><br><span class="line">重启容器myrunoob</span><br><span class="line"></span><br><span class="line">docker restart myrunoob</span><br></pre></td></tr></table></figure><h3 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker kill :杀掉一个运行中的容器。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker kill [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -s :向容器发送一个信号</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">杀掉运行中的容器mynginx</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker kill -s KILL mynginx</span><br><span class="line">mynginx</span><br></pre></td></tr></table></figure><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker rm ：删除一个或多少容器</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -f :通过SIGKILL信号强制删除一个运行中的容器</span><br><span class="line"></span><br><span class="line">    -l :移除容器间的网络连接，而非容器本身</span><br><span class="line"></span><br><span class="line">    -v :-v 删除与容器关联的卷</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">强制删除容器db01、db02</span><br><span class="line"></span><br><span class="line">docker rm -f db01 db02</span><br><span class="line"></span><br><span class="line">移除容器nginx01对容器db01的连接，连接名db</span><br><span class="line"></span><br><span class="line">docker rm -l db </span><br><span class="line"></span><br><span class="line">删除容器nginx01,并删除容器挂载的数据卷</span><br><span class="line"></span><br><span class="line">docker rm -v nginx01</span><br></pre></td></tr></table></figure><h3 id="pause-unpause"><a href="#pause-unpause" class="headerlink" title="pause/unpause"></a>pause/unpause</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker pause :暂停容器中所有的进程。</span><br><span class="line"></span><br><span class="line">docker unpause :恢复容器中所有的进程。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker pause [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">docker unpause [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">暂停数据库容器db01提供服务。</span><br><span class="line"></span><br><span class="line">docker pause db01</span><br><span class="line"></span><br><span class="line">恢复数据库容器db01提供服务。</span><br><span class="line"></span><br><span class="line">docker unpause db01</span><br></pre></td></tr></table></figure><h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker create ：创建一个新的容器但不启动它</span><br><span class="line"></span><br><span class="line">用法同 docker run</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker create [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">语法同 docker run</span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">使用docker镜像nginx:latest创建一个容器,并将容器命名为myrunoob</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker create  --name myrunoob  nginx:latest      </span><br><span class="line">09b93464c2f75b7b69f83d56a9cfc23ceb50a48a9db7652ee4c27e3e2cb1961f</span><br></pre></td></tr></table></figure><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">docker exec ：在运行的容器中执行命令</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -d :分离模式: 在后台运行</span><br><span class="line"></span><br><span class="line">    -i :即使没有附加也保持STDIN 打开</span><br><span class="line"></span><br><span class="line">    -t :分配一个伪终端</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">在容器 mynginx 中以交互模式执行容器内 /root/runoob.sh 脚本:</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker exec -it mynginx /bin/sh /root/runoob.sh</span><br><span class="line">http://www.runoob.com/</span><br><span class="line"></span><br><span class="line">在容器 mynginx 中开启一个交互模式的终端:</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker exec -i -t  mynginx /bin/bash</span><br><span class="line">root@b1a0703e41e7:/#</span><br><span class="line"></span><br><span class="line">也可以通过 docker ps -a 命令查看已经在运行的容器，然后使用容器 ID 进入容器。</span><br><span class="line"></span><br><span class="line">查看已经在运行的容器 ID：</span><br><span class="line"></span><br><span class="line"># docker ps -a </span><br><span class="line">...</span><br><span class="line">9df70f9a0714        openjdk             &quot;/usercode/script.sh…&quot; </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">第一列的 9df70f9a0714 就是容器 ID。</span><br><span class="line"></span><br><span class="line">通过 exec 命令对指定的容器执行 bash:</span><br><span class="line"></span><br><span class="line"># docker exec -it 9df70f9a0714 /bin/bash</span><br></pre></td></tr></table></figure><h2 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h2><h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">docker ps : 列出容器</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker ps [OPTIONS]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -a :显示所有的容器，包括未运行的。</span><br><span class="line"></span><br><span class="line">    -f :根据条件过滤显示的内容。</span><br><span class="line"></span><br><span class="line">    --format :指定返回值的模板文件。</span><br><span class="line"></span><br><span class="line">    -l :显示最近创建的容器。</span><br><span class="line"></span><br><span class="line">    -n :列出最近创建的n个容器。</span><br><span class="line"></span><br><span class="line">    --no-trunc :不截断输出。</span><br><span class="line"></span><br><span class="line">    -q :静默模式，只显示容器编号。</span><br><span class="line"></span><br><span class="line">    -s :显示总的文件大小。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">列出所有在运行的容器信息。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                ...  PORTS                    NAMES</span><br><span class="line">09b93464c2f7   nginx:latest   &quot;nginx -g &apos;daemon off&quot; ...  80/tcp, 443/tcp          myrunoob</span><br><span class="line">96f7f14e99ab   mysql:5.6      &quot;docker-entrypoint.sh&quot; ...  0.0.0.0:3306-&gt;3306/tcp   mymysql</span><br><span class="line"></span><br><span class="line">列出最近创建的5个容器信息。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker ps -n 5</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                   CREATED           </span><br><span class="line">09b93464c2f7        nginx:latest        &quot;nginx -g &apos;daemon off&quot;    2 days ago   ...     </span><br><span class="line">b8573233d675        nginx:latest        &quot;/bin/bash&quot;               2 days ago   ...     </span><br><span class="line">b1a0703e41e7        nginx:latest        &quot;nginx -g &apos;daemon off&quot;    2 days ago   ...    </span><br><span class="line">f46fb1dec520        5c6e1090e771        &quot;/bin/sh -c &apos;set -x \t&quot;   2 days ago   ...   </span><br><span class="line">a63b4a5597de        860c279d2fec        &quot;bash&quot;                    2 days ago   ...</span><br><span class="line"></span><br><span class="line">列出所有创建的容器ID。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker ps -a -q</span><br><span class="line">09b93464c2f7</span><br><span class="line">b8573233d675</span><br><span class="line">b1a0703e41e7</span><br><span class="line">f46fb1dec520</span><br><span class="line">a63b4a5597de</span><br><span class="line">6a4aa42e947b</span><br><span class="line">de7bb36e7968</span><br><span class="line">43a432b73776</span><br><span class="line">664a8ab1a585</span><br><span class="line">ba52eb632bbd</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">根据条件过滤显示的内容</span><br><span class="line"></span><br><span class="line">根据标签过滤</span><br><span class="line"></span><br><span class="line">$ docker run -d --name=test-nginx --label color=blue nginx</span><br><span class="line">$ docker ps --filter &quot;label=color&quot;</span><br><span class="line">$ docker ps --filter &quot;label=color=blue&quot;</span><br><span class="line"></span><br><span class="line">根据名称过滤</span><br><span class="line"></span><br><span class="line">$ docker ps --filter&quot;name=test-nginx&quot;</span><br><span class="line"></span><br><span class="line">根据状态过滤</span><br><span class="line"></span><br><span class="line">$ docker ps -a --filter &apos;exited=0&apos;</span><br><span class="line">$ docker ps --filter status=running</span><br><span class="line">$ docker ps --filter status=paused</span><br><span class="line"></span><br><span class="line">根据镜像过滤</span><br><span class="line"></span><br><span class="line">#镜像名称</span><br><span class="line">$ docker ps --filter ancestor=nginx</span><br><span class="line"></span><br><span class="line">#镜像ID</span><br><span class="line">$ docker ps --filter ancestor=d0e008c6cf02</span><br><span class="line"></span><br><span class="line">根据启动顺序过滤</span><br><span class="line"></span><br><span class="line">$ docker ps -f before=9c3527ed70ce</span><br><span class="line">$ docker ps -f since=6e63f6ff38b0</span><br></pre></td></tr></table></figure><h3 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">docker inspect : 获取容器/镜像的元数据。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -f :指定返回值的模板文件。</span><br><span class="line"></span><br><span class="line">    -s :显示总的文件大小。</span><br><span class="line"></span><br><span class="line">    --type :为指定类型返回JSON。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">获取镜像mysql:5.6的元信息。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker inspect mysql:5.6</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:2c0964ec182ae9a045f866bbc2553087f6e42bfc16074a74fb820af235f070ec&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;mysql:5.6&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2016-05-24T04:01:41.168371815Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;e0924bc460ff97787f34610115e9363e6363b30b8efa406e28eb495ab199ca54&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;b0cf605c7757&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;3306/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">获取正在运行的容器mymysql的 IP。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker inspect --format=&apos;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&apos; mymysql</span><br><span class="line">172.17.0.3</span><br></pre></td></tr></table></figure><h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker top :查看容器中运行的进程信息，支持 ps 命令参数。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker top [OPTIONS] CONTAINER [ps OPTIONS]</span><br><span class="line"></span><br><span class="line">容器运行时不一定有/bin/bash终端来交互执行top命令，而且容器还不一定有top命令，可以使用docker top来实现查看container中正在运行的进程。</span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">查看容器mymysql的进程信息。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~/mysql$ docker top mymysql</span><br><span class="line">UID    PID    PPID    C      STIME   TTY  TIME       CMD</span><br><span class="line">999    40347  40331   18     00:58   ?    00:00:02   mysqld</span><br><span class="line"></span><br><span class="line">查看所有运行容器的进程信息。</span><br><span class="line"></span><br><span class="line">for i in  `docker ps |grep Up|awk &apos;&#123;print $1&#125;&apos;`;do echo \ &amp;&amp;docker top $i; done</span><br></pre></td></tr></table></figure><h3 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker attach :连接到正在运行中的容器。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker attach [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">要attach上去的容器必须正在运行，可以同时连接上同一个container来共享屏幕（与screen命令的attach类似）。</span><br><span class="line"></span><br><span class="line">官方文档中说attach后可以通过CTRL-C来detach，但实际上经过我的测试，如果container当前在运行bash，CTRL-C自然是当前行的输入，没有退出；如果container当前正在前台运行进程，如输出nginx的access.log日志，CTRL-C不仅会导致退出容器，而且还stop了。这不是我们想要的，detach的意思按理应该是脱离容器终端，但容器依然运行。好在attach是可以带上--sig-proxy=false来确保CTRL-D或CTRL-C不会关闭容器。</span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">容器mynginx将访问日志指到标准输出，连接到容器查看访问信息。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker attach --sig-proxy=false mynginx</span><br><span class="line">192.168.239.1 - - [10/Jul/2016:16:54:26 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93 Safari/537.36&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure><h3 id="events"><a href="#events" class="headerlink" title="events"></a>events</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">docker events : 从服务器获取实时事件</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker events [OPTIONS]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -f ：根据条件过滤事件；</span><br><span class="line"></span><br><span class="line">    --since ：从指定的时间戳后显示所有事件;</span><br><span class="line"></span><br><span class="line">    --until ：流水时间显示到指定的时间为止；</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">显示docker 2016年7月1日后的所有事件。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~/mysql$ docker events  --since=&quot;1467302400&quot;</span><br><span class="line">2016-07-08T19:44:54.501277677+08:00 network connect 66f958fd13dc4314ad20034e576d5c5eba72e0849dcc38ad9e8436314a4149d4 (container=b8573233d675705df8c89796a2c2687cd8e36e03646457a15fb51022db440e64, name=bridge, type=bridge)</span><br><span class="line">2016-07-08T19:44:54.723876221+08:00 container start b8573233d675705df8c89796a2c2687cd8e36e03646457a15fb51022db440e64 (image=nginx:latest, name=elegant_albattani)</span><br><span class="line">2016-07-08T19:44:54.726110498+08:00 container resize b8573233d675705df8c89796a2c2687cd8e36e03646457a15fb51022db440e64 (height=39, image=nginx:latest, name=elegant_albattani, width=167)</span><br><span class="line">2016-07-08T19:46:22.137250899+08:00 container die b8573233d675705df8c89796a2c2687cd8e36e03646457a15fb51022db440e64 (exitCode=0, image=nginx:latest, name=elegant_albattani)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">显示docker 镜像为mysql:5.6 2016年7月1日后的相关事件。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~/mysql$ docker events -f &quot;image&quot;=&quot;mysql:5.6&quot; --since=&quot;1467302400&quot; </span><br><span class="line">2016-07-11T00:38:53.975174837+08:00 container start 96f7f14e99ab9d2f60943a50be23035eda1623782cc5f930411bbea407a2bb10 (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:51:17.022572452+08:00 container kill 96f7f14e99ab9d2f60943a50be23035eda1623782cc5f930411bbea407a2bb10 (image=mysql:5.6, name=mymysql, signal=9)</span><br><span class="line">2016-07-11T00:51:17.132532080+08:00 container die 96f7f14e99ab9d2f60943a50be23035eda1623782cc5f930411bbea407a2bb10 (exitCode=137, image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:51:17.514661357+08:00 container destroy 96f7f14e99ab9d2f60943a50be23035eda1623782cc5f930411bbea407a2bb10 (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:57:18.551984549+08:00 container create c8f0a32f12f5ec061d286af0b1285601a3e33a90a08ff1706de619ac823c345c (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:57:18.557405864+08:00 container attach c8f0a32f12f5ec061d286af0b1285601a3e33a90a08ff1706de619ac823c345c (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:57:18.844134112+08:00 container start c8f0a32f12f5ec061d286af0b1285601a3e33a90a08ff1706de619ac823c345c (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:57:19.140141428+08:00 container die c8f0a32f12f5ec061d286af0b1285601a3e33a90a08ff1706de619ac823c345c (exitCode=1, image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:58:05.941019136+08:00 container destroy c8f0a32f12f5ec061d286af0b1285601a3e33a90a08ff1706de619ac823c345c (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:58:07.965128417+08:00 container create a404c6c174a21c52f199cfce476e041074ab020453c7df2a13a7869b48f2f37e (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:58:08.188734598+08:00 container start a404c6c174a21c52f199cfce476e041074ab020453c7df2a13a7869b48f2f37e (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T00:58:20.010876777+08:00 container top a404c6c174a21c52f199cfce476e041074ab020453c7df2a13a7869b48f2f37e (image=mysql:5.6, name=mymysql)</span><br><span class="line">2016-07-11T01:06:01.395365098+08:00 container top a404c6c174a21c52f199cfce476e041074ab020453c7df2a13a7869b48f2f37e (image=mysql:5.6, name=mymysql)</span><br><span class="line"></span><br><span class="line">如果指定的时间是到秒级的，需要将时间转成时间戳。如果时间为日期的话，可以直接使用，如--since=&quot;2016-07-01&quot;。</span><br></pre></td></tr></table></figure><h3 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">docker logs : 获取容器的日志</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -f : 跟踪日志输出</span><br><span class="line"></span><br><span class="line">    --since :显示某个开始时间的所有日志</span><br><span class="line"></span><br><span class="line">    -t : 显示时间戳</span><br><span class="line"></span><br><span class="line">    --tail :仅列出最新N条容器日志</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">跟踪查看容器mynginx的日志输出。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker logs -f mynginx</span><br><span class="line">192.168.239.1 - - [10/Jul/2016:16:53:33 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line">2016/07/10 16:53:33 [error] 5#5: *1 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 192.168.239.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;192.168.239.130&quot;, referrer: &quot;http://192.168.239.130/&quot;</span><br><span class="line">192.168.239.1 - - [10/Jul/2016:16:53:33 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 571 &quot;http://192.168.239.130/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line">192.168.239.1 - - [10/Jul/2016:16:53:59 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">查看容器mynginx从2016年7月1日后的最新10条日志。</span><br><span class="line"></span><br><span class="line">docker logs --since=&quot;2016-07-01&quot; --tail=10 mynginx</span><br></pre></td></tr></table></figure><h3 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker wait : 阻塞运行直到容器停止，然后打印出它的退出代码。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker wait [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">docker wait CONTAINER</span><br></pre></td></tr></table></figure><h3 id="export"><a href="#export" class="headerlink" title="export"></a>export</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker export :将文件系统作为一个tar归档文件导出到STDOUT。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker export [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -o :将输入内容写到文件。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">将id为a404c6c174a2的容器按日期保存为tar文件。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker export -o mysql-`date +%Y%m%d`.tar a404c6c174a2</span><br><span class="line">runoob@runoob:~$ ls mysql-`date +%Y%m%d`.tar</span><br><span class="line">mysql-20160711.tar</span><br></pre></td></tr></table></figure><h3 id="port"><a href="#port" class="headerlink" title="port"></a>port</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker port :列出指定的容器的端口映射，或者查找将PRIVATE_PORT NAT到面向公众的端口。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker port [OPTIONS] CONTAINER [PRIVATE_PORT[/PROTO]]</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">查看容器mynginx的端口映射情况。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker port mymysql</span><br><span class="line">3306/tcp -&gt; 0.0.0.0:3306</span><br></pre></td></tr></table></figure><h2 id="容器rootfs命令"><a href="#容器rootfs命令" class="headerlink" title="容器rootfs命令"></a>容器rootfs命令</h2><h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker commit :从容器创建一个新的镜像。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -a :提交的镜像作者；</span><br><span class="line"></span><br><span class="line">    -c :使用Dockerfile指令来创建镜像；</span><br><span class="line"></span><br><span class="line">    -m :提交时的说明文字；</span><br><span class="line"></span><br><span class="line">    -p :在commit时，将容器暂停。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">将容器a404c6c174a2 保存为新的镜像,并添加提交人信息和说明信息。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker commit -a &quot;runoob.com&quot; -m &quot;my apache&quot; a404c6c174a2  mymysql:v1 </span><br><span class="line">sha256:37af1236adef1544e8886be23010b66577647a40bc02c0885a6600b33ee28057</span><br><span class="line">runoob@runoob:~$ docker images mymysql:v1</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mymysql             v1                  37af1236adef        15 seconds ago      329 MB</span><br></pre></td></tr></table></figure><h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker cp :用于容器与主机之间的数据拷贝。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line"></span><br><span class="line">docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -L :保持源目标中的链接</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">将主机/www/runoob目录拷贝到容器96f7f14e99ab的/www目录下。</span><br><span class="line"></span><br><span class="line">docker cp /www/runoob 96f7f14e99ab:/www/</span><br><span class="line"></span><br><span class="line">将主机/www/runoob目录拷贝到容器96f7f14e99ab中，目录重命名为www。</span><br><span class="line"></span><br><span class="line">docker cp /www/runoob 96f7f14e99ab:/www</span><br><span class="line"></span><br><span class="line">将容器96f7f14e99ab的/www目录拷贝到主机的/tmp目录中。</span><br><span class="line"></span><br><span class="line">docker cp  96f7f14e99ab:/www /tmp/</span><br></pre></td></tr></table></figure><h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker diff : 检查容器里文件结构的更改。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker diff [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">查看容器mymysql的文件结构更改。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker diff mymysql</span><br><span class="line">A /logs</span><br><span class="line">A /mysql_data</span><br><span class="line">C /run</span><br><span class="line">C /run/mysqld</span><br><span class="line">A /run/mysqld/mysqld.pid</span><br><span class="line">A /run/mysqld/mysqld.sock</span><br><span class="line">C /tmp</span><br></pre></td></tr></table></figure><h2 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h2><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker login : 登陆到一个Docker镜像仓库，如果未指定镜像仓库地址，默认为官方仓库 Docker Hub</span><br><span class="line"></span><br><span class="line">docker logout : 登出一个Docker镜像仓库，如果未指定镜像仓库地址，默认为官方仓库 Docker Hub</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">docker logout [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -u :登陆的用户名</span><br><span class="line"></span><br><span class="line">    -p :登陆的密码</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">登陆到Docker Hub</span><br><span class="line"></span><br><span class="line">docker login -u 用户名 -p 密码</span><br><span class="line"></span><br><span class="line">登出Docker Hub</span><br><span class="line"></span><br><span class="line">docker logout</span><br></pre></td></tr></table></figure><h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker pull : 从镜像仓库中拉取或者更新指定镜像</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -a :拉取所有 tagged 镜像</span><br><span class="line"></span><br><span class="line">    --disable-content-trust :忽略镜像的校验,默认开启</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">从Docker Hub下载java最新版镜像。</span><br><span class="line"></span><br><span class="line">docker pull java</span><br><span class="line"></span><br><span class="line">从Docker Hub下载REPOSITORY为java的所有镜像。</span><br><span class="line"></span><br><span class="line">docker pull -a java</span><br></pre></td></tr></table></figure><h3 id="push"><a href="#push" class="headerlink" title="push"></a>push</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker push : 将本地的镜像上传到镜像仓库,要先登陆到镜像仓库</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker push [OPTIONS] NAME[:TAG]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    --disable-content-trust :忽略镜像的校验,默认开启</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">上传本地镜像myapache:v1到镜像仓库中。</span><br><span class="line"></span><br><span class="line">docker push myapache:v1</span><br></pre></td></tr></table></figure><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker search : 从Docker Hub查找镜像</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    --automated :只列出 automated build类型的镜像；</span><br><span class="line"></span><br><span class="line">    --no-trunc :显示完整的镜像描述；</span><br><span class="line"></span><br><span class="line">    -s :列出收藏数不小于指定值的镜像。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">从Docker Hub查找所有镜像名包含java，并且收藏数大于10的镜像</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker search -s 10 java</span><br><span class="line">NAME                  DESCRIPTION                           STARS   OFFICIAL   AUTOMATED</span><br><span class="line">java                  Java is a concurrent, class-based...   1037    [OK]       </span><br><span class="line">anapsix/alpine-java   Oracle Java 8 (and 7) with GLIBC ...   115                [OK]</span><br><span class="line">develar/java                                                 46                 [OK]</span><br><span class="line">isuper/java-oracle    This repository contains all java...   38                 [OK]</span><br><span class="line">lwieske/java-8        Oracle Java 8 Container - Full + ...   27                 [OK]</span><br><span class="line">nimmis/java-centos    This is docker images of CentOS 7...   13                 [OK]</span><br></pre></td></tr></table></figure><h2 id="本地镜像管理"><a href="#本地镜像管理" class="headerlink" title="本地镜像管理"></a>本地镜像管理</h2><h3 id="images"><a href="#images" class="headerlink" title="images"></a>images</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">docker images : 列出本地镜像。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -a :列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；</span><br><span class="line"></span><br><span class="line">    --digests :显示镜像的摘要信息；</span><br><span class="line"></span><br><span class="line">    -f :显示满足条件的镜像；</span><br><span class="line"></span><br><span class="line">    --format :指定返回值的模板文件；</span><br><span class="line"></span><br><span class="line">    --no-trunc :显示完整的镜像信息；</span><br><span class="line"></span><br><span class="line">    -q :只显示镜像ID。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">查看本地镜像列表。</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker images</span><br><span class="line">REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mymysql                 v1                  37af1236adef        5 minutes ago       329 MB</span><br><span class="line">runoob/ubuntu           v4                  1c06aa18edee        2 days ago          142.1 MB</span><br><span class="line">&lt;none&gt;                  &lt;none&gt;              5c6e1090e771        2 days ago          165.9 MB</span><br><span class="line">httpd                   latest              ed38aaffef30        11 days ago         195.1 MB</span><br><span class="line">alpine                  latest              4e38e38c8ce0        2 weeks ago         4.799 MB</span><br><span class="line">mongo                   3.2                 282fd552add6        3 weeks ago         336.1 MB</span><br><span class="line">redis                   latest              4465e4bcad80        3 weeks ago         185.7 MB</span><br><span class="line">php                     5.6-fpm             025041cd3aa5        3 weeks ago         456.3 MB</span><br><span class="line">python                  3.5                 045767ddf24a        3 weeks ago         684.1 MB</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">列出本地镜像中REPOSITORY为ubuntu的镜像列表。</span><br><span class="line"></span><br><span class="line">root@runoob:~# docker images  ubuntu</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              14.04               90d5884b1ee0        9 weeks ago         188 MB</span><br><span class="line">ubuntu              15.10               4e3b13c8a266        3 months ago        136.3 MB</span><br></pre></td></tr></table></figure><h3 id="rmi"><a href="#rmi" class="headerlink" title="rmi"></a>rmi</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">docker rmi : 删除本地一个或多少镜像。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -f :强制删除；</span><br><span class="line"></span><br><span class="line">    --no-prune :不移除该镜像的过程镜像，默认移除；</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">强制删除本地镜像 runoob/ubuntu:v4。</span><br><span class="line"></span><br><span class="line">root@runoob:~# docker rmi -f runoob/ubuntu:v4</span><br><span class="line">Untagged: runoob/ubuntu:v4</span><br><span class="line">Deleted: sha256:1c06aa18edee44230f93a90a7d88139235de12cd4c089d41eed8419b503072be</span><br><span class="line">Deleted: sha256:85feb446e89a28d58ee7d80ea5ce367eebb7cec70f0ec18aa4faa874cbd97c73</span><br><span class="line"></span><br><span class="line">prune 命令用来删除不再使用的 docker 对象。</span><br><span class="line">删除所有未被 tag 标记和未被容器使用的镜像:</span><br><span class="line"></span><br><span class="line">$ docker image prune</span><br><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to continue? [y/N] y</span><br><span class="line"></span><br><span class="line">删除所有未被容器使用的镜像:</span><br><span class="line"></span><br><span class="line">$ docker image prune -a</span><br><span class="line"></span><br><span class="line">删除所有停止运行的容器:</span><br><span class="line"></span><br><span class="line">$ docker container prune</span><br><span class="line"></span><br><span class="line">删除所有未被挂载的卷:</span><br><span class="line"></span><br><span class="line">$ docker volume prune</span><br><span class="line"></span><br><span class="line">删除所有网络:</span><br><span class="line"></span><br><span class="line">$ docker network prune</span><br><span class="line"></span><br><span class="line">删除 docker 所有资源:</span><br><span class="line"></span><br><span class="line">$ docker system prune</span><br></pre></td></tr></table></figure><h3 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker tag : 标记本地镜像，将其归入某一仓库。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">将镜像ubuntu:15.10标记为 runoob/ubuntu:v3 镜像。</span><br><span class="line"></span><br><span class="line">root@runoob:~# docker tag ubuntu:15.10 runoob/ubuntu:v3</span><br><span class="line">root@runoob:~# docker images   runoob/ubuntu:v3</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">runoob/ubuntu       v3                  4e3b13c8a266        3 months ago        136.3 MB</span><br></pre></td></tr></table></figure><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">docker build 命令用于使用 Dockerfile 创建镜像。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker build [OPTIONS] PATH | URL | -</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    --build-arg=[] :设置镜像创建时的变量；</span><br><span class="line"></span><br><span class="line">    --cpu-shares :设置 cpu 使用权重；</span><br><span class="line"></span><br><span class="line">    --cpu-period :限制 CPU CFS周期；</span><br><span class="line"></span><br><span class="line">    --cpu-quota :限制 CPU CFS配额；</span><br><span class="line"></span><br><span class="line">    --cpuset-cpus :指定使用的CPU id；</span><br><span class="line"></span><br><span class="line">    --cpuset-mems :指定使用的内存 id；</span><br><span class="line"></span><br><span class="line">    --disable-content-trust :忽略校验，默认开启；</span><br><span class="line"></span><br><span class="line">    -f :指定要使用的Dockerfile路径；</span><br><span class="line"></span><br><span class="line">    --force-rm :设置镜像过程中删除中间容器；</span><br><span class="line"></span><br><span class="line">    --isolation :使用容器隔离技术；</span><br><span class="line"></span><br><span class="line">    --label=[] :设置镜像使用的元数据；</span><br><span class="line"></span><br><span class="line">    -m :设置内存最大值；</span><br><span class="line"></span><br><span class="line">    --memory-swap :设置Swap的最大值为内存+swap，&quot;-1&quot;表示不限swap；</span><br><span class="line"></span><br><span class="line">    --no-cache :创建镜像的过程不使用缓存；</span><br><span class="line"></span><br><span class="line">    --pull :尝试去更新镜像的新版本；</span><br><span class="line"></span><br><span class="line">    --quiet, -q :安静模式，成功后只输出镜像 ID；</span><br><span class="line"></span><br><span class="line">    --rm :设置镜像成功后删除中间容器；</span><br><span class="line"></span><br><span class="line">    --shm-size :设置/dev/shm的大小，默认值是64M；</span><br><span class="line"></span><br><span class="line">    --ulimit :Ulimit配置。</span><br><span class="line"></span><br><span class="line">    --tag, -t: 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</span><br><span class="line"></span><br><span class="line">    --network: 默认 default。在构建期间设置RUN指令的网络模式</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">使用当前目录的 Dockerfile 创建镜像，标签为 runoob/ubuntu:v1。</span><br><span class="line"></span><br><span class="line">docker build -t runoob/ubuntu:v1 . </span><br><span class="line"></span><br><span class="line">使用URL github.com/creack/docker-firefox 的 Dockerfile 创建镜像。</span><br><span class="line"></span><br><span class="line">docker build github.com/creack/docker-firefox</span><br><span class="line"></span><br><span class="line">也可以通过 -f Dockerfile 文件的位置：</span><br><span class="line"></span><br><span class="line">$ docker build -f /path/to/a/Dockerfile .</span><br><span class="line"></span><br><span class="line">在 Docker 守护进程执行 Dockerfile 中的指令前，首先会对 Dockerfile 进行语法检查，有语法错误时会返回：</span><br><span class="line"></span><br><span class="line">$ docker build -t test/myapp .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Error response from daemon: Unknown instruction: RUNCMD</span><br></pre></td></tr></table></figure><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">docker history : 查看指定镜像的创建历史。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker history [OPTIONS] IMAGE</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -H :以可读的格式打印镜像大小和日期，默认为true；</span><br><span class="line"></span><br><span class="line">    --no-trunc :显示完整的提交记录；</span><br><span class="line"></span><br><span class="line">    -q :仅列出提交记录ID。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">查看本地镜像runoob/ubuntu:v3的创建历史。</span><br><span class="line"></span><br><span class="line">root@runoob:~# docker history runoob/ubuntu:v3</span><br><span class="line">IMAGE             CREATED           CREATED BY                                      SIZE      COMMENT</span><br><span class="line">4e3b13c8a266      3 months ago      /bin/sh -c #(nop) CMD [&quot;/bin/bash&quot;]             0 B                 </span><br><span class="line">&lt;missing&gt;         3 months ago      /bin/sh -c sed -i &apos;s/^#\s*\(deb.*universe\)$/   1.863 kB            </span><br><span class="line">&lt;missing&gt;         3 months ago      /bin/sh -c set -xe   &amp;&amp; echo &apos;#!/bin/sh&apos; &gt; /u   701 B               </span><br><span class="line">&lt;missing&gt;         3 months ago      /bin/sh -c #(nop) ADD file:43cb048516c6b80f22   136.3 MB</span><br></pre></td></tr></table></figure><h3 id="save"><a href="#save" class="headerlink" title="save"></a>save</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">docker save : 将指定镜像保存成 tar 归档文件。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker save [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line">OPTIONS 说明：</span><br><span class="line"></span><br><span class="line">    -o :输出到的文件。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">将镜像 runoob/ubuntu:v3 生成 my_ubuntu_v3.tar 文档</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker save -o my_ubuntu_v3.tar runoob/ubuntu:v3</span><br><span class="line">runoob@runoob:~$ ll my_ubuntu_v3.tar</span><br><span class="line">-rw------- 1 runoob runoob 142102016 Jul 11 01:37 my_ubuntu_v3.ta</span><br><span class="line"></span><br><span class="line">docker 容器导入导出有两种方法：</span><br><span class="line"></span><br><span class="line">一种是使用 save 和 load 命令</span><br><span class="line"></span><br><span class="line">使用例子如下：</span><br><span class="line"></span><br><span class="line">docker save ubuntu:load&gt;/root/ubuntu.tar</span><br><span class="line">docker load&lt;ubuntu.tar</span><br><span class="line"></span><br><span class="line">一种是使用 export 和 import 命令</span><br><span class="line"></span><br><span class="line">使用例子如下：</span><br><span class="line"></span><br><span class="line">docker export 98ca36&gt; ubuntu.tar</span><br><span class="line">cat ubuntu.tar | sudo docker import - ubuntu:import</span><br><span class="line"></span><br><span class="line">需要注意两种方法不可混用。</span><br></pre></td></tr></table></figure><h3 id="load"><a href="#load" class="headerlink" title="load"></a>load</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker load : 导入使用 docker save 命令导出的镜像。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker load [OPTIONS]</span><br><span class="line"></span><br><span class="line">OPTIONS 说明：</span><br><span class="line"></span><br><span class="line">    -i :指定导出的文件。</span><br><span class="line"></span><br><span class="line">    -q :精简输出信息。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">导入镜像：</span><br><span class="line"></span><br><span class="line">docker load -i ubuntu.tar</span><br><span class="line">docker load &lt; ubuntu.tar</span><br></pre></td></tr></table></figure><h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker import : 从归档文件中创建镜像。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -c :应用docker 指令创建镜像；</span><br><span class="line"></span><br><span class="line">    -m :提交时的说明文字；</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">从镜像归档文件my_ubuntu_v3.tar创建镜像，命名为runoob/ubuntu:v4</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker import  my_ubuntu_v3.tar runoob/ubuntu:v4  </span><br><span class="line">sha256:63ce4a6d6bc3fabb95dbd6c561404a309b7bdfc4e21c1d59fe9fe4299cbfea39</span><br><span class="line">runoob@runoob:~$ docker images runoob/ubuntu:v4</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">runoob/ubuntu       v4                  63ce4a6d6bc3        20 seconds ago      142.1 MB</span><br></pre></td></tr></table></figure><h2 id="info-version"><a href="#info-version" class="headerlink" title="info|version"></a>info|version</h2><h3 id="info"><a href="#info" class="headerlink" title="info"></a>info</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker info : 显示 Docker 系统信息，包括镜像和容器数。。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker info [OPTIONS]</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">查看docker系统信息。</span><br><span class="line"></span><br><span class="line">$ docker info</span><br><span class="line">Containers: 12</span><br><span class="line">Images: 41</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 66</span><br><span class="line"> Dirperm1 Supported: false</span><br><span class="line">Execution Driver: native-0.2</span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Kernel Version: 3.13.0-32-generic</span><br><span class="line">Operating System: Ubuntu 14.04.1 LTS</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 1.954 GiB</span><br><span class="line">Name: iZ23mtq8bs1Z</span><br><span class="line">ID: M5N4:K6WN:PUNC:73ZN:AONJ:AUHL:KSYH:2JPI:CH3K:O4MK:6OCX:5OYW</span><br></pre></td></tr></table></figure><h3 id="version"><a href="#version" class="headerlink" title="version"></a>version</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">docker version :显示 Docker 版本信息。</span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">docker version [OPTIONS]</span><br><span class="line"></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">    -f :指定返回值的模板文件。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">显示 Docker 版本信息。</span><br><span class="line"></span><br><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      1.8.2</span><br><span class="line"> API version:  1.20</span><br><span class="line"> Go version:   go1.4.2</span><br><span class="line"> Git commit:   0a8c2e3</span><br><span class="line"> Built:        Thu Sep 10 19:19:00 UTC 2015</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      1.8.2</span><br><span class="line"> API version:  1.20</span><br><span class="line"> Go version:   go1.4.2</span><br><span class="line"> Git commit:   0a8c2e3</span><br><span class="line"> Built:        Thu Sep 10 19:19:00 UTC 2015</span><br><span class="line"> OS/Arch:      linux/amd64</span><br></pre></td></tr></table></figure><h1 id="Docker-资源汇总"><a href="#Docker-资源汇总" class="headerlink" title="Docker 资源汇总"></a>Docker 资源汇总</h1><h2 id="Docker官方英文资源"><a href="#Docker官方英文资源" class="headerlink" title="Docker官方英文资源"></a>Docker官方英文资源</h2><p>docker官网：<a href="http://www.docker.com" target="_blank" rel="noopener">http://www.docker.com</a></p><p>Docker Windows 入门：<a href="https://docs.docker.com/docker-for-windows/" target="_blank" rel="noopener">https://docs.docker.com/docker-for-windows/</a></p><p>Docker CE(社区版) Ubuntu：<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p><p>Docker mac 入门：<a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">https://docs.docker.com/docker-for-mac/</a></p><p>Docker 用户指引：<a href="https://docs.docker.com/config/daemon/" target="_blank" rel="noopener">https://docs.docker.com/config/daemon/</a></p><p>Docker 官方博客：<a href="http://blog.docker.com/" target="_blank" rel="noopener">http://blog.docker.com/</a></p><p>Docker Hub: <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><p>Docker开源： <a href="https://www.docker.com/open-source" target="_blank" rel="noopener">https://www.docker.com/open-source</a></p><h2 id="Docker中文资源"><a href="#Docker中文资源" class="headerlink" title="Docker中文资源"></a>Docker中文资源</h2><p>Docker中文网站：<a href="https://www.docker-cn.com/" target="_blank" rel="noopener">https://www.docker-cn.com/</a></p><p>Docker安装手册：<a href="https://docs.docker-cn.com/engine/installation/" target="_blank" rel="noopener">https://docs.docker-cn.com/engine/installation/</a></p><h2 id="Docker-国内镜像"><a href="#Docker-国内镜像" class="headerlink" title="Docker 国内镜像"></a>Docker 国内镜像</h2><p>阿里云的加速器：<a href="https://help.aliyun.com/document_detail/60750.html" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/60750.html</a></p><p>网易加速器：<a href="http://hub-mirror.c.163.com" target="_blank" rel="noopener">http://hub-mirror.c.163.com</a></p><p>官方中国加速器：<a href="https://registry.docker-cn.com" target="_blank" rel="noopener">https://registry.docker-cn.com</a></p><p>ustc的镜像：<a href="https://docker.mirrors.ustc.edu.cn" target="_blank" rel="noopener">https://docker.mirrors.ustc.edu.cn</a></p><p>daocloud：<a href="https://www.daocloud.io/mirror#accelerator-doc（注册后使用）" target="_blank" rel="noopener">https://www.daocloud.io/mirror#accelerator-doc（注册后使用）</a></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束 <i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>如果觉得我的文章对您有用,请随意打赏.您的支持将鼓励我继续创作!</div><br><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/img/wechat.jpg" alt="永夜初晗凝碧天 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/img/alipay.jpg" alt="永夜初晗凝碧天 支付宝"><p>支付宝</p></div></div></div></div><div><div class="post-copyright"><li class="post-copyright-title"><strong>本文标题：</strong> Docker教程</li><li class="post-copyright-author"><strong>文章作者：</strong> 永夜初晗凝碧天</li><li class="post-copyright-author"><strong>发布时间：</strong> 2019年07月15日 - 16:07:00</li><li class="post-copyright-author"><strong>更新时间：</strong> 2019年12月31日 - 12:12:25</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="/2019/07/15/Docker教程/" title="Docker教程">https://yongnights.github.io/2019/07/15/Docker教程/</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://yongnights.github.io/2019/07/15/Docker教程/" aria-label="复制成功！"></i></span></li><li class="post-copyright-license"><strong>版权声明： </strong><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</li></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><footer class="post-footer"><div class="post-tags"><a href="/tags/CentOS/" rel="tag"><i class="fa fa-tag"></i> CentOS</a> <a href="/tags/Docker/" rel="tag"><i class="fa fa-tag"></i> Docker</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/07/10/从0玩转jQuery/" rel="next" title="从0玩转jQuery"><i class="fa fa-chevron-left"></i> 从0玩转jQuery</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/07/22/SQLAlchemy知识补充-md/" rel="prev" title="SQLAlchemy知识补充">SQLAlchemy知识补充 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/img/avatar.png" alt="永夜初晗凝碧天"><p class="site-author-name" itemprop="name">永夜初晗凝碧天</p><p class="site-description motion-element" itemprop="description">Linux,Python,MySQL,ELK Stack,K8S,Docker</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">139</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">54</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">59</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="tencent://message/?Menu=yes&uin=1103324414" target="_blank" title="QQ"><i class="fa fa-fw fa-qq"></i>QQ</a> </span><span class="links-of-author-item"><a href="mailto:sandu12345@msn.cn" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1333220817&auto=0&height=66"></iframe><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.cnblogs.com/sanduzxcvbnm/" title="博客园" target="_blank">博客园</a></li><li class="links-of-blogroll-item"><a href="https://www.baidu.com/" title="百度" target="_blank">百度</a></li></ul></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li><a href="/2020/04/26/FastAPI框架入门 基本使用, 模版渲染, form表单数据交互, 上传文件, 静态文件配置/" title="FastAPI框架入门 基本使用, 模版渲染, form表单数据交互, 上传文件, 静态文件配置" target="_blank">FastAPI框架入门 基本使用, 模版渲染, form表单数据交互, 上传文件, 静态文件配置</a></li><li><a href="/2020/04/17/Elasticsearch：使用_update_by_query更新文档/" title="Elasticsearch：使用_update_by_query更新文档" target="_blank">Elasticsearch：使用_update_by_query更新文档</a></li><li><a href="/2020/04/15/Solutions：安全的APM服务器访问/" title="Solutions：安全的APM服务器访问" target="_blank">Solutions：安全的APM服务器访问</a></li><li><a href="/2020/04/15/ELK Stack 日志平台性能优化/" title="ELK Stack 日志平台性能优化" target="_blank">ELK Stack 日志平台性能优化</a></li><li><a href="/2020/04/15/Elasticsearch集群规模和容量规划的底层逻辑/" title="Elasticsearch集群规模和容量规划的底层逻辑" target="_blank">Elasticsearch集群规模和容量规划的底层逻辑</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker简介"><span class="nav-text">Docker简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-介绍"><span class="nav-text">Docker 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-的应用场景"><span class="nav-text">Docker 的应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-的优点"><span class="nav-text">Docker 的优点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-架构"><span class="nav-text">Docker 架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-安装"><span class="nav-text">Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu-Docker-安装"><span class="nav-text">Ubuntu Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前提条件"><span class="nav-text">前提条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用脚本安装-Docker"><span class="nav-text">使用脚本安装 Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#镜像加速"><span class="nav-text">镜像加速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu-16-04-安装-Docker"><span class="nav-text">Ubuntu 16.04 安装 Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu-18-04-安装-Docker-ce"><span class="nav-text">Ubuntu 18.04 安装 Docker-ce</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CentOS-Docker-安装"><span class="nav-text">CentOS Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前提条件-1"><span class="nav-text">前提条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-yum-安装（CentOS-7下）"><span class="nav-text">使用 yum 安装（CentOS 7下）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用脚本安装-Docker-1"><span class="nav-text">使用脚本安装 Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#镜像加速-1"><span class="nav-text">镜像加速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除-Docker-CE"><span class="nav-text">删除 Docker CE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows-Docker-安装"><span class="nav-text">Windows Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#win7、win8-系统"><span class="nav-text">win7、win8 系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Win10-系统"><span class="nav-text">Win10 系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#镜像加速-2"><span class="nav-text">镜像加速</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MacOS-Docker-安装"><span class="nav-text">MacOS Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Homebrew-安装"><span class="nav-text">使用 Homebrew 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手动下载安装"><span class="nav-text">手动下载安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#镜像加速-3"><span class="nav-text">镜像加速</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-使用"><span class="nav-text">Docker 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-Hello-World"><span class="nav-text">Docker Hello World</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#运行交互式的容器"><span class="nav-text">运行交互式的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动容器-后台模式"><span class="nav-text">启动容器 (后台模式)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#停止容器"><span class="nav-text">停止容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-容器使用"><span class="nav-text">Docker 容器使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-客户端"><span class="nav-text">Docker 客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行一个web应用"><span class="nav-text">运行一个web应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看-WEB-应用容器"><span class="nav-text">查看 WEB 应用容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络端口的快捷方式"><span class="nav-text">网络端口的快捷方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看-WEB-应用程序日志"><span class="nav-text">查看 WEB 应用程序日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看WEB应用程序容器的进程"><span class="nav-text">查看WEB应用程序容器的进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查-WEB-应用程序"><span class="nav-text">检查 WEB 应用程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#停止-WEB-应用容器"><span class="nav-text">停止 WEB 应用容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重启WEB应用容器"><span class="nav-text">重启WEB应用容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除WEB应用容器"><span class="nav-text">移除WEB应用容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-镜像使用"><span class="nav-text">Docker 镜像使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#列出镜像列表"><span class="nav-text">列出镜像列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取一个新的镜像"><span class="nav-text">获取一个新的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找镜像"><span class="nav-text">查找镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拖取镜像"><span class="nav-text">拖取镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建镜像"><span class="nav-text">创建镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新镜像"><span class="nav-text">更新镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构建镜像"><span class="nav-text">构建镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置镜像标签"><span class="nav-text">设置镜像标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除镜像"><span class="nav-text">删除镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-容器连接"><span class="nav-text">Docker 容器连接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网络端口映射"><span class="nav-text">网络端口映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker容器连接"><span class="nav-text">Docker容器连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#容器命名"><span class="nav-text">容器命名</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker实例"><span class="nav-text">Docker实例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-Nginx"><span class="nav-text">Docker 安装 Nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-pull-nginx-命令安装"><span class="nav-text">docker pull nginx 命令安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nginx-部署"><span class="nav-text">nginx 部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#部署命令"><span class="nav-text">部署命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#相关命令"><span class="nav-text">相关命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-PHP"><span class="nav-text">Docker 安装 PHP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-PHP-镜像"><span class="nav-text">安装 PHP 镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-php"><span class="nav-text">方法一、docker pull php</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx-PHP-部署"><span class="nav-text">Nginx + PHP 部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#要点总结"><span class="nav-text">要点总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-MySQL"><span class="nav-text">Docker 安装 MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装方法"><span class="nav-text">安装方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-mysql"><span class="nav-text">方法一、docker pull mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二、通过-Dockerfile构建"><span class="nav-text">方法二、通过 Dockerfile构建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用mysql镜像"><span class="nav-text">使用mysql镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#运行容器"><span class="nav-text">运行容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看容器启动情况"><span class="nav-text">查看容器启动情况</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#知识点"><span class="nav-text">知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#最新官方MySQL-5-7-19-的docker镜像在创建时映射的配置文件目录有所不同"><span class="nav-text">最新官方MySQL(5.7.19)的docker镜像在创建时映射的配置文件目录有所不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#docker-安装-mysql-8-版本"><span class="nav-text">docker 安装 mysql 8 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#登录docker里的MySQL镜像和远程登录"><span class="nav-text">登录docker里的MySQL镜像和远程登录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-Tomcat"><span class="nav-text">Docker 安装 Tomcat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤"><span class="nav-text">安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-tomcat"><span class="nav-text">方法一、docker pull tomcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二、通过-Dockerfile-构建"><span class="nav-text">方法二、通过 Dockerfile 构建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用tomcat镜像"><span class="nav-text">使用tomcat镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#运行容器-1"><span class="nav-text">运行容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通过浏览器访问"><span class="nav-text">通过浏览器访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-Python"><span class="nav-text">Docker 安装 Python</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤-1"><span class="nav-text">安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-python-3-5"><span class="nav-text">方法一、docker pull python:3.5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二、通过-Dockerfile-构建-1"><span class="nav-text">方法二、通过 Dockerfile 构建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用python镜像"><span class="nav-text">使用python镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行容器-2"><span class="nav-text">运行容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-Redis"><span class="nav-text">Docker 安装 Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤-2"><span class="nav-text">安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-redis-5-0"><span class="nav-text">方法一、docker pull redis:5.0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二、通过-Dockerfile-构建-2"><span class="nav-text">方法二、通过 Dockerfile 构建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用redis镜像"><span class="nav-text">使用redis镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#运行容器-3"><span class="nav-text">运行容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看容器启动情况-1"><span class="nav-text">查看容器启动情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#连接、查看容器"><span class="nav-text">连接、查看容器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-MongoDB"><span class="nav-text">Docker 安装 MongoDB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤-3"><span class="nav-text">安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-mongo"><span class="nav-text">方法一、docker pull mongo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二、通过-Dockerfile-构建-3"><span class="nav-text">方法二、通过 Dockerfile 构建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用mongo镜像"><span class="nav-text">使用mongo镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#运行容器-4"><span class="nav-text">运行容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看容器启动情况-2"><span class="nav-text">查看容器启动情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-mongo-express-管理mongodb"><span class="nav-text">使用 mongo-express 管理mongodb</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-mongoclient-管理-mongodb"><span class="nav-text">使用 mongoclient 管理 mongodb</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-安装-Apache"><span class="nav-text">Docker 安装 Apache</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤-4"><span class="nav-text">安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一、docker-pull-httpd"><span class="nav-text">方法一、docker pull httpd</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二、通过-Dockerfile构建-1"><span class="nav-text">方法二、通过 Dockerfile构建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用apache镜像"><span class="nav-text">使用apache镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#运行容器-5"><span class="nav-text">运行容器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MacOS系统配置Nginx-php-mysql的docker使用环境"><span class="nav-text">MacOS系统配置Nginx+php+mysql的docker使用环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-命令大全"><span class="nav-text">Docker 命令大全</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#容器生命周期管理"><span class="nav-text">容器生命周期管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#run"><span class="nav-text">run</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#start-stop-restart"><span class="nav-text">start/stop/restart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kill"><span class="nav-text">kill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rm"><span class="nav-text">rm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pause-unpause"><span class="nav-text">pause/unpause</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#create"><span class="nav-text">create</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exec"><span class="nav-text">exec</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器操作"><span class="nav-text">容器操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ps"><span class="nav-text">ps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inspect"><span class="nav-text">inspect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#top"><span class="nav-text">top</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#attach"><span class="nav-text">attach</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#events"><span class="nav-text">events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logs"><span class="nav-text">logs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wait"><span class="nav-text">wait</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#export"><span class="nav-text">export</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#port"><span class="nav-text">port</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器rootfs命令"><span class="nav-text">容器rootfs命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#commit"><span class="nav-text">commit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cp"><span class="nav-text">cp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#diff"><span class="nav-text">diff</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#镜像仓库"><span class="nav-text">镜像仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#login"><span class="nav-text">login</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pull"><span class="nav-text">pull</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#push"><span class="nav-text">push</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#search"><span class="nav-text">search</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本地镜像管理"><span class="nav-text">本地镜像管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#images"><span class="nav-text">images</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rmi"><span class="nav-text">rmi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tag"><span class="nav-text">tag</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#build"><span class="nav-text">build</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#history"><span class="nav-text">history</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#save"><span class="nav-text">save</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#load"><span class="nav-text">load</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#import"><span class="nav-text">import</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#info-version"><span class="nav-text">info|version</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#info"><span class="nav-text">info</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#version"><span class="nav-text">version</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-资源汇总"><span class="nav-text">Docker 资源汇总</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker官方英文资源"><span class="nav-text">Docker官方英文资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker中文资源"><span class="nav-text">Docker中文资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-国内镜像"><span class="nav-text">Docker 国内镜像</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-star"></i> </span><span class="author" itemprop="copyrightHolder">永夜初晗凝碧天</span><br></div><div><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">博客全站字数统计 </span><span title="博客全站字数统计">: 409.8k 字</span> <span class="post-meta-divider">||</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("03/01/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="博客已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分钟 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></div><div class="busuanzi-count"><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i> 本文总阅读量<span id="busuanzi_value_page_pv"></span>次 </span><span class="post-meta-divider">||</span> <span id="busuanzi_container_site_uv"><i class="fa fa-user"></i> 本站访客数<span id="busuanzi_value_site_uv"></span>人次 </span><span class="post-meta-divider">||</span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> 本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></div><div id="nowDate"><script type="text/javascript">window.onload=function(){function e(){var e=new Date,r=e.getFullYear(),u=e.getMonth()+1,a=e.getDate(),g=e.getDay(),i=e.getHours(),c=e.getMinutes(),d=e.getSeconds(),l="当前时间是："+r+"年"+u+"月"+a+"日 "+t(g)+" "+n(i)+":"+n(c)+":"+n(d);o.innerHTML=l}function t(e){return 0==e?"星期日":1==e?"星期一":2==e?"星期二":3==e?"星期三":4==e?"星期四":5==e?"星期五":"星期六"}function n(e){return e<10?"0"+e:e}var o=document.getElementById("nowDate");e(),setInterval(e,1e3)}</script></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/javascript" src="/js/src/love.js"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by neat -->