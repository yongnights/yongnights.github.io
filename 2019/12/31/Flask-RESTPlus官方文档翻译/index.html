<!-- build time:Wed Apr 15 2020 15:39:27 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Python,Flask,Flask-RESTPlus,"><link rel="alternate" href="/atom.xml" title="个人博客" type="application/atom+xml"><meta name="description" content="欢迎文档Flask-RESTPlus 是对 Flask 的扩展，它增加了对快速开发 REST API 的支持。Flask-RESTPlus 鼓励以最小的设置来实现功能的开发。如果你熟悉 Flask，那么会很容易就能上手 Flask-RESTPlus。Flask-RESTPlus 中提供了大量的装饰器和工具来描述你的 API，并以文档化的形式将这些接口展现出来(通过Swagger来实现)。1. 版本"><meta name="keywords" content="Python,Flask,Flask-RESTPlus"><meta property="og:type" content="article"><meta property="og:title" content="Flask-RESTPlus官方文档翻译"><meta property="og:url" content="https://yongnights.github.io/2019/12/31/Flask-RESTPlus官方文档翻译/index.html"><meta property="og:site_name" content="个人博客"><meta property="og:description" content="欢迎文档Flask-RESTPlus 是对 Flask 的扩展，它增加了对快速开发 REST API 的支持。Flask-RESTPlus 鼓励以最小的设置来实现功能的开发。如果你熟悉 Flask，那么会很容易就能上手 Flask-RESTPlus。Flask-RESTPlus 中提供了大量的装饰器和工具来描述你的 API，并以文档化的形式将这些接口展现出来(通过Swagger来实现)。1. 版本"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-12-31T04:00:48.251Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Flask-RESTPlus官方文档翻译"><meta name="twitter:description" content="欢迎文档Flask-RESTPlus 是对 Flask 的扩展，它增加了对快速开发 REST API 的支持。Flask-RESTPlus 鼓励以最小的设置来实现功能的开发。如果你熟悉 Flask，那么会很容易就能上手 Flask-RESTPlus。Flask-RESTPlus 中提供了大量的装饰器和工具来描述你的 API，并以文档化的形式将这些接口展现出来(通过Swagger来实现)。1. 版本"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://yongnights.github.io/2019/12/31/Flask-RESTPlus官方文档翻译/"><title>Flask-RESTPlus官方文档翻译 | 个人博客</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://your-url" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">个人博客</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">记录工作中的点点滴滴</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://yongnights.github.io/2019/12/31/Flask-RESTPlus官方文档翻译/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="永夜初晗凝碧天"><meta itemprop="description" content><meta itemprop="image" content="/img/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="个人博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Flask-RESTPlus官方文档翻译</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-31T12:00:48+08:00">2019-12-31 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2019-12-31T12:00:48+08:00">2019-12-31 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i>本文总阅读量 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次</span><div class="post-wordcount"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">10.3k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">49 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p>欢迎文档<br>Flask-RESTPlus 是对 Flask 的扩展，它增加了对快速开发 REST API 的支持。Flask-RESTPlus 鼓励以最小的设置来实现功能的开发。如果你熟悉 Flask，那么会很容易就能上手 Flask-RESTPlus。Flask-RESTPlus 中提供了大量的装饰器和工具来描述你的 API，并以文档化的形式将这些接口展现出来(通过Swagger来实现)。</p><h1 id="1-版本兼容性"><a href="#1-版本兼容性" class="headerlink" title="1. 版本兼容性"></a>1. 版本兼容性</h1><p>支持 2.7+以上版本的python</p><h1 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h1><a id="more"></a><h2 id="1-使用pip方式进行安装"><a href="#1-使用pip方式进行安装" class="headerlink" title="1. 使用pip方式进行安装"></a>1. 使用pip方式进行安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install flask-restplus</span><br></pre></td></tr></table></figure><h2 id="2-使用easy-install方式进行安装"><a href="#2-使用easy-install方式进行安装" class="headerlink" title="2. 使用easy_install方式进行安装"></a>2. 使用easy_install方式进行安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ easy_install flask-restplus</span><br></pre></td></tr></table></figure><h1 id="3-教程文档"><a href="#3-教程文档" class="headerlink" title="3. 教程文档"></a>3. 教程文档</h1><h2 id="3-1-安装"><a href="#3-1-安装" class="headerlink" title="3.1 安装"></a>3.1 安装</h2><p>使用pip方式进行安装<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-restplus</span><br></pre></td></tr></table></figure><p></p><p>开发版本可以通过GitHub的方式进行下载安装<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/noirbizarre/flask-restplus.git</span><br><span class="line"><span class="built_in">cd</span> flask-restplus</span><br><span class="line">pip install -e .[dev,<span class="built_in">test</span>]</span><br></pre></td></tr></table></figure><p></p><p>Flask-RESTPlus支持Python版本是2.7，3.3，3.4，3.5.同样也支持 PyPy and PyPy3.</p><h2 id="3-2-快速开始"><a href="#3-2-快速开始" class="headerlink" title="3.2 快速开始"></a>3.2 快速开始</h2><p>前提条件:了解Flask，已经安装好Flask和Flask-RESTPlus。</p><h3 id="3-2-1-初始化"><a href="#3-2-1-初始化" class="headerlink" title="3.2.1 初始化"></a>3.2.1 初始化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br></pre></td></tr></table></figure><p>或者使用工厂模式进行初始化：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api</span><br><span class="line"></span><br><span class="line">api = Api()</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api.init_app(app)</span><br></pre></td></tr></table></figure><p></p><h3 id="3-2-2-最简单的API"><a href="#3-2-2-最简单的API" class="headerlink" title="3.2.2 最简单的API"></a>3.2.2 最简单的API</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> &#123;<span class="string">'hello'</span>: <span class="string">'world'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>保存该文件为api.py.使用python解释器运行该文件，并且开启debug模式方便调试。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python api.py</span><br><span class="line">* Running on http://127.0.0.1:5000/</span><br><span class="line">* Restarting with reloader</span><br></pre></td></tr></table></figure><p></p><table><tr><td bgcolor="red">警告:不要在生产环境开启debug模式</td></tr></table><p>使用curl命令访问该接口:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:5000/hello</span><br><span class="line">&#123;<span class="string">"hello"</span>: <span class="string">"world"</span>&#125;</span><br></pre></td></tr></table></figure><p></p><p>或者使用浏览器,输入地址:<a href="http://127.0.0.1:5000/hello" target="_blank" rel="noopener">http://127.0.0.1:5000/hello</a>进行访问</p><h3 id="3-2-3-资源路由"><a href="#3-2-3-资源路由" class="headerlink" title="3.2.3 资源路由"></a>3.2.3 资源路由</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">todos = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/&lt;string:todo_id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoSimple</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, todo_id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;todo_id: todos[todo_id]&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, todo_id)</span>:</span></span><br><span class="line">        todos[todo_id] = request.form[<span class="string">'data'</span>]</span><br><span class="line">        <span class="keyword">return</span> &#123;todo_id: todos[todo_id]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>使用curl命令访问:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:5000/todo1 -d <span class="string">"data=Remember the milk"</span> -X PUT</span><br><span class="line">&#123;<span class="string">"todo1"</span>: <span class="string">"Remember the milk"</span>&#125;</span><br><span class="line">$ curl http://localhost:5000/todo1</span><br><span class="line">&#123;<span class="string">"todo1"</span>: <span class="string">"Remember the milk"</span>&#125;</span><br><span class="line">$ curl http://localhost:5000/todo2 -d <span class="string">"data=Change my brakepads"</span> -X PUT</span><br><span class="line">&#123;<span class="string">"todo2"</span>: <span class="string">"Change my brakepads"</span>&#125;</span><br><span class="line">$ curl http://localhost:5000/todo2</span><br><span class="line">&#123;<span class="string">"todo2"</span>: <span class="string">"Change my brakepads"</span>&#125;</span><br></pre></td></tr></table></figure><p></p><p>或者使用python的Requests模块进行访问<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from requests import put, get</span><br><span class="line">&gt;&gt;&gt; put(<span class="string">'http://localhost:5000/todo1'</span>, data=&#123;<span class="string">'data'</span>: <span class="string">'Remember the milk'</span>&#125;).json()</span><br><span class="line">&#123;u<span class="string">'todo1'</span>: u<span class="string">'Remember the milk'</span>&#125;</span><br><span class="line">&gt;&gt;&gt; get(<span class="string">'http://localhost:5000/todo1'</span>).json()</span><br><span class="line">&#123;u<span class="string">'todo1'</span>: u<span class="string">'Remember the milk'</span>&#125;</span><br><span class="line">&gt;&gt;&gt; put(<span class="string">'http://localhost:5000/todo2'</span>, data=&#123;<span class="string">'data'</span>: <span class="string">'Change my brakepads'</span>&#125;).json()</span><br><span class="line">&#123;u<span class="string">'todo2'</span>: u<span class="string">'Change my brakepads'</span>&#125;</span><br><span class="line">&gt;&gt;&gt; get(<span class="string">'http://localhost:5000/todo2'</span>).json()</span><br><span class="line">&#123;u<span class="string">'todo2'</span>: u<span class="string">'Change my brakepads'</span>&#125;</span><br></pre></td></tr></table></figure><p></p><p>Flask-RESTPlus返回任何可迭代的类型，它会将该返回值转换成响应对象（response），包括<br>原始的 Flask 响应对象。Flask-RESTPlus 还提供了设置响应码和响应头的功能.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo1</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># Default to 200 OK</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">'task'</span>: <span class="string">'Hello world'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo2</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># Set the response code to 201</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">'task'</span>: <span class="string">'Hello world'</span>&#125;, <span class="number">201</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo3</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># Set the response code to 201 and return custom headers</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">'task'</span>: <span class="string">'Hello world'</span>&#125;, <span class="number">201</span>, &#123;<span class="string">'Etag'</span>: <span class="string">'some-opaque-string'</span>&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="3-2-4-端点"><a href="#3-2-4-端点" class="headerlink" title="3.2.4 端点"></a>3.2.4 端点</h3><p>可以向 Api 对象的add_resource()方法或 route()装饰器中传入多个 URL，这样每个 URL 都将会路由到该资源上：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">api.add_resource(HelloWorld, <span class="string">'/hello'</span>, <span class="string">'/world'</span>) <span class="comment"># HelloWorld为下方的class类名</span></span><br><span class="line"><span class="comment"># 或者下面装饰器方式，二者等价</span></span><br><span class="line"><span class="meta">@api.route('/hello', '/world')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>也可以将 URL 中的部分内容设置成变量，以此来匹配资源方法<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">api.add_resource(HelloWorld, <span class="string">'/todo/&lt;int:todo_id&gt;'</span>, endpoint=<span class="string">'todo_ep'</span>)</span><br><span class="line"><span class="comment"># 或者下面装饰器方式，二者等价</span></span><br><span class="line"><span class="meta">@api.route('/todo/&lt;int:todo_id&gt;', endpoint='todo_ep')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>注意:如果一个请求（request）与应用的任何端点都不匹配，那么 Flask-RESTPlus 将会返回一个 404 错误信息，并给出其他与所请求端点最匹配的建议信息。不过，我们可以通过在程序配置中设置 ERROR_404_HELP 为 False 来关闭该功能。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">'ERROR_404_HELP'</span>] = <span class="literal">False</span></span><br></pre></td></tr></table></figure><p></p><h3 id="3-2-5-参数解析"><a href="#3-2-5-参数解析" class="headerlink" title="3.2.5 参数解析"></a>3.2.5 参数解析</h3><p>Flask-RESTPlus 内置支持对请求数据的验证，这一功能是通过使用一个类似于 argparse 的库来实现的<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> reqparse</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser()</span><br><span class="line">parser.add_argument(<span class="string">'rate'</span>, type=int, help=<span class="string">'Rate to charge for this resource'</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args() <span class="comment"># 放到需要验证用户提交的数据的函数方法中</span></span><br></pre></td></tr></table></figure><p></p><p>注意：parse_args()返回的是一个 Python 字典，而不是自定义数据结构。</p><p>使用 RequestParser 类还能获取完整的错误信息。如果一个参数未验证通过，Flask-RESTPlus 将响应一个 400 错误请求，以及一个高亮错误信息的响应。示例程序如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, Resource, reqparse, fields</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># app.config['ERROR_404_HELP'] = False</span></span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser()</span><br><span class="line">parser.add_argument(<span class="string">'rate'</span>, type=int, required=<span class="literal">True</span>,help=<span class="string">'Rate to charge for this resource'</span>)</span><br><span class="line"><span class="comment"># parser.add_argument('data', required=True,help='data to charge for this resource')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">todos = &#123;</span><br><span class="line">    <span class="string">'1'</span>:<span class="string">'eat'</span>,</span><br><span class="line">    <span class="string">'2'</span>:<span class="string">'sleep'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/&lt;string:todo_id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoSimple</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, todo_id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;todo_id: todos[todo_id]&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, todo_id)</span>:</span></span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        <span class="comment"># print(args)</span></span><br><span class="line">        todos[todo_id] = request.form[<span class="string">'data'</span>]</span><br><span class="line">        <span class="keyword">return</span> &#123;todo_id: todos[todo_id]&#125;</span><br><span class="line">        <span class="comment"># return args</span></span><br></pre></td></tr></table></figure><p></p><p>其中，parser.add_argument(‘rate’, type=int,required=True,help=’Rate to charge for this resource’)表示，参数名为 rate，数据类型为 int，请求时必须发送此参数，如果验证不通过时将会返回 help 指定的信息。<br>运行程序并使用 curl 进行访问，几种情况的验证结果如下：<br> 提供 rate 值，但不是 int 型（验证不通过）<br> 提供 rate 值，且是 int 型（验证通过）<br> 不提供 rate 值（验证不通过）</p><p>注:使用curl访问的时候,除了需要传递data参数值外,还需要传递rate参数值才行.当然data参数值也可以进行验证.</p><p>参数 strict=True 的含义:若传递了未定义的参数则报错.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args = parser.parse_args(strict=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><h3 id="3-2-6-数据格式化"><a href="#3-2-6-数据格式化" class="headerlink" title="3.2.6 数据格式化"></a>3.2.6 数据格式化</h3><p>默认情况下，在返回的可迭代对象中的所有字段都会原样返回,但是当涉及到对象时将会变得非常棘<br>手.Flask-RESTPlus 提供了 fields 模块和marshal_with()装饰器来解决返回的是对象的问题.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> fields, Api, Resource</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化返回的是对象的值.也就是说返回的是对象中的如下格式化的值</span></span><br><span class="line">model = api.model(<span class="string">'Model'</span>, &#123; </span><br><span class="line">    <span class="string">'task'</span>: fields.String,</span><br><span class="line">    <span class="string">'uri'</span>: fields.Url(<span class="string">'todo_ep'</span>,absolute=<span class="literal">True</span>) <span class="comment"># absolute表示返回绝对路径</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoDao</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, todo_id, task)</span>:</span></span><br><span class="line">        self.todo_id = todo_id</span><br><span class="line">        self.task = task</span><br><span class="line"></span><br><span class="line">        <span class="comment"># This field will not be sent in the response</span></span><br><span class="line">        self.status = <span class="string">'active'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/todo',endpoint='todo_ep') # 不指定端点默认是视图函数名</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(model) # 返回对象格式化引用的装饰器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> TodoDao(todo_id=<span class="string">'my_todo'</span>, task=<span class="string">'Remember the milk'</span>) <span class="comment"># 返回的是一个对象</span></span><br></pre></td></tr></table></figure><p></p><p>此功能的作用如下:若返回的是一个对象,可以通话该装饰器,格式化该对象要返回的数据,数据表查询比较常用</p><p>顺序保留<br>默认情况下，字段顺序并未得到保留，因为它会损耗性能。不过，如果你确实需要保留字段顺序，那么可以向类或函数传入一个 ordered=True 的参数项，以此强制进行顺序保留：<br> Api 全局保留：api = Api(ordered = True)<br> Namespace 全局保留：ns = Namespace(ordered=True)<br> marshal()局部保留：return marshal(data, fields, ordered=True)</p><p>marshal()局部保留的例子如下:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> fields, Api, Resource</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化返回的是对象的值.也就是说返回的是对象中的如下格式化的值</span></span><br><span class="line">model = api.model(<span class="string">'Model'</span>, &#123; </span><br><span class="line">    <span class="string">'task'</span>: fields.String,</span><br><span class="line">    <span class="string">'uri'</span>: fields.Url(<span class="string">'todo_ep'</span>,absolute=<span class="literal">True</span>) <span class="comment"># absolute表示返回绝对路径</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoDao</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, todo_id, task)</span>:</span></span><br><span class="line">        self.todo_id = todo_id</span><br><span class="line">        self.task = task</span><br><span class="line"></span><br><span class="line">        <span class="comment"># This field will not be sent in the response</span></span><br><span class="line">        self.status = <span class="string">'active'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/todo',endpoint='todo_ep') # 不指定端点默认是视图函数名</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(model) # 返回对象格式化引用的装饰器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># return TodoDao(todo_id='my_todo', task='Remember the milk') # 返回的是一个对象</span></span><br><span class="line">        <span class="keyword">return</span> api.marshal(TodoDao(todo_id=<span class="string">'my_todo'</span>, task=<span class="string">'Remember the milk'</span>), model, ordered=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><h3 id="3-2-7-完整例子"><a href="#3-2-7-完整例子" class="headerlink" title="3.2.7 完整例子"></a>3.2.7 完整例子</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, Resource, fields</span><br><span class="line"><span class="keyword">from</span> werkzeug.contrib.fixers <span class="keyword">import</span> ProxyFix</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.wsgi_app = ProxyFix(app.wsgi_app)</span><br><span class="line">api = Api(app, version=<span class="string">'1.0'</span>, title=<span class="string">'TodoMVC API'</span>,</span><br><span class="line">          description=<span class="string">'A simple TodoMVC API'</span>,</span><br><span class="line">          )</span><br><span class="line"></span><br><span class="line">ns = api.namespace(<span class="string">'todos'</span>, description=<span class="string">'TODO operations'</span>)</span><br><span class="line"></span><br><span class="line">todo = api.model(<span class="string">'Todo'</span>, &#123;</span><br><span class="line">    <span class="string">'id'</span>: fields.Integer(readOnly=<span class="literal">True</span>, description=<span class="string">'The task unique identifier'</span>),</span><br><span class="line">    <span class="string">'task'</span>: fields.String(required=<span class="literal">True</span>, description=<span class="string">'The task details'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoDAO</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.counter = <span class="number">0</span></span><br><span class="line">        self.todos = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> todo <span class="keyword">in</span> self.todos:</span><br><span class="line">            <span class="keyword">if</span> todo[<span class="string">'id'</span>] == id:</span><br><span class="line">                <span class="keyword">return</span> todo</span><br><span class="line">        api.abort(<span class="number">404</span>, <span class="string">"Todo &#123;&#125; doesn't exist"</span>.format(id))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        todo = data</span><br><span class="line">        todo[<span class="string">'id'</span>] = self.counter = self.counter + <span class="number">1</span></span><br><span class="line">        self.todos.append(todo)</span><br><span class="line">        <span class="keyword">return</span> todo</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, id, data)</span>:</span></span><br><span class="line">        todo = self.get(id)</span><br><span class="line">        todo.update(data)</span><br><span class="line">        <span class="keyword">return</span> todo</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        todo = self.get(id)</span><br><span class="line">        self.todos.remove(todo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DAO = TodoDAO()</span><br><span class="line">DAO.create(&#123;<span class="string">'task'</span>: <span class="string">'Build an API'</span>&#125;)</span><br><span class="line">DAO.create(&#123;<span class="string">'task'</span>: <span class="string">'?????'</span>&#125;)</span><br><span class="line">DAO.create(&#123;<span class="string">'task'</span>: <span class="string">'profit!'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ns.route('/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="string">'''Shows a list of all todos, and lets you POST to add new tasks'''</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @ns.doc('list_todos')</span></span><br><span class="line"><span class="meta">    @ns.marshal_list_with(todo)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''List all tasks'''</span></span><br><span class="line">        <span class="keyword">return</span> DAO.todos</span><br><span class="line"></span><br><span class="line"><span class="meta">    @ns.doc('create_todo')</span></span><br><span class="line"><span class="meta">    @ns.expect(todo)</span></span><br><span class="line"><span class="meta">    @ns.marshal_with(todo, code=201)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''Create a new task'''</span></span><br><span class="line">        <span class="keyword">return</span> DAO.create(api.payload), <span class="number">201</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ns.route('/&lt;int:id&gt;')</span></span><br><span class="line"><span class="meta">@ns.response(404, 'Todo not found')</span></span><br><span class="line"><span class="meta">@ns.param('id', 'The task identifier')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="string">'''Show a single todo item and lets you delete them'''</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @ns.doc('get_todo')</span></span><br><span class="line"><span class="meta">    @ns.marshal_with(todo)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="string">'''Fetch a given resource'''</span></span><br><span class="line">        <span class="keyword">return</span> DAO.get(id)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @ns.doc('delete_todo')</span></span><br><span class="line"><span class="meta">    @ns.response(204, 'Todo deleted')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="string">'''Delete a task given its identifier'''</span></span><br><span class="line">        DAO.delete(id)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>, <span class="number">204</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @ns.expect(todo)</span></span><br><span class="line"><span class="meta">    @ns.marshal_with(todo)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="string">'''Update a task given its identifier'''</span></span><br><span class="line">        <span class="keyword">return</span> DAO.update(id, api.payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(port=<span class="number">8000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h1 id="4-响应编组"><a href="#4-响应编组" class="headerlink" title="4.响应编组"></a>4.响应编组</h1><h2 id="4-1-基本使用"><a href="#4-1-基本使用" class="headerlink" title="4.1 基本使用"></a>4.1 基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, fields</span><br><span class="line"></span><br><span class="line">model = api.model(<span class="string">'Model'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'address'</span>: fields.String,</span><br><span class="line">    <span class="string">'date_updated'</span>: fields.DateTime(dt_format=<span class="string">'rfc822'</span>), <span class="comment"># 对返回响应的数据做进一步的处理</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/todo')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(model, envelope='resource') # envelope的作用是做返回值字典的键</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> db_get_todo()  <span class="comment"># Some function that queries the db</span></span><br></pre></td></tr></table></figure><p>下方结果对上述代码稍作修改,主要是为了体现@api.marshal_with(model, envelope=’resource’)中envelope的作用<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;curl http://127.0.0.1:5000/todo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"resource"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"sandu"</span>,</span><br><span class="line">        <span class="string">"priority"</span>: <span class="string">"Normal"</span>,</span><br><span class="line">        <span class="string">"status"</span>: <span class="string">"Read"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>注:@api.marshal_with()装饰器的作用等价于如下:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">returtn api.marshal(被装饰对象,model,envelope=<span class="string">'resource'</span>),<span class="number">200</span></span><br></pre></td></tr></table></figure><p></p><h2 id="4-2-重命名属性"><a href="#4-2-重命名属性" class="headerlink" title="4.2 重命名属性"></a>4.2 重命名属性</h2><p>该功能主要作用是同一个变量,在代码内部使用一个同一个变量名,提供给用户时显示的是另一个变量名<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="string">'private_name'</span>),</span><br><span class="line">    <span class="string">'address'</span>: fields.String,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>完整示例如下:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, Resource, reqparse, fields</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># app.config['ERROR_404_HELP'] = False</span></span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoDao</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, private_name, address,flags)</span>:</span></span><br><span class="line">        self.private_name = private_name</span><br><span class="line">        self.address = address</span><br><span class="line">        self.flags = flags</span><br><span class="line"></span><br><span class="line">        <span class="comment"># This field will not be sent in the response</span></span><br><span class="line">        self.priority = <span class="literal">None</span></span><br><span class="line">        self.status = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrgentItem</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Urgent"</span> <span class="keyword">if</span> value == <span class="number">1</span> <span class="keyword">else</span> <span class="string">"Normal"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnreadItem</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Unread"</span> <span class="keyword">if</span> value ==<span class="number">2</span> <span class="keyword">else</span> <span class="string">"Read"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="string">'private_name'</span>),</span><br><span class="line">    <span class="string">'priority'</span>: UrgentItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'status'</span>: UnreadItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'age'</span>:fields.Integer(default=<span class="number">20</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/todo')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="comment"># @api.marshal_with(model, envelope='resource')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> api.marshal(TodoDao(private_name=<span class="string">'sandu'</span>, address=<span class="string">'beijing'</span>,flags=<span class="number">1</span>), model,                       envelope=<span class="string">'resource'</span>)  <span class="comment"># Some function that queries the db</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><p>注意看上述代码的示例:代码中使用的变量名是private_name,返回给用户的结果中显示的变量名是name,具体如下:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/todo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"resource"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"sandu"</span>,</span><br><span class="line">        <span class="string">"priority"</span>: <span class="string">"Urgent"</span>,</span><br><span class="line">        <span class="string">"status"</span>: <span class="string">"Read"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>也可以指定为 lambda 表达式或者其他可调用的语句<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="keyword">lambda</span> x: x._private_name),</span><br><span class="line">    <span class="string">'address'</span>: fields.String,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>还可以利用 attribute 来访问嵌套的属性<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="string">'people_list.0.person_dictionary.name'</span>),</span><br><span class="line">    <span class="string">'address'</span>: fields.String,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="4-3-默认值"><a href="#4-3-默认值" class="headerlink" title="4.3 默认值"></a>4.3 默认值</h2><p>为对象中不存在但是返回值存在的指定默认值,重命名例子中的age就是,如下所示:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="string">'private_name'</span>),</span><br><span class="line">    <span class="string">'priority'</span>: UrgentItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'status'</span>: UnreadItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'age'</span>:fields.Integer(default=<span class="number">20</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="4-4-自定义字段及多值情况"><a href="#4-4-自定义字段及多值情况" class="headerlink" title="4.4 自定义字段及多值情况"></a>4.4 自定义字段及多值情况</h2><p>该功能通俗点来说是根据值得不同返回对应的不同的结果<br>如上述的部分代码:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrgentItem</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Urgent"</span> <span class="keyword">if</span> value == <span class="number">1</span> <span class="keyword">else</span> <span class="string">"Normal"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnreadItem</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Unread"</span> <span class="keyword">if</span> value ==<span class="number">2</span> <span class="keyword">else</span> <span class="string">"Read"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="string">'private_name'</span>),</span><br><span class="line">    <span class="string">'priority'</span>: UrgentItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'status'</span>: UnreadItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'age'</span>:fields.Integer(default=<span class="number">20</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/todo')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="comment"># @api.marshal_with(model, envelope='resource')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> api.marshal(TodoDao(private_name=<span class="string">'sandu'</span>, address=<span class="string">'beijing'</span>,flags=<span class="number">1</span>), model,</span><br><span class="line">                           envelope=<span class="string">'resource'</span>)  <span class="comment"># Some function that queries the db</span></span><br></pre></td></tr></table></figure><p></p><p>当返回的TodoDao对象中,flags的值不同,返回的参数priority和status值也会根据上述两个class的返回结果而不同.<br>当flags=1时,返回的结果是:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/todo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"resource"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"sandu"</span>,</span><br><span class="line">        <span class="string">"priority"</span>: <span class="string">"Urgent"</span>,</span><br><span class="line">        <span class="string">"status"</span>: <span class="string">"Read"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>当flags=2时,返回的结果是:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/todo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"resource"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"sandu"</span>,</span><br><span class="line">        <span class="string">"priority"</span>: <span class="string">"Normal"</span>,</span><br><span class="line">        <span class="string">"status"</span>: <span class="string">"Unread"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="4-5-URL和其他字段"><a href="#4-5-URL和其他字段" class="headerlink" title="4.5 URL和其他字段"></a>4.5 URL和其他字段</h2><p>该返回对象值增加额外的字段<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomNumber</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">output</span><span class="params">(self,key,obj,ordered=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> random.random()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String(attribute=<span class="string">'private_name'</span>),</span><br><span class="line">    <span class="string">'priority'</span>: UrgentItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'status'</span>: UnreadItem(attribute=<span class="string">'flags'</span>),</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer(default=<span class="number">20</span>),</span><br><span class="line">    <span class="string">'random'</span>: RandomNumber(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><blockquote><p>注意:以上代码经过修改,跟官网文档不一样,主要是output()中多了一个ordered=None,不然不加这个会报错:TypeError: output() got an unexpected keyword argument ‘ordered’<br>可以把def output(self,key,obj,ordered=None)看成是一个固定写法,只修改其返回值即可.</p></blockquote><p>返回结果是:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;curl http://127.0.0.1:5000/todo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"resource"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"sandu"</span>,</span><br><span class="line">        <span class="string">"priority"</span>: <span class="string">"Normal"</span>,</span><br><span class="line">        <span class="string">"status"</span>: <span class="string">"Unread"</span>,</span><br><span class="line">        <span class="string">"age"</span>: 20,</span><br><span class="line">        <span class="string">"random"</span>: 0.12434240543068387</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>默认情况下，fields.Url 返回的是一个相对于根路径的相对 URI,不过也可以返回绝对路径,以及地址的schema(协议)等.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model = &#123;</span><br><span class="line">    <span class="string">'uri'</span>: fields.Url(<span class="string">'todo_resource'</span>, absolute=<span class="literal">True</span>)</span><br><span class="line">    <span class="string">'https_uri'</span>: fields.Url(<span class="string">'todo_resource'</span>, absolute=<span class="literal">True</span>, scheme=<span class="string">'https'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="4-6-复杂结构"><a href="#4-6-复杂结构" class="headerlink" title="4.6 复杂结构"></a>4.6 复杂结构</h2><p>提供一个扁平的结构，而 marshal()则会按照定义的规则将其转换成一个嵌套结构<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from flask_restplus import fields, marshal</span><br><span class="line">&gt;&gt;&gt; import json</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; resource_fields = &#123;<span class="string">'name'</span>: fields.String&#125;</span><br><span class="line">&gt;&gt;&gt; resource_fields[<span class="string">'address'</span>] = &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; resource_fields[<span class="string">'address'</span>][<span class="string">'line 1'</span>] = fields.String(attribute=<span class="string">'addr1'</span>)</span><br><span class="line">&gt;&gt;&gt; resource_fields[<span class="string">'address'</span>][<span class="string">'line 2'</span>] = fields.String(attribute=<span class="string">'addr2'</span>)</span><br><span class="line">&gt;&gt;&gt; resource_fields[<span class="string">'address'</span>][<span class="string">'city'</span>] = fields.String</span><br><span class="line">&gt;&gt;&gt; resource_fields[<span class="string">'address'</span>][<span class="string">'state'</span>] = fields.String</span><br><span class="line">&gt;&gt;&gt; resource_fields[<span class="string">'address'</span>][<span class="string">'zip'</span>] = fields.String</span><br><span class="line">&gt;&gt;&gt; data = &#123;<span class="string">'name'</span>: <span class="string">'bob'</span>, <span class="string">'addr1'</span>: <span class="string">'123 fake street'</span>, <span class="string">'addr2'</span>: <span class="string">''</span>, <span class="string">'city'</span>: <span class="string">'New York'</span>, <span class="string">'state'</span>: <span class="string">'NY'</span>, <span class="string">'zip'</span>: <span class="string">'10468'</span>&#125;</span><br><span class="line">&gt;&gt;&gt; json.dumps(marshal(data, resource_fields))</span><br><span class="line"><span class="string">'&#123;"name": "bob", "address": &#123;"line 1": "123 fake street", "line 2": "", "state": "NY", "zip": "10468", "city": "New York"&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p></p><p>注意：上述示例中的 address 字段其实并不存在于数据对象中，但是任何子字段都能够直接从对象中访问该属性，就像它们并不是嵌套关系一样。</p><h2 id="4-7-列表字段"><a href="#4-7-列表字段" class="headerlink" title="4.7 列表字段"></a>4.7 列表字段</h2><p>将字段解组成列表<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> fields, marshal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resource_fields = &#123;<span class="string">'name'</span>: fields.String, <span class="string">'first_names'</span>: fields.List(fields.String)&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'name'</span>: <span class="string">'Bougnazal'</span>, <span class="string">'first_names'</span> : [<span class="string">'Emile'</span>, <span class="string">'Raoul'</span>]&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(marshal(data, resource_fields))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;"first_names": ["Emile", "Raoul"], "name": "Bougnazal"&#125;'</span></span><br></pre></td></tr></table></figure><p></p><h2 id="4-8-嵌套字段"><a href="#4-8-嵌套字段" class="headerlink" title="4.8 嵌套字段"></a>4.8 嵌套字段</h2><p>使用 Nested 来将嵌套的数据结构解组，并对其进行适当的渲染<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> fields, marshal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address_fields = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address_fields[<span class="string">'line 1'</span>] = fields.String(attribute=<span class="string">'addr1'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address_fields[<span class="string">'line 2'</span>] = fields.String(attribute=<span class="string">'addr2'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address_fields[<span class="string">'city'</span>] = fields.String(attribute=<span class="string">'city'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address_fields[<span class="string">'state'</span>] = fields.String(attribute=<span class="string">'state'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address_fields[<span class="string">'zip'</span>] = fields.String(attribute=<span class="string">'zip'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resource_fields = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resource_fields[<span class="string">'name'</span>] = fields.String</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resource_fields[<span class="string">'billing_address'</span>] = fields.Nested(address_fields)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resource_fields[<span class="string">'shipping_address'</span>] = fields.Nested(address_fields)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address1 = &#123;<span class="string">'addr1'</span>: <span class="string">'123 fake street'</span>, <span class="string">'city'</span>: <span class="string">'New York'</span>, <span class="string">'state'</span>: <span class="string">'NY'</span>, <span class="string">'zip'</span>: <span class="string">'10468'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>address2 = &#123;<span class="string">'addr1'</span>: <span class="string">'555 nowhere'</span>, <span class="string">'city'</span>: <span class="string">'New York'</span>, <span class="string">'state'</span>: <span class="string">'NY'</span>, <span class="string">'zip'</span>: <span class="string">'10468'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'name'</span>: <span class="string">'bob'</span>, <span class="string">'billing_address'</span>: address1, <span class="string">'shipping_address'</span>: address2&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(marshal(data, resource_fields))</span><br><span class="line"><span class="string">'&#123;"billing_address": &#123;"line 1": "123 fake street", "line 2": null, "state": "NY", "zip": "10468", "city": "New York"&#125;, "name": "bob", "shipping_address": &#123;"line 1": "555 nowhere", "line 2": null, "state": "NY", "zip": "10468", "city": "New York"&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p></p><p><font face="微软雅黑" color="red" size="3"><br>该示例使用两个 Nested 字段。Nested 构造函数接受一个字段组成的字典，然后将其渲染成一个子 fields.input 对象。Nested 构造函数和嵌套字典（上个例子）之间的重要不同点是：属性的上下文环境。在本例中，billing_address是一个复杂的对象，它拥有自己的字段，而传入到嵌套字段中的上下文环境是子对象，而不是原始的 data 对象。也就是说：data.billing_address.addr1处于该范围，而在前一示例中，data.addr1 则是位置属性。记住：Nested 和List 对象为属性创建了一个新的作用范围。<br></font><br>默认情况下，当子对象为 None 时，将会为嵌套字段生成一个包含默认值的对象，而不是 null 值。可以通过传入 allow_null 参数来修改这一点</p><p>使用 Nested 和 List 来编组更复杂对象的列表<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user_fields = api.model(<span class="string">'User'</span>, &#123;</span><br><span class="line">    <span class="string">'id'</span>: fields.Integer,</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">user_list_fields = api.model(<span class="string">'UserList'</span>, &#123;</span><br><span class="line">    <span class="string">'users'</span>: fields.List(fields.Nested(user_fields)),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><h2 id="4-9-api-model-工厂"><a href="#4-9-api-model-工厂" class="headerlink" title="4.9 api.model()工厂"></a>4.9 api.model()工厂</h2><p>model()工厂允许我们实例化并注册模型到我们的 API 和命名空间（Namespace）中<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">my_fields = api.model(<span class="string">'MyModel'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer(min=<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Equivalent to</span></span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Model</span><br><span class="line"></span><br><span class="line">my_fields = Model(<span class="string">'MyModel'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer(min=<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line">api.models[my_fields.name] = my_fields</span><br></pre></td></tr></table></figure><p></p><h3 id="4-9-1-clone实现复制"><a href="#4-9-1-clone实现复制" class="headerlink" title="4.9.1 clone实现复制"></a>4.9.1 clone实现复制</h3><p>Model.clone()方法使得我们可以实例化一个增强模型，它能够省去我们复制所有字段的麻烦<br>跟python的类继承有点类似，注意以下两种不同方式的写法。<br>如下面的例子,child除了有其自身的age之外,还有克隆parent过来的name<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parent = Model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = parent.clone(<span class="string">'Child'</span>, &#123;</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>示例代码如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, fields,Model</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">parent = Model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = parent.clone(<span class="string">'Child'</span>, &#123;</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">api.models[parent.name] = parent</span><br><span class="line">api.models[child.name] = child</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(child)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return Model(Todo('haha', 24),child)</span></span><br><span class="line">        <span class="keyword">return</span> Todo(<span class="string">'haha'</span>, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><p>结果如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\sandu&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/hello</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"haha"</span>,</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">24</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>Api/Namespace.clone 也会将其注册到 API<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parent = api.model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = api.clone(<span class="string">'Child'</span>, parent, &#123;</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>示例代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, fields,Model</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">parent = api.model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = api.clone(<span class="string">'Child'</span>, parent,&#123;</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(child)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return Model(Todo('haha', 24),child)</span></span><br><span class="line">        <span class="keyword">return</span> Todo(<span class="string">'haha'</span>, <span class="number">24</span>)</span><br></pre></td></tr></table></figure><p></p><p>结果如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\sandu&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/hello</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"haha"</span>,</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">24</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="4-9-2-api-inherit-实现多态"><a href="#4-9-2-api-inherit-实现多态" class="headerlink" title="4.9.2 api.inherit  实现多态"></a>4.9.2 api.inherit 实现多态</h3><p>Model.inherit()方法允许我们以“Swagger”方式扩展模型，并开始解决多态问题<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parent = api.model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'class'</span>: fields.String(discriminator=<span class="literal">True</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = api.inherit(<span class="string">'Child'</span>, parent, &#123;</span><br><span class="line">    <span class="string">'extra'</span>: fields.String</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>示例代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, fields,Model</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">parent = api.model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'class'</span>: fields.String(discriminator=<span class="literal">True</span>) <span class="comment"># 根据运行结果识别其作用</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = api.inherit(<span class="string">'Child'</span>, parent,&#123;</span><br><span class="line">    <span class="string">'extra'</span>: fields.String</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(child)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return Model(Todo('haha', 24),child)</span></span><br><span class="line">        <span class="keyword">return</span> Todo(<span class="string">'haha'</span>, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><p>运行结果：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\sandu&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/hello</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"extra"</span>: null,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"haha"</span>,</span><br><span class="line">    <span class="string">"class"</span>: <span class="string">"Child"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>使用浏览器访问(<a href="http://127.0.0.1:5000/" target="_blank" rel="noopener">http://127.0.0.1:5000/</a>)的话会看到Models中有两个</p><p>Api/Namespace.clone 会将 parent 和 child 都注册到 Swagger 模型定义中<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parent = Model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'class'</span>: fields.String(discriminator=<span class="literal">True</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = parent.inherit(<span class="string">'Child'</span>, &#123;</span><br><span class="line">    <span class="string">'extra'</span>: fields.String</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>示例代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, fields,Model</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">parent = Model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'class'</span>: fields.String() <span class="comment"># 此时没有discriminator=True，注意运行结果</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = parent.inherit(<span class="string">'Child'</span>, &#123;</span><br><span class="line">    <span class="string">'extra'</span>: fields.String</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">api.models[parent.name] = parent</span><br><span class="line">api.models[child.name] = child</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(child)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return Model(Todo('haha', 24),child)</span></span><br><span class="line">        <span class="keyword">return</span> Todo(<span class="string">'haha'</span>, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><p>运行结果：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\sandu&gt;curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>/hello</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"extra"</span>: null,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"haha"</span>,</span><br><span class="line">    <span class="string">"class"</span>: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>本例中的class字段只有在其不存在于序列化对象中时，才会以序列化的模型名称进行填充。</p><p>Polymorph字段允许你指定Python类和字段规范的映射关系：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mapping = &#123;</span><br><span class="line">    Child1: child1_fields,</span><br><span class="line">    Child2: child2_fields,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fields = api.model(<span class="string">'Thing'</span>, &#123;</span><br><span class="line">    owner: fields.Polymorph(mapping)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>注：这段还未看明白啥意思，具体咋操作的，结果如何，留待以后研究。</p><h2 id="4-10-自定义字段"><a href="#4-10-自定义字段" class="headerlink" title="4.10 自定义字段"></a>4.10 自定义字段</h2><p>自定义输出字段使得我们可以在无需直接修改内部对象的情况下，进行自定义的输出结果格式化操作。我们只需让类继承Raw，并实现format()方法：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllCapsString</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> value.upper()</span><br><span class="line"></span><br><span class="line"><span class="comment"># example usage</span></span><br><span class="line">fields = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'all_caps_name'</span>: AllCapsString(attribute=<span class="string">'name'</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>示例代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, fields,Model</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllCapsString</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> value.upper()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fields = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'all_caps_name'</span>: AllCapsString(attribute=<span class="string">'age'</span>), <span class="comment"># 其值是根据attribute指定的而定，不如attribute='age'，则输出的结果是‘24’，若是attribute='name'，则输出结果是“HAHA”,具体详看下方的运行结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return Model(Todo('haha', 24),child)</span></span><br><span class="line">        <span class="keyword">return</span> Todo(<span class="string">'haha'</span>, <span class="string">'24'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><p>运行结果如下:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\sandu&gt;curl http://127.0.0.1:5000/hello</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"haha"</span>,</span><br><span class="line">    <span class="string">"all_caps_name"</span>: <span class="string">"24"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">C:\Users\sandu&gt;curl http://127.0.0.1:5000/hello</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"haha"</span>,</span><br><span class="line">    <span class="string">"all_caps_name"</span>: <span class="string">"HAHA"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>也可以使用<strong>schema_format</strong>、<strong>schema_type</strong>和<strong>schema_example</strong>来指定生成的类型和例子：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIntField</span><span class="params">(fields.Integer)</span>:</span></span><br><span class="line">    __schema_format__ = <span class="string">'int64'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySpecialField</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    __schema_type__ = <span class="string">'some-type'</span></span><br><span class="line">    __schema_format__ = <span class="string">'some-format'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyVerySpecialField</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    __schema_example__ = <span class="string">'hello, world'</span></span><br></pre></td></tr></table></figure><p></p><p>实际代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, fields,Model</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllCapsString</span><span class="params">(fields.Raw)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> value.upper()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIntField</span><span class="params">(fields.Integer)</span>:</span></span><br><span class="line">    __schema_format__ = <span class="string">'int64'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySpecialField</span><span class="params">(fields.Raw)</span>:</span> <span class="comment"># 具体作用还有待研究</span></span><br><span class="line">    __schema_type__ = <span class="string">'string'</span></span><br><span class="line">    __schema_format__ = <span class="string">'string'</span></span><br><span class="line">    __schema_example__ = <span class="string">'hello, world'</span></span><br><span class="line"></span><br><span class="line">fields = &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'all_caps_name'</span>: AllCapsString(attribute=<span class="string">'name'</span>),</span><br><span class="line">    <span class="string">'age'</span>:MyIntField(), <span class="comment"># 有转换数据类型的功能，输入的是字符串'22',运行结果显示的是数字22</span></span><br><span class="line">    <span class="string">'class'</span>:MySpecialField(attribute=<span class="string">'banji'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, banji)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.banji = banji</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return Model(Todo('haha', 24),child)</span></span><br><span class="line">        <span class="keyword">return</span> Todo(<span class="string">'haha'</span>,<span class="string">'22'</span>,<span class="string">'erjini'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><h2 id="4-11-跳过值为None的字段"><a href="#4-11-跳过值为None的字段" class="headerlink" title="4.11 跳过值为None的字段"></a>4.11 跳过值为None的字段</h2><p>将可选参数skip_none设置为True<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from flask_restplus import Model, fields, marshal_with</span><br><span class="line">&gt;&gt;&gt; import json</span><br><span class="line">&gt;&gt;&gt; model = Model(<span class="string">'Model'</span>, &#123;</span><br><span class="line">...     <span class="string">'name'</span>: fields.String,</span><br><span class="line">...     <span class="string">'address_1'</span>: fields.String,</span><br><span class="line">...     <span class="string">'address_2'</span>: fields.String</span><br><span class="line">... &#125;)</span><br><span class="line">&gt;&gt;&gt; @marshal_with(model, skip_none=True)</span><br><span class="line">... def get():</span><br><span class="line">...     <span class="built_in">return</span> &#123;<span class="string">'name'</span>: <span class="string">'John'</span>, <span class="string">'address_1'</span>: None&#125;</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; get()</span><br><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'John'</span>)])</span><br></pre></td></tr></table></figure><p></p><p>可以看到，address_1和address_2被marshal_with()跳过了。address_1被跳过是因为它的值为None，而address_2被跳过是因为get()返回的字典中并不包含address_2这个key。</p><h2 id="4-12跳过嵌套字段中的None字段"><a href="#4-12跳过嵌套字段中的None字段" class="headerlink" title="4.12跳过嵌套字段中的None字段"></a>4.12跳过嵌套字段中的None字段</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from flask_restplus import Model, fields, marshal_with</span><br><span class="line">&gt;&gt;&gt; import json</span><br><span class="line">&gt;&gt;&gt; model = Model(<span class="string">'Model'</span>, &#123;</span><br><span class="line">...     <span class="string">'name'</span>: fields.String,</span><br><span class="line">...     <span class="string">'location'</span>: fields.Nested(location_model, skip_none=True)</span><br><span class="line">... &#125;)</span><br></pre></td></tr></table></figure><h2 id="4-13-使用JSON-Schema定义模型"><a href="#4-13-使用JSON-Schema定义模型" class="headerlink" title="4.13 使用JSON Schema定义模型"></a>4.13 使用JSON Schema定义模型</h2><p>注：这个还不知道具体咋使用的<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">address = api.schema_model(<span class="string">'Address'</span>, &#123;</span><br><span class="line">    <span class="string">'properties'</span>: &#123;</span><br><span class="line">        <span class="string">'road'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'string'</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'type'</span>: <span class="string">'object'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">person = address = api.schema_model(<span class="string">'Person'</span>, &#123;</span><br><span class="line">    <span class="string">'required'</span>: [<span class="string">'address'</span>],</span><br><span class="line">    <span class="string">'properties'</span>: &#123;</span><br><span class="line">        <span class="string">'name'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'string'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'age'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'integer'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'birthdate'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'string'</span>,</span><br><span class="line">            <span class="string">'format'</span>: <span class="string">'date-time'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'address'</span>: &#123;</span><br><span class="line">            <span class="string">'$ref'</span>: <span class="string">'#/definitions/Address'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'type'</span>: <span class="string">'object'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><h1 id="5-请求解析"><a href="#5-请求解析" class="headerlink" title="5.请求解析"></a>5.请求解析</h1><p>Flask-RESTPlus的请求解析接口reqparse是模仿argparse接口实现的。它的设计目的是对Flask中flask.request对象上的任何变量提供简单和统一的访问方式。</p><h2 id="5-1-基本参数"><a href="#5-1-基本参数" class="headerlink" title="5.1 基本参数"></a>5.1 基本参数</h2><p>如下是一个简单示例，在flask.Request.values字典中查找两个参数：一个整数和一个字符串：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> reqparse</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser()</span><br><span class="line">parser.add_argument(<span class="string">'rate'</span>, type=int, help=<span class="string">'Rate cannot be converted'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'name'</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure><p></p><blockquote><p>默认参数类型是unicode字符串。在Python3中为str类型，而在Python2中为unicode。</p></blockquote><p>如果指定了help变量的值，那么在解析请求时，如果出现了类型错误，那么会将它渲染为错误信息。如果未指定help信息，那么默认的行为是返回类型错误信息本身。</p><blockquote><p>默认情况下，参数不是必需的。并且，如果请求中提供的某些参数不是RequestParser的部分内容，那么这些参数将会被忽略。<br>请求解析器中声明的参数，如果在请求中并未设置这些参数值，那么它们将会默认设置为None。</p></blockquote><h2 id="5-2-必须参数"><a href="#5-2-必须参数" class="headerlink" title="5.2 必须参数"></a>5.2 必须参数</h2><p>如果需要确保某个参数必须提供，那么可以在调用add_argument()时传入required=True的参数项：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'name'</span>, required=<span class="literal">True</span>, help=<span class="string">"Name cannot be blank!"</span>)</span><br></pre></td></tr></table></figure><p></p><blockquote><p>如果请求中未提供该参数，那么将会返回错误信息</p></blockquote><h2 id="5-3-多值和列表"><a href="#5-3-多值和列表" class="headerlink" title="5.3 多值和列表"></a>5.3 多值和列表</h2><p>为某个key接受多个值以构成列表，那么可以传入action=’append’：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'name'</span>, action=<span class="string">'append'</span>)</span><br></pre></td></tr></table></figure><p></p><p>此时的查询格式如下所示：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://api.example.com -d <span class="string">"name=bob"</span> -d <span class="string">"name=sue"</span> -d <span class="string">"name=joe"</span></span><br></pre></td></tr></table></figure><p></p><p>而程序中获取到的参数如下所示：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">args = parser.parse_args()</span><br><span class="line">args[<span class="string">'name'</span>] <span class="comment"># ['bob', 'sue', 'joe']</span></span><br></pre></td></tr></table></figure><p></p><p>如果期望一个逗号分隔的列表，那么可以使用action=’split’：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'fruits'</span>, action=<span class="string">'split'</span>)</span><br></pre></td></tr></table></figure><p></p><p>此时的查询格式如下所示：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://api.example.com -d <span class="string">"fruits=apple,lemon,cherry"</span></span><br></pre></td></tr></table></figure><p></p><p>而程序中获取到的参数如下所示：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">args = parser.parse_args()</span><br><span class="line">args[<span class="string">'fruits'</span>] <span class="comment"># ['apple', 'lemon', 'cherry']</span></span><br></pre></td></tr></table></figure><p></p><h2 id="5-4-其他目标"><a href="#5-4-其他目标" class="headerlink" title="5.4 其他目标"></a>5.4 其他目标</h2><p>如果期望参数一旦被解析，就将其存储为其他名字，那么可以使用dest参数：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'name'</span>, dest=<span class="string">'public_name'</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">args[<span class="string">'public_name'</span>]</span><br></pre></td></tr></table></figure><p></p><h2 id="5-5-参数位置"><a href="#5-5-参数位置" class="headerlink" title="5.5 参数位置"></a>5.5 参数位置</h2><p>默认情况下，RequestParser尝试从flask.Request.values和flask.Request.json中解析值。</p><p>在add_argument()中使用location参数来指定获取值的其他位置。可以使用flask.Request上的任何变量，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅仅在POST body中查找</span></span><br><span class="line">parser.add_argument(<span class="string">'name'</span>, type=int, location=<span class="string">'form'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅仅在querystring中查找</span></span><br><span class="line">parser.add_argument(<span class="string">'PageSize'</span>, type=int, location=<span class="string">'args'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从请求头中查找</span></span><br><span class="line">parser.add_argument(<span class="string">'User-Agent'</span>, location=<span class="string">'headers'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从http cookies中查找</span></span><br><span class="line">parser.add_argument(<span class="string">'session_id'</span>, location=<span class="string">'cookies'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从上传文件中查找</span></span><br><span class="line">parser.add_argument(<span class="string">'picture'</span>, type=werkzeug.datastructures.FileStorage, location=<span class="string">'files'</span>)</span><br></pre></td></tr></table></figure><blockquote><p>当location=’json’时只能使用type=list<br>使用location=’form’既能验证表单数据，又能为表单字段文档化</p></blockquote><h2 id="5-6-参数多位置"><a href="#5-6-参数多位置" class="headerlink" title="5.6 参数多位置"></a>5.6 参数多位置</h2><p>为location参数赋一个列表就能为参数指定多个位置：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'text'</span>, location=[<span class="string">'headers'</span>, <span class="string">'values'</span>])</span><br></pre></td></tr></table></figure><p></p><p>当指定多个参数位置时，那么所有指定位置的参数将会组成一个MultiDict。其中，列表中最后位置处的参数将会优先存储在结果集中。</p><p>如果参数位置列表中包含headers位置，那么参数名将变成对大小写敏感，并且必须匹配它们的标题大小写名称（见str.title()）。</p><p>指定location=’headers’（而不是作为列表的某个元素）将保留大小写不敏感的特性。</p><h2 id="5-7-高级类型处理"><a href="#5-7-高级类型处理" class="headerlink" title="5.7 高级类型处理"></a>5.7 高级类型处理</h2><p>inputs模块中提供了一些常用的类型处理方法，如下：</p><pre><code>- boolean()用于广泛的布尔值处理
- ipv4()和ipv6()用于IP地址
- date_from_iso8601()和datetime_from_iso8601()用于ISO8601 date和datetime处理
</code></pre><p>只需要使用它们作为type参数的值即可：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(<span class="string">'flag'</span>, type=inputs.boolean)</span><br></pre></td></tr></table></figure><p></p><p>我们也可以编写自己的输入类型：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_type</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="string">'''Parse my type'''</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> condition:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'This is not my type'</span>)</span><br><span class="line">    <span class="keyword">return</span> parse(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Swagger documntation</span></span><br><span class="line">my_type.__schema__ = &#123;<span class="string">'type'</span>: <span class="string">'string'</span>, <span class="string">'format'</span>: <span class="string">'my-custom-format'</span>&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="5-8-解析器继承"><a href="#5-8-解析器继承" class="headerlink" title="5.8 解析器继承"></a>5.8 解析器继承</h2><p>可以编写一个父解析器，父解析器中包含所有共同的参数，然后利用copy()方法来扩展解析器。另外，也可以利用replace_argument()来覆写父解析器中的任何参数，或者利用remove_argument()完全移除父解析器中的某个参数。例如：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> reqparse</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser()</span><br><span class="line">parser.add_argument(<span class="string">'foo'</span>, type=int)</span><br><span class="line"></span><br><span class="line">parser_copy = parser.copy()</span><br><span class="line">parser_copy.add_argument(<span class="string">'bar'</span>, type=int)</span><br><span class="line"></span><br><span class="line"><span class="comment"># parser_copy has both 'foo' and 'bar'</span></span><br><span class="line"></span><br><span class="line">parser_copy.replace_argument(<span class="string">'foo'</span>, required=<span class="literal">True</span>, location=<span class="string">'json'</span>)</span><br><span class="line"><span class="comment"># 'foo' is now a required str located in json, not an int as defined</span></span><br><span class="line"><span class="comment">#  by original parser</span></span><br><span class="line"></span><br><span class="line">parser_copy.remove_argument(<span class="string">'foo'</span>)</span><br><span class="line"><span class="comment"># parser_copy no longer has 'foo' argument</span></span><br></pre></td></tr></table></figure><p></p><h2 id="5-9-文件上传"><a href="#5-9-文件上传" class="headerlink" title="5.9 文件上传"></a>5.9 文件上传</h2><p>为了利用RequestParser处理文件上传问题，我们需要将location变量值设置为files，并设置type值为FileStorage。如下所示：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.datastructures <span class="keyword">import</span> FileStorage</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"></span><br><span class="line">upload_parser = api.parser()</span><br><span class="line">upload_parser.add_argument(<span class="string">'file'</span>, location=<span class="string">'files'</span>,</span><br><span class="line">                           type=FileStorage, required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/upload/')</span></span><br><span class="line"><span class="meta">@api.expect(upload_parser)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        args = upload_parser.parse_args()</span><br><span class="line">        file_ = args[<span class="string">'file'</span>]</span><br><span class="line">        file_descriptor, filename = tempfile.mkstemp(suffix=<span class="string">'.xlsx'</span>)</span><br><span class="line">        file_.save(filename) <span class="comment"># 保存文件</span></span><br><span class="line">        <span class="comment"># print(filename) # 获取文件的绝对路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'success'</span></span><br></pre></td></tr></table></figure><p></p><h2 id="5-10-错误处理"><a href="#5-10-错误处理" class="headerlink" title="5.10 错误处理"></a>5.10 错误处理</h2><p>RequestParser处理错误的默认方式是在第一个错误产生时中断。当我们拥有需要花费一定时间来处理的参数时，这种方式是有好处的。然而，通常来说，将所有产生的错误都绑定在一起，然后同时一次性返回给客户端，这种方式则更加友好。这种方式既可以在Flask应用级别指定，也可以在特定的RequestParser实例级别指定。为了调用一个包含错误绑定选项的RequestParser，需要传入参数bundle_errors。例如：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> reqparse</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser(bundle_errors=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(<span class="string">'foo'</span>, type=int, required=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(<span class="string">'bar'</span>, type=int, required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # 如果某个请求中同时不包含'foo'和'bar'，那么返回的错误将看起来如下所示：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>:  &#123;</span><br><span class="line">        <span class="string">"foo"</span>: <span class="string">"foo error message"</span>,</span><br><span class="line">        <span class="string">"bar"</span>: <span class="string">"bar error message"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认操作将仅仅返回第一个错误</span></span><br><span class="line">parser = RequestParser()</span><br><span class="line">parser.add_argument(<span class="string">'foo'</span>, type=int, required=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(<span class="string">'bar'</span>, type=int, required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>:  &#123;</span><br><span class="line">        <span class="string">"foo"</span>: <span class="string">"foo error message"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>示例代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, reqparse</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser(bundle_errors=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(<span class="string">'foo'</span>, type=int, required=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(<span class="string">'bar'</span>, type=int, required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'111'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self)</span>:</span></span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        print(args)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'222'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置bundle_errors=True的情况</span></span><br><span class="line">C:\Users\sandu&gt;curl http://127.0.0.1:5000/hello  -X PUT</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"errors"</span>: &#123;</span><br><span class="line">        <span class="string">"foo"</span>: <span class="string">"Missing required parameter in the JSON body or the post body or</span></span><br><span class="line"><span class="string">the query string"</span>,</span><br><span class="line">        <span class="string">"bar"</span>: <span class="string">"Missing required parameter in the JSON body or the post body or</span></span><br><span class="line"><span class="string">the query string"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"Input payload validation failed"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 未设置bundle_errors=True的情况</span></span><br><span class="line">C:\Users\sandu&gt;curl http://127.0.0.1:5000/hello  -X PUT</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"errors"</span>: &#123;</span><br><span class="line">        <span class="string">"foo"</span>: <span class="string">"Missing required parameter in the JSON body or the post body or</span></span><br><span class="line"><span class="string">the query string"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"Input payload validation failed"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应用级别的配置key为“BUNDLE_ERRORS”。例如：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'BUNDLE_ERRORS'</span>] = <span class="literal">True</span></span><br></pre></td></tr></table></figure><p></p><blockquote><p>BUNDLE_ERRORS是一个全局设置，它将覆盖每个RequestParser实例中的bundle_errors选项值</p></blockquote><h2 id="4-11-错误消息"><a href="#4-11-错误消息" class="headerlink" title="4.11 错误消息"></a>4.11 错误消息</h2><p>每个字段的错误消息都可以通过在Argument（也包括RequestParser.add_argument）中使用help参数来自定义。</p><p>如果没有提供help参数，那么该字段的错误消息将会是类型错误本身的字符串表示。如果提供了help参数，那么错误消息将会是help参数的值。</p><p>help可能包含一个插入的符号{error_msg}，它将会替换成类型错误的字符串表示。这种方式能够实现自定义错误消息，同时保留原始的错误消息。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> reqparse</span><br><span class="line"></span><br><span class="line">parser = reqparse.RequestParser()</span><br><span class="line">parser.add_argument(</span><br><span class="line">    <span class="string">'foo'</span>,</span><br><span class="line">    choices=(<span class="string">'one'</span>, <span class="string">'two'</span>),</span><br><span class="line">    help=<span class="string">'Bad choice: &#123;error_msg&#125;'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果请求中的'foo'参数值为'three'，那么错误信息将会如下所示：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>:  &#123;</span><br><span class="line">        <span class="string">"foo"</span>: <span class="string">"Bad choice: three is not a valid choice"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Resource, Api, reqparse</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># choices参数表示变量的值是从这中间的值</span></span><br><span class="line">parser = reqparse.RequestParser()</span><br><span class="line">parser.add_argument(<span class="string">'foo'</span>, choices=(<span class="string">'one'</span>, <span class="string">'two'</span>), help=<span class="string">'Bad choice: &#123;error_msg&#125;'</span>,required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/hello')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'111'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self)</span>:</span></span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        print(args)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'222'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成的错误信息跟官方提供的有点不一样，具体如下：</span></span><br><span class="line">C:\Users\sandu&gt;curl http://127.0.0.1:5000/hello -d <span class="string">"foo=three"</span> -X PUT</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"errors"</span>: &#123;</span><br><span class="line">        <span class="string">"foo"</span>: <span class="string">"Bad choice: &#123;error_msg&#125; The value 'three' is not a valid choice</span></span><br><span class="line"><span class="string">for 'foo'."</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"Input payload validation failed"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="6-错误处理"><a href="#6-错误处理" class="headerlink" title="6.错误处理"></a>6.错误处理</h1><h2 id="6-1-http异常处理"><a href="#6-1-http异常处理" class="headerlink" title="6.1  http异常处理"></a>6.1 http异常处理</h2><p>Werkzeug httpException将自动正确序列化，并重用description属性。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.exceptions <span class="keyword">import</span> BadRequest</span><br><span class="line"><span class="keyword">raise</span> BadRequest()</span><br></pre></td></tr></table></figure><p></p><p>返回如下的400错误代码和信息：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"The browser (or proxy) sent a request that this server could not understand."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>若是设置的有自定义的错误信息，比如这样的：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.exceptions <span class="keyword">import</span> BadRequest</span><br><span class="line"><span class="keyword">raise</span> BadRequest(<span class="string">'My custom message'</span>)</span><br></pre></td></tr></table></figure><p></p><p>错误显示信息将会是这样的：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"My custom message"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>还可以 通过向异常提供数据属性，可以将附加属性附加到输出。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.exceptions <span class="keyword">import</span> BadRequest</span><br><span class="line">e = BadRequest(<span class="string">'My custom message'</span>)</span><br><span class="line">e.data = &#123;<span class="string">'custom'</span>: <span class="string">'value'</span>&#125;</span><br><span class="line"><span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure><p></p><p>错误显示信息将会是这样的：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"My custom message"</span>,</span><br><span class="line">    <span class="string">"custom"</span>: <span class="string">"value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="6-2-Flask错误助手"><a href="#6-2-Flask错误助手" class="headerlink" title="6.2 Flask错误助手"></a>6.2 Flask错误助手</h2><p>abort帮助程序将错误正确包装到httpexception中，以便具有相同的行为。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line">abort(<span class="number">400</span>)</span><br></pre></td></tr></table></figure><p></p><p>返回如下的400错误代码和信息：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"The browser (or proxy) sent a request that this server could not understand."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>如果在abort中指定错误代码和错误信息，比如：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line">abort(<span class="number">400</span>, <span class="string">'My custom message'</span>)</span><br></pre></td></tr></table></figure><p></p><p>错误显示信息将会是这样的：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"My custom message"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="6-3-Flask-RESTPlus错误助手"><a href="#6-3-Flask-RESTPlus错误助手" class="headerlink" title="6.3 Flask-RESTPlus错误助手"></a>6.3 Flask-RESTPlus错误助手</h2><p>errors.abort()和namespace.abort()的工作方式与原始flask.abort()类似，但它还将向响应添加关键字参数。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> abort</span><br><span class="line">abort(<span class="number">400</span>, custom=<span class="string">'value'</span>)</span><br></pre></td></tr></table></figure><p></p><p>返回如下的400错误代码和信息：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"The browser (or proxy) sent a request that this server could not understand."</span>,</span><br><span class="line">    <span class="string">"custom"</span>: <span class="string">"value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>如果在abort中指定错误代码和错误信息，比如：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</span><br><span class="line">abort(<span class="number">400</span>, <span class="string">'My custom message'</span>, custom=<span class="string">'value'</span>)</span><br></pre></td></tr></table></figure><p></p><p>错误显示信息将会是这样的：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"My custom message"</span>,</span><br><span class="line">    <span class="string">"custom"</span>: <span class="string">"value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="6-4-api-errorhandler装饰器"><a href="#6-4-api-errorhandler装饰器" class="headerlink" title="6.4 @api.errorhandler装饰器"></a>6.4 @api.errorhandler装饰器</h2><p>@api.errorhandler 装饰器允许您以与flask/blueprint@errorhandler decorator相同的方式为给定的异常（或从中继承的任何异常）注册特定的处理程序。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.errorhandler(RootException)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_root_exception</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Return a custom message and 400 status code'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: <span class="string">'What you want'</span>&#125;, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.errorhandler(CustomException)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_custom_exception</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Return a custom message and 400 status code'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: <span class="string">'What you want'</span>&#125;, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.errorhandler(AnotherException)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_another_exception</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Return a custom message and 500 status code'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: error.specific&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.errorhandler(FakeException)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_fake_exception_with_header</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Return a custom message and 400 status code'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: error.message&#125;, <span class="number">400</span>, &#123;<span class="string">'My-Header'</span>: <span class="string">'Value'</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.errorhandler(NoResultFound)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_no_result_exception</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Return a custom not found error message and 404 status code'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: error.specific&#125;, <span class="number">404</span></span><br></pre></td></tr></table></figure><p></p><blockquote><p>OpenAPI 2.0规范要求“noresultfound”错误（带说明）。错误句柄函数中的docstring将作为说明输出到swagger.json中。</p></blockquote><p>或者使用如下的这种方式：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.errorhandler(FakeException)</span></span><br><span class="line"><span class="meta">@api.marshal_with(error_fields, code=400)</span></span><br><span class="line"><span class="meta">@api.header('My-Header',  'Some description')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_fake_exception_with_header</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''This is a custom error'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: error.message&#125;, <span class="number">400</span>, &#123;<span class="string">'My-Header'</span>: <span class="string">'Value'</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/test/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Do something</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :raises CustomException: In case of something</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>在这个例子中，函数文档中的:raise:的信息将会自动提取出来，并且响应400将正确记录</p><p>它还允许在不使用参数的情况下重写默认错误处理程序<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.errorhandler</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">default_error_handler</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Default error handler'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: str(error)&#125;, getattr(error, <span class="string">'code'</span>, <span class="number">500</span>)</span><br></pre></td></tr></table></figure><p></p><blockquote><p>默认情况下，flask restplus将在错误响应中返回一条消息。如果需要自定义响应作为错误，而不需要消息字段，则可以通过在应用程序配置中将error_include_message设置为false来禁用该响应。</p></blockquote><p>也可以在命名空间上注册错误处理程序。在命名空间上注册的错误处理程序将重写在API上注册的错误处理程序。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ns = Namespace(<span class="string">'cats'</span>, description=<span class="string">'Cats related operations'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@ns.errorhandler</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">specific_namespace_error_handler</span><span class="params">(error)</span>:</span></span><br><span class="line">    <span class="string">'''Namespace error handler'''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'message'</span>: str(error)&#125;, getattr(error, <span class="string">'code'</span>, <span class="number">500</span>)</span><br></pre></td></tr></table></figure><p></p><h1 id="7-字段掩码"><a href="#7-字段掩码" class="headerlink" title="7.字段掩码"></a>7.字段掩码</h1><p>flask restplus支持部分对象获取（aka.字段屏蔽）通过在请求中提供自定义头。<br>默认情况下，请求头是X-Fields字段，但可以使用restplus_mask_header参数进行更改。</p><h2 id="7-1-语法"><a href="#7-1-语法" class="headerlink" title="7.1 语法"></a>7.1 语法</h2><p>只需提供一个由逗号分隔的字段名列表，可以选择用括号括起来。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下两种写法作用相等</span></span><br><span class="line">mask = <span class="string">'&#123;name,age&#125;'</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">mask = <span class="string">'name,age'</span></span><br><span class="line">data = requests.get(<span class="string">'/some/url/'</span>, headers=&#123;<span class="string">'X-Fields'</span>: mask&#125;)</span><br><span class="line"><span class="keyword">assert</span> len(data) == <span class="number">2</span></span><br><span class="line"><span class="keyword">assert</span> <span class="string">'name'</span> <span class="keyword">in</span> data</span><br><span class="line"><span class="keyword">assert</span> <span class="string">'age'</span> <span class="keyword">in</span> data</span><br></pre></td></tr></table></figure><p></p><p>要指定嵌套字段掩码，只需在字段名后面的括号中提供它：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mask = <span class="string">'&#123;name, age, pet&#123;name&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p></p><p>嵌套规范适用于嵌套对象或对象列表：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Will apply the mask &#123;name&#125; to each pet in the pets list.</span></span><br><span class="line">mask = <span class="string">'&#123;name, age, pets&#123;name&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p></p><p>有一个特殊的星形标记，意思是“所有剩余字段”。它只允许指定嵌套筛选：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Will apply the mask &#123;name&#125; to each pet in the pets list and take all other root fields without filtering.</span></span><br><span class="line">mask = <span class="string">'&#123;pets&#123;name&#125;,*&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Will not filter anything</span></span><br><span class="line">mask = <span class="string">'*'</span></span><br></pre></td></tr></table></figure><p></p><h2 id="7-2-用法"><a href="#7-2-用法" class="headerlink" title="7.2 用法"></a>7.2 用法</h2><p>默认情况下，每次使用api.marshal或@api.marshal_with时，如果存在头，则会自动应用掩码。<br>每次将@api.marshal_与decorator一起使用时，头都将作为一个swager参数公开。<br>因为一旦全局头可以使您的Swagger规范更加冗长，它就不允许公开它。您可以通过将restplus_mask_swagger设置为false来禁用此行为。<br>还可以指定一个默认掩码，如果找不到头掩码，则将应用该默认掩码。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(my_model, mask='name,age')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>默认掩码也可以在模型级别处理：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = api.model(<span class="string">'Person'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'age'</span>: fields.Integer,</span><br><span class="line">    <span class="string">'boolean'</span>: fields.Boolean,</span><br><span class="line">&#125;, mask=<span class="string">'&#123;name,age&#125;'</span>)</span><br></pre></td></tr></table></figure><p></p><p>要覆盖默认掩码，您需要提供另一个掩码或将*作为掩码传递。</p><h1 id="8-Swagger文档"><a href="#8-Swagger文档" class="headerlink" title="8. Swagger文档"></a>8. Swagger文档</h1><p>Swagger API文档是自动生成的，可以从API的根URL获得。您可以使用@api.doc()装饰器配置文档。</p><h2 id="8-1-api-doc-装饰器文档"><a href="#8-1-api-doc-装饰器文档" class="headerlink" title="8.1 @api.doc()装饰器文档"></a>8.1 @api.doc()装饰器文档</h2><p>@api.doc()装饰器允许您在文档中包含其他信息。<br>可以在class类中或者method中<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;', endpoint='my-resource')</span></span><br><span class="line"><span class="meta">@api.doc(params=&#123;'id': 'An ID'&#125;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @api.doc(responses=&#123;403: 'Not Authorized'&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        api.abort(<span class="number">403</span>)</span><br></pre></td></tr></table></figure><p></p><h2 id="8-2-自动文件模型"><a href="#8-2-自动文件模型" class="headerlink" title="8.2  自动文件模型"></a>8.2 自动文件模型</h2><p>使用model（）、clone（）和inherit（）实例化的所有模型都将自动记录在您的swager规范中。<br>inherit()方法将在swager模型定义中同时注册父级和子级：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parent = api.model(<span class="string">'Parent'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">    <span class="string">'class'</span>: fields.String(discriminator=<span class="literal">True</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child = api.inherit(<span class="string">'Child'</span>, parent, &#123;</span><br><span class="line">    <span class="string">'extra'</span>: fields.String</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>上述配置将产生以下Swagger 定义：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Parent"</span>: &#123;</span><br><span class="line">    <span class="string">"properties"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: &#123;<span class="string">"type"</span>: <span class="string">"string"</span>&#125;,</span><br><span class="line">        <span class="string">"class"</span>: &#123;<span class="string">"type"</span>: <span class="string">"string"</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"discriminator"</span>: <span class="string">"class"</span>,</span><br><span class="line">    <span class="string">"required"</span>: [<span class="string">"class"</span>]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"Child"</span>: &#123;</span><br><span class="line">    <span class="string">"allOf"</span>: [&#123;</span><br><span class="line">            <span class="string">"$ref"</span>: <span class="string">"#/definitions/Parent"</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="string">"properties"</span>: &#123;</span><br><span class="line">                <span class="string">"extra"</span>: &#123;<span class="string">"type"</span>: <span class="string">"string"</span>&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="8-3-api-marshal-with-装饰器"><a href="#8-3-api-marshal-with-装饰器" class="headerlink" title="8.3@api.marshal_with()装饰器"></a><a href="mailto:8.3@api.marsha" target="_blank" rel="noopener">8.3@api.marsha</a>l_with()装饰器</h2><p>此装饰器的工作方式与原始marshal_with（）装饰器类似，不同之处在于它记录了这些方法。可选参数代码允许您指定预期的HTTP状态代码（默认为200）。可选参数as_list允许您指定对象是否作为列表返回。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;', endpoint='my-resource')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_with(resource_fields, as_list=True)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> get_objects()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @api.marshal_with(resource_fields, code=201)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> create_object(), <span class="number">201</span></span><br></pre></td></tr></table></figure><p></p><p>Api.marshal_list_with()装饰器严格相等于Api.marshal_with(fields, as_list=True)()。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;', endpoint='my-resource')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.marshal_list_with(resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> get_objects()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @api.marshal_with(resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> create_object()</span><br></pre></td></tr></table></figure><p></p><h2 id="8-4-api-expect-装饰器"><a href="#8-4-api-expect-装饰器" class="headerlink" title="8.4 @api.expect()装饰器"></a>8.4 @api.expect()装饰器</h2><p>@api.expect（）装饰器允许您指定预期的输入字段。它接受一个可选的布尔参数validate，指示是否应验证有效负载。通过将restplus_validate配置设置为true或将validate=true传递给API构造函数，可以全局自定义验证行为。<br>如下两个例子的作用是相等的：</p><ol><li><p>使用@api.expect()装饰器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p>使用api.doc()装饰器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.doc(body=resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li></ol><p>可以将列表指定为预期输入：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.expect([resource_fields])</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>可以使用RequestParser定义预期的输入：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">parser = api.parser()</span><br><span class="line">parser.add_argument(<span class="string">'param'</span>, type=int, help=<span class="string">'Some param'</span>, location=<span class="string">'form'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'in_files'</span>, type=FileStorage, location=<span class="string">'files'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/with-parser/', endpoint='with-parser')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WithParserResource</span><span class="params">(restplus.Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.expect(parser)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>可以在特定终结点上启用或禁用验证：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="comment"># Payload validation disabled</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Payload validation enabled</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields, validate=True)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>通过配置进行的应用程序范围验证示例：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">'RESTPLUS_VALIDATE'</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="comment"># Payload validation enabled</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Payload validation disabled</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields, validate=False)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>构造函数在应用程序范围内验证的示例：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">api = Api(app, validate=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">resource_fields = api.model(<span class="string">'Resource'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="comment"># Payload validation enabled</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Payload validation disabled</span></span><br><span class="line"><span class="meta">    @api.expect(resource_fields, validate=False)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><h2 id="8-5-api-response-装饰器文档"><a href="#8-5-api-response-装饰器文档" class="headerlink" title="8.5 @api.response()装饰器文档"></a>8.5 @api.response()装饰器文档</h2><p>@api.response()装饰器允许您记录已知的响应，它是@api.doc(responses=’’的快捷方式)<br>如下两个示例是相等的：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('/my-resource/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.response(200, 'Success')</span></span><br><span class="line"><span class="meta">    @api.response(400, 'Validation Error')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.doc(responses=&#123;</span></span><br><span class="line">        <span class="number">200</span>: <span class="string">'Success'</span>,</span><br><span class="line">        <span class="number">400</span>: <span class="string">'Validation Error'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>您可以选择指定响应模型作为第三个参数：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">model = api.model(<span class="string">'Model'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.response(200, 'Success', model)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>@api.marshal_with()装饰器自动记录响应：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">model = api.model(<span class="string">'Model'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: fields.String,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/my-resource/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.response(400, 'Validation error')</span></span><br><span class="line"><span class="meta">    @api.marshal_with(model, code=201, description='Object created')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><p>您可以指定在不知道响应代码的情况下发送的默认响应：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('/my-resource/')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line"><span class="meta">    @api.response('default', 'Error')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p></p><h2 id="8-6-api-route-装饰器"><a href="#8-6-api-route-装饰器" class="headerlink" title="8.6 @api.route()装饰器"></a>8.6 @api.route()装饰器</h2><p>您可以使用api.route()的doc参数提供类范围的文档。此参数接受与api.doc()装饰器相同的值。<br>以下两种装饰器例子作用相同：</p><ol><li><p>使用@api.doc()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;', endpoint='my-resource')</span></span><br><span class="line"><span class="meta">@api.doc(params=&#123;'id': 'An ID'&#125;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用@api.route()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('/my-resource/&lt;id&gt;', endpoint='my-resource', doc=&#123;'params':&#123;'id': 'An ID'&#125;&#125;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span><span class="params">(Resource)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="8-7-fields参数"><a href="#8-7-fields参数" class="headerlink" title="8.7 fields参数"></a>8.7 fields参数</h2><p>……未完待续……</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束 <i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>如果觉得我的文章对您有用,请随意打赏.您的支持将鼓励我继续创作!</div><br><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/img/wechat.jpg" alt="永夜初晗凝碧天 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/img/alipay.jpg" alt="永夜初晗凝碧天 支付宝"><p>支付宝</p></div></div></div></div><div><div class="post-copyright"><li class="post-copyright-title"><strong>本文标题：</strong> Flask-RESTPlus官方文档翻译</li><li class="post-copyright-author"><strong>文章作者：</strong> 永夜初晗凝碧天</li><li class="post-copyright-author"><strong>发布时间：</strong> 2019年12月31日 - 12:12:25</li><li class="post-copyright-author"><strong>更新时间：</strong> 2019年12月31日 - 12:12:25</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="/2019/12/31/Flask-RESTPlus官方文档翻译/" title="Flask-RESTPlus官方文档翻译">https://yongnights.github.io/2019/12/31/Flask-RESTPlus官方文档翻译/</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://yongnights.github.io/2019/12/31/Flask-RESTPlus官方文档翻译/" aria-label="复制成功！"></i></span></li><li class="post-copyright-license"><strong>版权声明： </strong><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</li></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a> <a href="/tags/Flask/" rel="tag"><i class="fa fa-tag"></i> Flask</a> <a href="/tags/Flask-RESTPlus/" rel="tag"><i class="fa fa-tag"></i> Flask-RESTPlus</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/12/31/CentOS 7.2安装redis/" rel="next" title="CentOS 7.2安装redis"><i class="fa fa-chevron-left"></i> CentOS 7.2安装redis</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/12/31/Hexo搭建教程-1/" rel="prev" title="Hexo搭建教程(1)">Hexo搭建教程(1) <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/img/avatar.png" alt="永夜初晗凝碧天"><p class="site-author-name" itemprop="name">永夜初晗凝碧天</p><p class="site-description motion-element" itemprop="description">Linux,Python,MySQL,ELK Stack,K8S,Docker</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">135</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">52</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">58</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="tencent://message/?Menu=yes&uin=1103324414" target="_blank" title="QQ"><i class="fa fa-fw fa-qq"></i>QQ</a> </span><span class="links-of-author-item"><a href="mailto:sandu12345@msn.cn" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1333220817&auto=0&height=66"></iframe><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.cnblogs.com/sanduzxcvbnm/" title="博客园" target="_blank">博客园</a></li><li class="links-of-blogroll-item"><a href="https://www.baidu.com/" title="百度" target="_blank">百度</a></li></ul></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li><a href="/2020/04/15/Elasticsearch集群规模和容量规划的底层逻辑/" target="_blank"></a></li><li><a href="/2020/04/14/EFK-5：ES集群开启用户认证 /" title="EFK-5 ES集群开启用户认证" target="_blank">EFK-5 ES集群开启用户认证</a></li><li><a href="/2020/04/14/EFK-4：ElasticSearch集群TLS加密通讯 /" title="EFK-4 ElasticSearch集群TLS加密通讯" target="_blank">EFK-4 ElasticSearch集群TLS加密通讯</a></li><li><a href="/2020/04/14/EFK-3： ES多实例部署 /" title="EFK-3 ES多实例部署" target="_blank">EFK-3 ES多实例部署</a></li><li><a href="/2020/04/14/EFK-2：ElasticSearch高性能高可用架构/" title="EFK-2 ElasticSearch高性能高可用架构" target="_blank">EFK-2 ElasticSearch高性能高可用架构</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-版本兼容性"><span class="nav-text">1. 版本兼容性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-安装"><span class="nav-text">2. 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-使用pip方式进行安装"><span class="nav-text">1. 使用pip方式进行安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-使用easy-install方式进行安装"><span class="nav-text">2. 使用easy_install方式进行安装</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-教程文档"><span class="nav-text">3. 教程文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-安装"><span class="nav-text">3.1 安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-快速开始"><span class="nav-text">3.2 快速开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-初始化"><span class="nav-text">3.2.1 初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-最简单的API"><span class="nav-text">3.2.2 最简单的API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-资源路由"><span class="nav-text">3.2.3 资源路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4-端点"><span class="nav-text">3.2.4 端点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-5-参数解析"><span class="nav-text">3.2.5 参数解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-6-数据格式化"><span class="nav-text">3.2.6 数据格式化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-7-完整例子"><span class="nav-text">3.2.7 完整例子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-响应编组"><span class="nav-text">4.响应编组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-基本使用"><span class="nav-text">4.1 基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-重命名属性"><span class="nav-text">4.2 重命名属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-默认值"><span class="nav-text">4.3 默认值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-自定义字段及多值情况"><span class="nav-text">4.4 自定义字段及多值情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-URL和其他字段"><span class="nav-text">4.5 URL和其他字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-复杂结构"><span class="nav-text">4.6 复杂结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-7-列表字段"><span class="nav-text">4.7 列表字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-8-嵌套字段"><span class="nav-text">4.8 嵌套字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-9-api-model-工厂"><span class="nav-text">4.9 api.model()工厂</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-1-clone实现复制"><span class="nav-text">4.9.1 clone实现复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-2-api-inherit-实现多态"><span class="nav-text">4.9.2 api.inherit 实现多态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-10-自定义字段"><span class="nav-text">4.10 自定义字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-11-跳过值为None的字段"><span class="nav-text">4.11 跳过值为None的字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-12跳过嵌套字段中的None字段"><span class="nav-text">4.12跳过嵌套字段中的None字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-13-使用JSON-Schema定义模型"><span class="nav-text">4.13 使用JSON Schema定义模型</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-请求解析"><span class="nav-text">5.请求解析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-基本参数"><span class="nav-text">5.1 基本参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-必须参数"><span class="nav-text">5.2 必须参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-多值和列表"><span class="nav-text">5.3 多值和列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-其他目标"><span class="nav-text">5.4 其他目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-参数位置"><span class="nav-text">5.5 参数位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-参数多位置"><span class="nav-text">5.6 参数多位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-高级类型处理"><span class="nav-text">5.7 高级类型处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8-解析器继承"><span class="nav-text">5.8 解析器继承</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-9-文件上传"><span class="nav-text">5.9 文件上传</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-10-错误处理"><span class="nav-text">5.10 错误处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-11-错误消息"><span class="nav-text">4.11 错误消息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-错误处理"><span class="nav-text">6.错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-http异常处理"><span class="nav-text">6.1 http异常处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-Flask错误助手"><span class="nav-text">6.2 Flask错误助手</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-Flask-RESTPlus错误助手"><span class="nav-text">6.3 Flask-RESTPlus错误助手</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-api-errorhandler装饰器"><span class="nav-text">6.4 @api.errorhandler装饰器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-字段掩码"><span class="nav-text">7.字段掩码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-语法"><span class="nav-text">7.1 语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-用法"><span class="nav-text">7.2 用法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-Swagger文档"><span class="nav-text">8. Swagger文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-api-doc-装饰器文档"><span class="nav-text">8.1 @api.doc()装饰器文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-自动文件模型"><span class="nav-text">8.2 自动文件模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-api-marshal-with-装饰器"><span class="nav-text">8.3@api.marshal_with()装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-api-expect-装饰器"><span class="nav-text">8.4 @api.expect()装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-api-response-装饰器文档"><span class="nav-text">8.5 @api.response()装饰器文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-api-route-装饰器"><span class="nav-text">8.6 @api.route()装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-7-fields参数"><span class="nav-text">8.7 fields参数</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-star"></i> </span><span class="author" itemprop="copyrightHolder">永夜初晗凝碧天</span><br></div><div><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">博客全站字数统计 </span><span title="博客全站字数统计">: 402.6k 字</span> <span class="post-meta-divider">||</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("03/01/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="博客已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分钟 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></div><div class="busuanzi-count"><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i> 本文总阅读量<span id="busuanzi_value_page_pv"></span>次 </span><span class="post-meta-divider">||</span> <span id="busuanzi_container_site_uv"><i class="fa fa-user"></i> 本站访客数<span id="busuanzi_value_site_uv"></span>人次 </span><span class="post-meta-divider">||</span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> 本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></div><div id="nowDate"><script type="text/javascript">window.onload=function(){function e(){var e=new Date,r=e.getFullYear(),u=e.getMonth()+1,a=e.getDate(),g=e.getDay(),i=e.getHours(),c=e.getMinutes(),d=e.getSeconds(),l="当前时间是："+r+"年"+u+"月"+a+"日 "+t(g)+" "+n(i)+":"+n(c)+":"+n(d);o.innerHTML=l}function t(e){return 0==e?"星期日":1==e?"星期一":2==e?"星期二":3==e?"星期三":4==e?"星期四":5==e?"星期五":"星期六"}function n(e){return e<10?"0"+e:e}var o=document.getElementById("nowDate");e(),setInterval(e,1e3)}</script></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/javascript" src="/js/src/love.js"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by neat -->