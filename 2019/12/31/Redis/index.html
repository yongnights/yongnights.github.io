<!-- build time:Tue Apr 14 2020 17:15:42 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Redis,"><link rel="alternate" href="/atom.xml" title="个人博客" type="application/atom+xml"><meta name="description" content="1. 简介1.1 nosql介绍NoSQL：一类新出现的数据库(not only sql)，特点如下：不支持SQL语法存储结构跟传统关系型数据库中的那种关系表完全不同，nosql中存储的数据都是KV形式NoSQL的世界中没有一种通用的语言，每种nosql数据库都有自己的api和语法，以及擅长的业务场景NoSQL中的产品种类相当多：MongodbRedisHbase hadoopCassandra"><meta name="keywords" content="Redis"><meta property="og:type" content="article"><meta property="og:title" content="Redis"><meta property="og:url" content="https://yongnights.github.io/2019/12/31/Redis/index.html"><meta property="og:site_name" content="个人博客"><meta property="og:description" content="1. 简介1.1 nosql介绍NoSQL：一类新出现的数据库(not only sql)，特点如下：不支持SQL语法存储结构跟传统关系型数据库中的那种关系表完全不同，nosql中存储的数据都是KV形式NoSQL的世界中没有一种通用的语言，每种nosql数据库都有自己的api和语法，以及擅长的业务场景NoSQL中的产品种类相当多：MongodbRedisHbase hadoopCassandra"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-12-31T04:00:48.259Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Redis"><meta name="twitter:description" content="1. 简介1.1 nosql介绍NoSQL：一类新出现的数据库(not only sql)，特点如下：不支持SQL语法存储结构跟传统关系型数据库中的那种关系表完全不同，nosql中存储的数据都是KV形式NoSQL的世界中没有一种通用的语言，每种nosql数据库都有自己的api和语法，以及擅长的业务场景NoSQL中的产品种类相当多：MongodbRedisHbase hadoopCassandra"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://yongnights.github.io/2019/12/31/Redis/"><title>Redis | 个人博客</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://your-url" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">个人博客</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">记录工作中的点点滴滴</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://yongnights.github.io/2019/12/31/Redis/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="永夜初晗凝碧天"><meta itemprop="description" content><meta itemprop="image" content="/img/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="个人博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Redis</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-31T12:00:48+08:00">2019-12-31 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2019-12-31T12:00:48+08:00">2019-12-31 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i>本文总阅读量 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次</span><div class="post-wordcount"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5.4k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">22 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><h2 id="1-1-nosql介绍"><a href="#1-1-nosql介绍" class="headerlink" title="1.1 nosql介绍"></a>1.1 nosql介绍</h2><p>NoSQL：一类新出现的数据库(not only sql)，特点如下：</p><ul><li>不支持SQL语法</li><li>存储结构跟传统关系型数据库中的那种关系表完全不同，nosql中存储的数据都是KV形式</li><li>NoSQL的世界中没有一种通用的语言，每种nosql数据库都有自己的api和语法，以及擅长的业务场景</li><li>NoSQL中的产品种类相当多：<ul><li>Mongodb</li><li>Redis</li><li>Hbase hadoop</li><li>Cassandra hadoop</li></ul></li></ul><h2 id="1-2-NoSQL和SQL数据库的比较"><a href="#1-2-NoSQL和SQL数据库的比较" class="headerlink" title="1.2 NoSQL和SQL数据库的比较"></a>1.2 NoSQL和SQL数据库的比较</h2><ul><li>适用场景不同：sql数据库适合用于关系特别复杂的数据查询场景，nosql反之</li><li>“事务”特性的支持：sql对事务的支持非常完善，而nosql基本不支持事务</li><li>两者在不断地取长补短，呈现融合趋势</li></ul><a id="more"></a><h2 id="1-3-Redis简介"><a href="#1-3-Redis简介" class="headerlink" title="1.3 Redis简介"></a>1.3 Redis简介</h2><ul><li>Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal赞助。</li><li>Redis是 NoSQL技术阵营中的一员，它通过多种键值数据类型来适应不同场景下的存储需求，借助一些高层级的接口使用其可以胜任，如缓存、队列系统的不同角色</li></ul><h2 id="1-4-Redis特性"><a href="#1-4-Redis特性" class="headerlink" title="1.4 Redis特性"></a>1.4 Redis特性</h2><ul><li>Redis 与其他 key - value 缓存产品有以下三个特点：</li><li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li><li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li><li>Redis支持数据的备份，即master-slave模式的数据备份。</li></ul><h2 id="1-5-Redis-优势"><a href="#1-5-Redis-优势" class="headerlink" title="1.5 Redis 优势"></a>1.5 Redis 优势</h2><ul><li>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</li><li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li><li>原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</li><li>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</li></ul><h2 id="1-6-Redis-应用场景"><a href="#1-6-Redis-应用场景" class="headerlink" title="1.6 Redis 应用场景"></a>1.6 Redis 应用场景</h2><ul><li>用来做缓存(ehcache/memcached)——redis的所有数据是放在内存中的（内存数据库）</li><li>可以在某些特定应用场景下替代传统数据库——比如社交类的应用</li><li>在一些大型系统中，巧妙地实现一些特定的功能：session共享、购物车</li><li>只要你有丰富的想象力，redis可以用在可以给你无限的惊喜…….</li></ul><h2 id="1-7-推荐阅读"><a href="#1-7-推荐阅读" class="headerlink" title="1.7 推荐阅读"></a>1.7 推荐阅读</h2><ul><li>[redis官方网站] <a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a></li><li>[redis中文官网] <a href="http://redis.cn/" target="_blank" rel="noopener">http://redis.cn/</a></li></ul><h1 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h1><h2 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1 下载"></a>2.1 下载</h2><p>Redis 版本号采用标准惯例：<strong>主版本号.副版本号.补丁级别</strong>,一个副版本号就标记为一个标准发行版本，例如 1.2，2.0，2.2，2.4，2.6，2.8，奇数的副版本号用来表示<strong>非标准</strong>版本,例如2.9.x，发行版本是Redis 3.0。最新稳定版本是5.0.4，下载链接：<a href="http://download.redis.io/releases/redis-5.0.4.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-5.0.4.tar.gz</a></p><ul><li><p>setp1：下载：wget <a href="http://download.redis.io/releases/redis-5.0.4.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-5.0.4.tar.gz</a></p></li><li><p>setp2：解压：tar -zxvf redis-5.0.4.tar.gz</p></li><li><p>setp3：进入到Redis目录： redis-5.0.4/</p></li><li><p>step4：生成：make</p></li><li><p>setp5：测试,这段运行时间会比较长：make test</p></li><li><p>step6：安装：make install</p></li><li><p>setp7：进入到默认安装目录下查看：cd /usr/local/bin &amp;&amp; ls -al</p><blockquote><ul><li>redis-server redis服务器</li><li>redis-cli redis命令行客户端</li><li>redis-benchmark redis性能测试工具</li><li>redis-check-aof AOF文件修复工具</li><li>redis-check-rdb RDB文件检索工具</li></ul></blockquote></li><li><p>setp8：配置文件，移动到/etc/目录下：cp redis-5.0.4/redis.conf /etc/redis/redis</p></li></ul><p>其他安装方式：<br>使用yum方式安装：yum -y install epel-release &amp;&amp; yum -y install redis (3.0.6版本)<br>使用yum安装最新版本，如下命令安装的是最新5.0.4版本<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y http://rpms.famillecollet.com/enterprise/remi-release-7.rpm</span><br><span class="line">yum --enablerepo=remi install redis</span><br></pre></td></tr></table></figure><p></p><p>yum安装的配置文件路径：/etc/redis.conf<br>安装路径：<code>ll /usr/bin/ | grep redis</code></p><h1 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h1><p>yum安装的配置文件路径：/etc/redis.conf</p><p>核心配置选项</p><ul><li><p>绑定ip：如果需要远程访问，可将此行注释，或绑定一个真实ip，默认是本机127.0.0.1</p><blockquote><p>bind 127.0.0.1</p></blockquote></li><li><p>端口：默认为6379</p><blockquote><p>port 6379</p></blockquote></li><li><p>是否以守护进程运行</p><ul><li>如果以守护进程运行，则不会在命令行阻塞，类似于服务</li><li>如果以非守护进程运行，则当前终端被阻塞</li><li>设置为yes表示守护进程，设置为no表示非守护进程</li><li>推荐设置为yes<blockquote><p>daemonize yes</p></blockquote></li></ul></li><li><p>数据文件</p><blockquote><p>dbfilename dump.rdb</p></blockquote></li><li><p>数据文件存储路径</p><blockquote><p>dir /var/lib/redis</p></blockquote></li><li><p>日志文件</p><blockquote><p>logfile /var/log/redis/redis-server.log</p></blockquote></li><li><p>数据库，默认有16个</p><blockquote><p>database 16</p></blockquote></li><li><p>主从复制，类似于双机备份。</p><blockquote><p>slaveof</p></blockquote></li></ul><h1 id="4-服务端和客户端"><a href="#4-服务端和客户端" class="headerlink" title="4. 服务端和客户端"></a>4. 服务端和客户端</h1><h2 id="4-1-服务器端"><a href="#4-1-服务器端" class="headerlink" title="4.1  服务器端"></a>4.1 服务器端</h2><ul><li>服务器端的命令为redis-server</li><li><p>可以使用help查看帮助文档</p><blockquote><p>redis-server –help</p></blockquote></li><li><p>推荐使用服务的方式管理redis服务<br><code>systemctl start|stop|restart|status redis.service</code></p></li><li><p>启动</p><blockquote><p>service redis start</p></blockquote></li><li><p>停止</p><blockquote><p>service redis stop</p></blockquote></li><li><p>重启</p><blockquote><p>service redis restart</p></blockquote></li><li><p>个人习惯</p><blockquote><p>ps -ef | grep redis 查看redis服务器进程<br>kill -9 pid 杀死redis服务器<br>redis-server /etc/redis/redis.conf 指定加载的配置文件</p></blockquote></li></ul><h2 id="4-2-客户端"><a href="#4-2-客户端" class="headerlink" title="4.2  客户端"></a>4.2 客户端</h2><ul><li>客户端的命令为redis-cli</li><li><p>可以使用help查看帮助文档</p><blockquote><p>redis-server –help</p></blockquote></li><li><p>连接redis</p><blockquote><p>redis-cli</p></blockquote></li><li><p>测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># redis-cli </span></span><br><span class="line">127.0.0.1:6379&gt; ping 123</span><br><span class="line"><span class="string">"123"</span></span><br></pre></td></tr></table></figure></li><li><p>切换数据库<br>数据库没有名称，默认有16个，通过0-15来标识，连接redis默认选择第一个数据库select n</p><blockquote><p>select n</p></blockquote></li></ul><h1 id="5-数据操作"><a href="#5-数据操作" class="headerlink" title="5. 数据操作"></a>5. 数据操作</h1><h2 id="5-1-数据结构"><a href="#5-1-数据结构" class="headerlink" title="5.1 数据结构"></a>5.1 数据结构</h2><ul><li>redis是key-value的数据结构，每条数据都是一个键值对</li><li>键的类型是字符串，且不能重复</li><li>值的类型分为五种：<ul><li>字符串string</li><li>哈希hash</li><li>列表list</li><li>集合set</li><li>有序集合zset</li></ul></li></ul><h2 id="5-2-数据操作行为"><a href="#5-2-数据操作行为" class="headerlink" title="5.2 数据操作行为"></a>5.2 数据操作行为</h2><ul><li>保存</li><li>修改</li><li>获取</li><li>删除</li></ul><p>[中文官网命令文档]：<a href="http://redis.cn/commands.html" target="_blank" rel="noopener">http://redis.cn/commands.html</a></p><h2 id="5-3-String类型"><a href="#5-3-String类型" class="headerlink" title="5.3 String类型"></a>5.3 String类型</h2><p>字符串类型是Redis中最为基础的数据存储类型，它在Redis中是二进制安全的，这便意味着该类型可以接受任何格式的数据，如JPEG图像数据或Json对象描述信息等。<br>在Redis中字符串类型的Value最多可以容纳的数据长度是512M。</p><h3 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h3><p>如果设置的键不存在则为添加，如果设置的键已经存在则修改</p><ul><li>设置键值：set key value</li><li>设置键值及过期时间，以秒为单位：setex key seconds value</li><li>设置多个键值：mset key1 value1 key2 value2 …</li><li>追加值：append key value</li></ul><h3 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h3><ul><li>获取：根据键获取值，如果不存在此键则返回nil：get key</li><li>根据多个键获取多个值 ：mget key1 key2…</li></ul><h3 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h3><ul><li><p>查找键，参数支持正则表达式：keys pattern<br>例如：</p><ul><li>查看所有键：<code>keys *</code></li><li>查看名称中含有a的键：<code>keys &#39;a*&#39;</code></li></ul></li><li><p>判断键是否存在，存在返回1，不存在返回0：exists key</p></li><li>查看键对应的value的类型：type key</li><li>删除键及其对应的值：del key1 key2…….</li><li>设置过期时间，以秒为单位，如果没有指定过期时间则一直存在，直到使用DEL移除：expire key seconds</li><li>查看有效时间，以秒为单位：ttl key</li></ul><h2 id="5-4-hash类型"><a href="#5-4-hash类型" class="headerlink" title="5.4 hash类型"></a>5.4 hash类型</h2><ul><li>hash用于存储对象，对象的结构为属性、值</li><li>值的类型为string</li></ul><h3 id="增加、删除"><a href="#增加、删除" class="headerlink" title="增加、删除"></a>增加、删除</h3><ul><li>设置单个属性：hset key filed value</li></ul><p>例如：设置键 user的属性name为itheima：hset user name hahah<br>错误信息：<br>MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. Please check Redis logs for details about the error.<br>Redis被配置为保存数据库快照，但它目前不能持久化到硬盘。用来修改集合数据的命令不能用</p><p>原因：</p><ul><li><p>强制关闭Redis快照导致不能持久化。<br>解决方案：<br>运行<code>config set stop-writes-on-bgsave-error no</code>命令后，关闭配置项stop-writes-on-bgsave-error解决该问题</p></li><li><p>设置多个属性：hmset key field1 value1 field2 value2 …</p></li></ul><p>例如： 设置键u2的属性name为haha、属性age为22：hset user name hahah age 22</p><h3 id="获取-1"><a href="#获取-1" class="headerlink" title="获取"></a>获取</h3><ul><li>获取指定键所有的属性：hkeys key</li><li>获取一个属性的值：hget key field</li><li>获取多个属性的值：hmget key field1 field2 …</li><li>获取所有属性的值：hvals key</li></ul><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul><li>删除整个hash键及值，使用del命令</li><li>删除属性，属性对应的值会被一起删除：hdel key field1 field2 …</li></ul><h2 id="5-5-list类型"><a href="#5-5-list类型" class="headerlink" title="5.5 list类型"></a>5.5 list类型</h2><ul><li>列表的元素类型为string</li><li>按照插入顺序排序</li></ul><h3 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h3><ul><li>在左侧插入数据：lpush key value1 value2 …</li><li>在右侧插入数据：rpush key value1 value2 …</li><li>在指定元素的前或后插入新元素：linsert key before或after 现有元素 新元素</li></ul><h3 id="获取-2"><a href="#获取-2" class="headerlink" title="获取"></a>获取</h3><ul><li><p>返回列表里指定范围内的元素：lrange key start stop</p><blockquote><p>start、stop为元素的下标索引,引从左侧开始，第一个元素为0，索引可以是负数，表示从尾部开始计数，如-1表示最后⼀个元素</p></blockquote></li><li><p>设置指定索引位置的元素值：lset key index value</p><blockquote><p>索引从左侧开始，第一个元素为0，索引可以是负数，表示尾部开始计数，如-1表示最后一个元素</p></blockquote></li></ul><h3 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h3><ul><li>删除指定元素：lrem key count value<blockquote><p>将列表中前count次出现的值为value的元素移除，count &gt; 0: 从头往尾移除，count &lt; 0: 从尾往头移除，count = 0: 移除所有</p></blockquote></li></ul><h2 id="5-6-set类型"><a href="#5-6-set类型" class="headerlink" title="5.6 set类型"></a>5.6 set类型</h2><ul><li>无序集合</li><li>元素为string类型</li><li>元素具有唯一性，不重复</li><li>对于集合没有修改操作</li></ul><h3 id="增加-1"><a href="#增加-1" class="headerlink" title="增加"></a>增加</h3><ul><li>添加元素：sadd key member1 member2 …</li></ul><h3 id="获取-3"><a href="#获取-3" class="headerlink" title="获取"></a>获取</h3><ul><li>返回所有的元素：smembers key</li></ul><h3 id="删除-2"><a href="#删除-2" class="headerlink" title="删除"></a>删除</h3><ul><li>删除指定元素：srem key</li><li>删除指定元素中的某一个值：srem key member1</li></ul><h2 id="5-7-zset类型"><a href="#5-7-zset类型" class="headerlink" title="5.7 zset类型"></a>5.7 zset类型</h2><ul><li>sorted set，有序集合</li><li>元素为string类型</li><li>元素具有唯一性，不重复</li><li>每个元素都会关联一个double类型的score，表示权重，通过权重将元素从小到大排序</li><li>没有修改操作</li></ul><h3 id="增加-2"><a href="#增加-2" class="headerlink" title="增加"></a>增加</h3><ul><li>添加：zadd key score1 member1 score2 member2 …</li></ul><p>例如： 向键’a4’的集合中添加元素’lisi’、’wangwu’、’zhaoliu’、’zhangsan’，权重分别为4、5、6、3<br><code>zadd a4 4 lisi 5 wangwu 6 zhaoliu 3 zhangsan</code></p><h3 id="获取-4"><a href="#获取-4" class="headerlink" title="获取"></a>获取</h3><ul><li><p>返回指定范围内的元素：zrange key start stop</p><blockquote><p>start、stop为元素的下标索引， 索引从左侧开始，第一个元素为0，索引可以是负数，表示从尾部开始计数，如-1表示最后一个元素</p></blockquote></li><li><p>返回score值在min和max之间的成员：zrangebyscore key min max</p></li><li>返回成员member的score值：zscore key member</li></ul><h3 id="删除-3"><a href="#删除-3" class="headerlink" title="删除"></a>删除</h3><ul><li>删除指定元素：zrem key member1 member2 …</li><li>删除权重在指定范围的元素：zremrangebyscore key min max</li></ul><h1 id="6-与Python交互"><a href="#6-与Python交互" class="headerlink" title="6. 与Python交互"></a>6. 与Python交互</h1><ul><li>python环境中安装redis模块：pip install redis</li><li>调用模块：from redis import *<br>这个模块中提供了StrictRedis对象(Strict严格)，用于连接redis服务器，并按照不同类型提供 了不同放法，进行交互操作</li></ul><h2 id="6-1-StrictRedis对象方法"><a href="#6-1-StrictRedis对象方法" class="headerlink" title="6.1 StrictRedis对象方法"></a>6.1 StrictRedis对象方法</h2><ul><li>通过init创建对象，指定参数host、port与指定的服务器和端⼝连接，host默认为localhost，port默认为6379，db默认为0<br><code>sr = StrictRedis(host=&#39;localhost&#39;, port=6379, db=0)</code><br>简写：sr=StrictRedis()</li></ul><p>根据不同的类型，拥有不同的实例方法可以调用，与前面学的redis命令对应，方法需要的参数与命令的参数一致。</p><h3 id="6-1-2-string"><a href="#6-1-2-string" class="headerlink" title="6.1.2 string"></a>6.1.2 string</h3><ul><li>set</li><li>setex</li><li>mset</li><li>append</li><li>get</li><li>mget</li><li>key</li></ul><h3 id="6-1-3-keys"><a href="#6-1-3-keys" class="headerlink" title="6.1.3 keys"></a>6.1.3 keys</h3><ul><li>exists</li><li>type</li><li>delete</li><li>expire</li><li>getrange</li><li>ttl</li></ul><h3 id="6-1-4-hash"><a href="#6-1-4-hash" class="headerlink" title="6.1.4 hash"></a>6.1.4 hash</h3><ul><li>hset</li><li>hmset</li><li>hkeys</li><li>hget</li><li>hmget</li><li>hvals</li><li>hdel</li></ul><h3 id="6-1-5-list"><a href="#6-1-5-list" class="headerlink" title="6.1.5 list"></a>6.1.5 list</h3><ul><li>lpush</li><li>rpush</li><li>linsert</li><li>lrange</li><li>lset</li><li>lrem</li></ul><h3 id="6-1-6-set"><a href="#6-1-6-set" class="headerlink" title="6.1.6 set"></a>6.1.6 set</h3><ul><li>sadd</li><li>smembers</li><li>srem</li></ul><h3 id="6-1-7-zset"><a href="#6-1-7-zset" class="headerlink" title="6.1.7 zset"></a>6.1.7 zset</h3><ul><li>zadd</li><li>zrange</li><li>zrangebyscore</li><li>zscore</li><li>zrem</li><li>zremrangebyscore</li></ul><h2 id="6-2-StrictRedis对象操作string类型"><a href="#6-2-StrictRedis对象操作string类型" class="headerlink" title="6.2 StrictRedis对象操作string类型"></a>6.2 StrictRedis对象操作string类型</h2><h3 id="6-2-1-准备"><a href="#6-2-1-准备" class="headerlink" title="6.2.1 准备"></a>6.2.1 准备</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建StrictRedis对象，与redis服务器建⽴连接</span></span><br><span class="line">        sr = redis.StrictRedis(host=<span class="string">'192.168.0.138'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="literal">None</span>)</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><h3 id="6-2-2-string-增加"><a href="#6-2-2-string-增加" class="headerlink" title="6.2.2 string-增加"></a>6.2.2 string-增加</h3><p>方法set，添加键、值，如果添加成功则返回True，如果添加失败则返回False<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建StrictRedis对象，与redis服务器建⽴连接</span></span><br><span class="line">        sr = redis.StrictRedis(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'foobar2000'</span>)</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line">        <span class="comment"># 添加键name，值为haha</span></span><br><span class="line">        result = sr.set(<span class="string">'name'</span>,<span class="string">'haha1111'</span>)</span><br><span class="line">        <span class="comment"># 输出响应结果，如果添加成功则返回True，否则返回False</span></span><br><span class="line">        print(result)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><p></p><h3 id="6-2-3-string-获取"><a href="#6-2-3-string-获取" class="headerlink" title="6.2.3 string-获取"></a>6.2.3 string-获取</h3><p>方法get，添加键对应的值，如果键存在则返回对应的值，如果键不存在则返回None<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建StrictRedis对象，与redis服务器建⽴连接</span></span><br><span class="line">        sr = redis.StrictRedis(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'foobar2000'</span>)</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line">        <span class="comment">#获取键name的值</span></span><br><span class="line">        result = sr.get(<span class="string">'name'</span>)</span><br><span class="line">        <span class="comment">#输出键的值，如果键不存在则返回None</span></span><br><span class="line">        print(result) <span class="comment"># b'haha1111'，类型是&lt;class 'bytes'&gt;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><p></p><h3 id="6-2-4-string-修改"><a href="#6-2-4-string-修改" class="headerlink" title="6.2.4 string-修改"></a>6.2.4 string-修改</h3><p>方法set，如果键已经存在则进行修改，如果键不存在则进行添加<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建StrictRedis对象，与redis服务器建⽴连接</span></span><br><span class="line">        sr = redis.StrictRedis(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'foobar2000'</span>)</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line">        <span class="comment">#获取键name的值</span></span><br><span class="line">        result = sr.set(<span class="string">'name'</span>,<span class="string">'hahahahhhahahh'</span>)</span><br><span class="line">        <span class="comment">#输出响应结果，如果操作成功则返回True，否则返回False</span></span><br><span class="line">        print(result)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><p></p><h3 id="6-2-5-string-删除"><a href="#6-2-5-string-删除" class="headerlink" title="6.2.5 string-删除"></a>6.2.5 string-删除</h3><p>方法delete，删除键及对应的值，如果删除成功则返回受影响的键数，否则则返 回0<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建StrictRedis对象，与redis服务器建⽴连接</span></span><br><span class="line">        sr = redis.StrictRedis(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'foobar2000'</span>)</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line">        <span class="comment">#获取键name的值</span></span><br><span class="line">        result = sr.delete(<span class="string">'name'</span>)</span><br><span class="line">        <span class="comment">#输出响应结果，如果删除成功则返回受影响的键数，否则则返回0</span></span><br><span class="line">        print(result)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><p></p><h3 id="6-2-6-获取键"><a href="#6-2-6-获取键" class="headerlink" title="6.2.6 获取键"></a>6.2.6 获取键</h3><p>方法keys，根据正则表达式获取键<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建StrictRedis对象，与redis服务器建⽴连接</span></span><br><span class="line">        sr = redis.StrictRedis(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'foobar2000'</span>)</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line">        <span class="comment">#获取键name的值</span></span><br><span class="line">        result = sr.keys()</span><br><span class="line">        <span class="comment">#输出响应结果，所有的键构成⼀个列表，如果没有键则返回空列表</span></span><br><span class="line">        print(result)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><p></p><h1 id="7-主从配置-读写分离"><a href="#7-主从配置-读写分离" class="headerlink" title="7. 主从配置(读写分离)"></a>7. 主从配置(读写分离)</h1><ul><li>一个master可以拥有多个slave，一个slave上可以拥有多个slave，如此下去，形成了强大的多级服务器集群架构</li><li>master用来写数据，slave用来读数据，经统计：网站的读写比率是10:1</li><li>通过主从配置可以实现读写分离</li><li>master和slave都是一个redis实例(redis服务)</li></ul><p>说明：如下的实例是主从在一台服务器上，通过端口号进行区分</p><h2 id="7-1-主从配置"><a href="#7-1-主从配置" class="headerlink" title="7.1 主从配置"></a>7.1 主从配置</h2><h3 id="7-1-1-配置主"><a href="#7-1-1-配置主" class="headerlink" title="7.1.1 配置主"></a>7.1.1 配置主</h3><ul><li>查看当前主机的ip地址：ifconfig</li><li><p>修改/etc/redis.conf文件</p><blockquote><p>bind 192.168.26.128 # 绑定主服务器IP</p></blockquote></li><li><p>重启redis服务：<code>service redis stop &amp;&amp; redis-server redis.conf</code></p></li></ul><h3 id="7-1-2-配置从"><a href="#7-1-2-配置从" class="headerlink" title="7.1.2 配置从"></a>7.1.2 配置从</h3><ul><li>设置slave.conf文件：cp redis.conf slave.conf</li><li><p>修改slave.conf文件</p><blockquote><p>bind 192.168.26.128 # 从服务器IP，因使用一台主机，所以IP同主服务器IP相同<br>port 6378 # 从服务器端口<br>slaveof 192.168.26.128 6379 # 关联到主信息</p></blockquote></li><li><p>启动redis服务：<code>redis-server slave.conf</code></p></li><li><p>查看主从关系：redis-cli -h 192.168.26.128 info Replication</p></li></ul><h3 id="7-1-2-数据操作"><a href="#7-1-2-数据操作" class="headerlink" title="7.1.2 数据操作"></a>7.1.2 数据操作</h3><ul><li><p>在master和slave分别执行info命令，查看输出信息 进入主客户端</p><blockquote><p>redis-cli -h 192.168.26.128 -p 6379 # 进入主客户端<br>redis-cli -h 192.168.26.128 -p 6378 # 进入从客户端</p></blockquote></li><li><p>在master上写数据：set aa aa</p></li><li>在slave上读数据：get aa</li></ul><h1 id="8-哨兵-主从切换"><a href="#8-哨兵-主从切换" class="headerlink" title="8. 哨兵(主从切换)"></a>8. 哨兵(主从切换)</h1><p>待完善……</p><h1 id="9-搭建集群"><a href="#9-搭建集群" class="headerlink" title="9. 搭建集群"></a>9. 搭建集群</h1><h2 id="9-1-为什么要有集群"><a href="#9-1-为什么要有集群" class="headerlink" title="9.1 为什么要有集群"></a>9.1 为什么要有集群</h2><ul><li>一主可以多从，如果同时的访问量过大(1000w),主服务肯定就会挂掉，数据服务就挂掉了或者发生自然灾难</li><li>大公司都会有很多的服务器(华东地区、华南地区、华中地区、华北地区、西北地区、西南地区、东北地区、台港澳地区机房)</li></ul><h2 id="9-2-集群的概念"><a href="#9-2-集群的概念" class="headerlink" title="9.2 集群的概念"></a>9.2 集群的概念</h2><ul><li>集群是一组相互独立的、通过高速网络互联的计算机，它们构成了一个组，并以单一系统的模式加以管理。一个客户与集群相互作用时，集群像是一个独立的服务器。集群配置是用于提高可用性和可缩放性。</li><li>当请求到来首先由负载均衡服务器处理，把请求转发到另外的一台服务器上。</li></ul><h2 id="9-3-redis集群"><a href="#9-3-redis集群" class="headerlink" title="9.3 redis集群"></a>9.3 redis集群</h2><ul><li>分类<ul><li>软件层面：只有一台电脑，在这一台电脑上启动了多个redis服务</li><li>硬件层面：存在多台实体的电脑，每台电脑上都启动了一个redis或者多个redis服务</li></ul></li></ul><h2 id="9-4-搭建集群"><a href="#9-4-搭建集群" class="headerlink" title="9.4 搭建集群"></a>9.4 搭建集群</h2><ul><li>当前拥有两台主机172.16.179.130、172.16.179.131，这里的IP在使用时要改为实际值</li></ul><h3 id="9-4-1-配置机器1"><a href="#9-4-1-配置机器1" class="headerlink" title="9.4.1 配置机器1"></a>9.4.1 配置机器1</h3><ul><li>在演示中，172.16.179.130为当前ubuntu机器的ip</li><li>在172.16.179.130上进入Desktop目录，创建conf目录</li><li><p>在conf目录下创建文件7000.conf，编辑内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port 7000</span><br><span class="line"><span class="built_in">bind</span> 172.16.179.130</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile 7000.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file 7000_node.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li><li><p>在conf目录下创建文件7001.conf，编辑内容如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port <span class="number">7001</span></span><br><span class="line">bind <span class="number">172.16</span><span class="number">.179</span><span class="number">.130</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile <span class="number">7001.</span>pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file <span class="number">7001</span>_node.conf</span><br><span class="line">cluster-node-timeout <span class="number">15000</span></span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li><li><p>在conf目录下创建文件7001.conf，编辑内容如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port <span class="number">7001</span></span><br><span class="line">bind <span class="number">172.16</span><span class="number">.179</span><span class="number">.130</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile <span class="number">7001.</span>pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file <span class="number">7001</span>_node.conf</span><br><span class="line">cluster-node-timeout <span class="number">15000</span></span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li><li><p>在conf目录下创建文件7002.conf，编辑内容如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port <span class="number">7002</span></span><br><span class="line">bind <span class="number">172.16</span><span class="number">.179</span><span class="number">.130</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile <span class="number">7002.</span>pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file <span class="number">7002</span>_node.conf</span><br><span class="line">cluster-node-timeout <span class="number">15000</span></span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li></ul><p>总结：三个文件的配置区别在port、pidfile、cluster-config-file三项</p><ul><li>使用配置文件启动redis服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server 7000.conf</span><br><span class="line">redis-server 7001.conf</span><br><span class="line">redis-server 7002.conf</span><br></pre></td></tr></table></figure></li></ul><h3 id="9-4-2-配置机器2"><a href="#9-4-2-配置机器2" class="headerlink" title="9.4.2 配置机器2"></a>9.4.2 配置机器2</h3><ul><li>在演示中，172.16.179.131为当前ubuntu机器的ip</li><li>在172.16.179.131上进入Desktop目录，创建conf目录</li><li><p>在conf目录下创建文件7003.conf，编辑内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port 7003</span><br><span class="line"><span class="built_in">bind</span> 172.16.179.131</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile 7003.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file 7003_node.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li><li><p>在conf目录下创建文件7004.conf，编辑内容如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port <span class="number">7004</span></span><br><span class="line">bind <span class="number">172.16</span><span class="number">.179</span><span class="number">.131</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile <span class="number">7004.</span>pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file <span class="number">7004</span>_node.conf</span><br><span class="line">cluster-node-timeout <span class="number">15000</span></span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li><li><p>在conf目录下创建文件7005.conf，编辑内容如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port <span class="number">7005</span></span><br><span class="line">bind <span class="number">172.16</span><span class="number">.179</span><span class="number">.131</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile <span class="number">7005.</span>pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file <span class="number">7005</span>_node.conf</span><br><span class="line">cluster-node-timeout <span class="number">15000</span></span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></li></ul><p>总结：三个文件的配置区别在port、pidfile、cluster-config-file三项</p><ul><li>使用配置文件启动redis服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server 7003.conf</span><br><span class="line">redis-server 7004.conf</span><br><span class="line">redis-server 7005.conf</span><br></pre></td></tr></table></figure></li></ul><h3 id="9-4-3-创建集群"><a href="#9-4-3-创建集群" class="headerlink" title="9.4.3 创建集群"></a>9.4.3 创建集群</h3><ul><li>redis的安装包中包含了redis-trib.rb，用于创建集群，</li><li>接下来的操作在172.16.179.130机器上进行</li><li>将命令复制，这样可以在任何目录下调用此命令<br><code>cp /usr/share/doc/redis-tools/examples/redis-trib.rb /usr/local/bin/</code></li><li>安装ruby环境，因为redis-trib.rb是用ruby开发的：<code>apt-get install ruby</code></li><li>运行如下命令创建集群：<br><code>redis-trib.rb create --replicas 1 172.16.179.130:7000 172.16.179.130:7001 172.16.179.130:7002 172.16.179.131:7003 172.16.179.131:7004 172.16.179.131:7005</code></li><li>执行上面这个指令在某些机器上可能会报错,主要原因是由于安装的 ruby 不是最 新版本</li><li>天朝的防火墙导致无法下载最新版本,所以需要设置 gem 的源</li><li>解决办法如下：<blockquote><p>– 先查看自己的 gem 源是什么地址：gem source -l – 如果是<a href="https://rubygems.org/" target="_blank" rel="noopener">https://rubygems.org/</a> 就需要更换<br>– 更换指令为：gem sources –add <a href="https://gems.ruby-china.org/" target="_blank" rel="noopener">https://gems.ruby-china.org/</a> –remove <a href="https://rubygems.org/" target="_blank" rel="noopener">https://rubygems.org/</a><br>– 通过 gem 安装 redis 的相关依赖：sudo gem install redis<br>– 然后重新执行指令</p></blockquote></li></ul><h3 id="9-4-4-数据验证"><a href="#9-4-4-数据验证" class="headerlink" title="9.4.4 数据验证"></a>9.4.4 数据验证</h3><ul><li><p>当前搭建的主服务器为7000、7001、7003，对应的从服务器是7004、7005、7002，在172.16.179.131机器上连接7002，加参数-c表示连接到集群</p><blockquote><p>redis-cli -h 172.16.179.131 -c -p 7002</p></blockquote></li><li><p>写入数据： set name haha</p></li><li>自动跳到了7003服务器，并写入数据成功</li><li>在7003可以获取数据，如果写入数据又重定向到7000(负载均衡)</li></ul><h3 id="9-4-5-在哪个服务器上写数据：CRC16"><a href="#9-4-5-在哪个服务器上写数据：CRC16" class="headerlink" title="9.4.5 在哪个服务器上写数据：CRC16"></a>9.4.5 在哪个服务器上写数据：CRC16</h3><ul><li>redis cluster在设计的时候，就考虑到了去中间化，去中间件，也就是说，集群中 的每个节点都是平等的关系，都是对等的，每个节点都保存各自的数据和整个集群的状态。每个节点都和其他所有节点连接，并且这些连接保持活跃，这样就保证了我们只需要连接集群中的任意一个节点，就可以获取到其他节点的数据</li><li>Redis集群没有并使用传统的一致性哈希来分配数据，而是采用另外一种叫做哈希槽 (hash slot)的方式来分配的。redis cluster 默认分配了 16384 个slot，当我们 set一个key 时，会用CRC16算法来取模得到所属的slot，然后将这个key 分到哈希槽区间的节点上，具体算法就是：CRC16(key) % 16384。所以我们在测试的 时候看到set 和 get 的时候，直接跳转到了7000端口的节点</li><li>Redis 集群会把数据存在一个 master 节点，然后在这个 master 和其对应的salve 之间进行数据同步。当读取数据时，也根据一致性哈希算法到对应的 master 节 点获取数据。只有当一个master 挂掉之后，才会启动一个对应的 salve 节点，充当 master</li><li>需要注意的是：必须要3个或以上的主节点，否则在创建集群时会失败，并且当存 活的主节点数小于总节点数的一半时，整个集群就无法提供服务了</li></ul><h2 id="9-5-Python交互"><a href="#9-5-Python交互" class="headerlink" title="9.5 Python交互"></a>9.5 Python交互</h2><ul><li>安装包：<code>pip install redis-py-cluster</code></li><li>redis-py-cluster源码地址<a href="https://github.com/Grokzen/redis-py-cluster" target="_blank" rel="noopener">https://github.com/Grokzen/redis-py-cluster</a></li><li>创建文件redis_cluster.py，示例码如下<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rediscluster <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">      <span class="comment"># 构建所有的节点，Redis会使⽤CRC16算法，将键和值写到某个节点上</span></span><br><span class="line">      startup_nodes = [</span><br><span class="line">          &#123;<span class="string">'host'</span>: <span class="string">'192.168.26.128'</span>, <span class="string">'port'</span>: <span class="string">'7000'</span>&#125;,</span><br><span class="line">          &#123;<span class="string">'host'</span>: <span class="string">'192.168.26.130'</span>, <span class="string">'port'</span>: <span class="string">'7003'</span>&#125;,</span><br><span class="line">          &#123;<span class="string">'host'</span>: <span class="string">'192.168.26.128'</span>, <span class="string">'port'</span>: <span class="string">'7001'</span>&#125;,</span><br><span class="line">      ]</span><br><span class="line">      <span class="comment"># 构建StrictRedisCluster对象</span></span><br><span class="line">      src=StrictRedisCluster(startup_nodes=startup_nodes,decode_responses=<span class="literal">True</span>)</span><br><span class="line">      <span class="comment"># 设置键为name、值为itheima的数据</span></span><br><span class="line">      result=src.set(<span class="string">'name'</span>,<span class="string">'itheima'</span>)</span><br><span class="line">      print(result)</span><br><span class="line">      <span class="comment"># 获取键为name</span></span><br><span class="line">      name = src.get(<span class="string">'name'</span>)</span><br><span class="line">      print(name)</span><br><span class="line">  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">      print(e)</span><br></pre></td></tr></table></figure></li></ul></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束 <i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>如果觉得我的文章对您有用,请随意打赏.您的支持将鼓励我继续创作!</div><br><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/img/wechat.jpg" alt="永夜初晗凝碧天 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/img/alipay.jpg" alt="永夜初晗凝碧天 支付宝"><p>支付宝</p></div></div></div></div><div><div class="post-copyright"><li class="post-copyright-title"><strong>本文标题：</strong> Redis</li><li class="post-copyright-author"><strong>文章作者：</strong> 永夜初晗凝碧天</li><li class="post-copyright-author"><strong>发布时间：</strong> 2019年12月31日 - 12:12:25</li><li class="post-copyright-author"><strong>更新时间：</strong> 2019年12月31日 - 12:12:25</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="/2019/12/31/Redis/" title="Redis">https://yongnights.github.io/2019/12/31/Redis/</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://yongnights.github.io/2019/12/31/Redis/" aria-label="复制成功！"></i></span></li><li class="post-copyright-license"><strong>版权声明： </strong><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</li></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Redis/" rel="tag"><i class="fa fa-tag"></i> Redis</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/12/31/Python小知识/" rel="next" title="Python小知识"><i class="fa fa-chevron-left"></i> Python小知识</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/12/31/SecureFX连接Linux后文件夹中文乱码问题解决/" rel="prev" title="SecureFX连接Linux后文件夹中文乱码问题解决">SecureFX连接Linux后文件夹中文乱码问题解决 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/img/avatar.png" alt="永夜初晗凝碧天"><p class="site-author-name" itemprop="name">永夜初晗凝碧天</p><p class="site-description motion-element" itemprop="description">Linux,Python,MySQL,ELK Stack,K8S,Docker</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">134</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">52</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">58</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="tencent://message/?Menu=yes&uin=1103324414" target="_blank" title="QQ"><i class="fa fa-fw fa-qq"></i>QQ</a> </span><span class="links-of-author-item"><a href="mailto:sandu12345@msn.cn" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1333220817&auto=0&height=66"></iframe><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.cnblogs.com/sanduzxcvbnm/" title="博客园" target="_blank">博客园</a></li><li class="links-of-blogroll-item"><a href="https://www.baidu.com/" title="百度" target="_blank">百度</a></li></ul></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li><a href="/2020/04/14/EFK-5：ES集群开启用户认证 /" title="EFK-5 ES集群开启用户认证" target="_blank">EFK-5 ES集群开启用户认证</a></li><li><a href="/2020/04/14/EFK-4：ElasticSearch集群TLS加密通讯 /" title="EFK-4 ElasticSearch集群TLS加密通讯" target="_blank">EFK-4 ElasticSearch集群TLS加密通讯</a></li><li><a href="/2020/04/14/EFK-3： ES多实例部署 /" title="EFK-3 ES多实例部署" target="_blank">EFK-3 ES多实例部署</a></li><li><a href="/2020/04/14/EFK-2：ElasticSearch高性能高可用架构/" title="EFK-2 ElasticSearch高性能高可用架构" target="_blank">EFK-2 ElasticSearch高性能高可用架构</a></li><li><a href="/2020/04/14/EFK-1：快速指南/" title="EFK-1 快速指南" target="_blank">EFK-1 快速指南</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-简介"><span class="nav-text">1. 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-nosql介绍"><span class="nav-text">1.1 nosql介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-NoSQL和SQL数据库的比较"><span class="nav-text">1.2 NoSQL和SQL数据库的比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-Redis简介"><span class="nav-text">1.3 Redis简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-Redis特性"><span class="nav-text">1.4 Redis特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-Redis-优势"><span class="nav-text">1.5 Redis 优势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-Redis-应用场景"><span class="nav-text">1.6 Redis 应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-7-推荐阅读"><span class="nav-text">1.7 推荐阅读</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-安装"><span class="nav-text">2. 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-下载"><span class="nav-text">2.1 下载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-配置"><span class="nav-text">3. 配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-服务端和客户端"><span class="nav-text">4. 服务端和客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-服务器端"><span class="nav-text">4.1 服务器端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-客户端"><span class="nav-text">4.2 客户端</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-数据操作"><span class="nav-text">5. 数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-数据结构"><span class="nav-text">5.1 数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-数据操作行为"><span class="nav-text">5.2 数据操作行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-String类型"><span class="nav-text">5.3 String类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#保存"><span class="nav-text">保存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取"><span class="nav-text">获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他常用命令"><span class="nav-text">其他常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-hash类型"><span class="nav-text">5.4 hash类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加、删除"><span class="nav-text">增加、删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-1"><span class="nav-text">获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除"><span class="nav-text">删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-list类型"><span class="nav-text">5.5 list类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加"><span class="nav-text">增加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-2"><span class="nav-text">获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除-1"><span class="nav-text">删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-set类型"><span class="nav-text">5.6 set类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加-1"><span class="nav-text">增加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-3"><span class="nav-text">获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除-2"><span class="nav-text">删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-zset类型"><span class="nav-text">5.7 zset类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加-2"><span class="nav-text">增加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-4"><span class="nav-text">获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除-3"><span class="nav-text">删除</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-与Python交互"><span class="nav-text">6. 与Python交互</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-StrictRedis对象方法"><span class="nav-text">6.1 StrictRedis对象方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-string"><span class="nav-text">6.1.2 string</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-3-keys"><span class="nav-text">6.1.3 keys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-4-hash"><span class="nav-text">6.1.4 hash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-5-list"><span class="nav-text">6.1.5 list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-6-set"><span class="nav-text">6.1.6 set</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-7-zset"><span class="nav-text">6.1.7 zset</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-StrictRedis对象操作string类型"><span class="nav-text">6.2 StrictRedis对象操作string类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1-准备"><span class="nav-text">6.2.1 准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-string-增加"><span class="nav-text">6.2.2 string-增加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-3-string-获取"><span class="nav-text">6.2.3 string-获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-4-string-修改"><span class="nav-text">6.2.4 string-修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-5-string-删除"><span class="nav-text">6.2.5 string-删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-6-获取键"><span class="nav-text">6.2.6 获取键</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-主从配置-读写分离"><span class="nav-text">7. 主从配置(读写分离)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-主从配置"><span class="nav-text">7.1 主从配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-1-配置主"><span class="nav-text">7.1.1 配置主</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-2-配置从"><span class="nav-text">7.1.2 配置从</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-2-数据操作"><span class="nav-text">7.1.2 数据操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-哨兵-主从切换"><span class="nav-text">8. 哨兵(主从切换)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-搭建集群"><span class="nav-text">9. 搭建集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-为什么要有集群"><span class="nav-text">9.1 为什么要有集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-集群的概念"><span class="nav-text">9.2 集群的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-redis集群"><span class="nav-text">9.3 redis集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-搭建集群"><span class="nav-text">9.4 搭建集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-1-配置机器1"><span class="nav-text">9.4.1 配置机器1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-2-配置机器2"><span class="nav-text">9.4.2 配置机器2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-3-创建集群"><span class="nav-text">9.4.3 创建集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-4-数据验证"><span class="nav-text">9.4.4 数据验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-5-在哪个服务器上写数据：CRC16"><span class="nav-text">9.4.5 在哪个服务器上写数据：CRC16</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-Python交互"><span class="nav-text">9.5 Python交互</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-star"></i> </span><span class="author" itemprop="copyrightHolder">永夜初晗凝碧天</span><br></div><div><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">博客全站字数统计 </span><span title="博客全站字数统计">: 399.2k 字</span> <span class="post-meta-divider">||</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("03/01/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="博客已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分钟 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></div><div class="busuanzi-count"><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i> 本文总阅读量<span id="busuanzi_value_page_pv"></span>次 </span><span class="post-meta-divider">||</span> <span id="busuanzi_container_site_uv"><i class="fa fa-user"></i> 本站访客数<span id="busuanzi_value_site_uv"></span>人次 </span><span class="post-meta-divider">||</span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> 本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></div><div id="nowDate"><script type="text/javascript">window.onload=function(){function e(){var e=new Date,r=e.getFullYear(),u=e.getMonth()+1,a=e.getDate(),g=e.getDay(),i=e.getHours(),c=e.getMinutes(),d=e.getSeconds(),l="当前时间是："+r+"年"+u+"月"+a+"日 "+t(g)+" "+n(i)+":"+n(c)+":"+n(d);o.innerHTML=l}function t(e){return 0==e?"星期日":1==e?"星期一":2==e?"星期二":3==e?"星期三":4==e?"星期四":5==e?"星期五":"星期六"}function n(e){return e<10?"0"+e:e}var o=document.getElementById("nowDate");e(),setInterval(e,1e3)}</script></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/javascript" src="/js/src/love.js"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by neat -->